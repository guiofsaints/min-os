<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">89</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">22073</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">339</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">7440 (33.71%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#c-clones">c</a></td><td class="py-3 px-6">89</td><td class="py-3 px-6">22073</td><td class="py-3 px-6">339</td><td class="py-3 px-6">7440</td><td class="py-3 px-6">64422</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="c-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">c</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\other\logotweak\logoread.c (Line 23:9 - Line 31:6), workspace\_unmaintained\miyoomini\other\logotweak\logowrite.c (Line 67:7 - Line 74:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-c text-sm text-gray-800"> imgfd;

	read_buf = malloc(IMGSIZE);
	if (!read_buf) { puts(&quot;malloc failed&quot;); return -1; }

	printf(&quot;Reading /dev/mtd3 ... &quot;);
	mtdfd = open(&quot;/dev/mtd3&quot;, O_RDONLY);
	if (mtdfd &lt; 0) { puts(&quot;failed to open&quot;); return -1; }

	ioctl(mtdfd, MEMGETINFO, &amp;mtdinfo);
	if (mtdinfo.type != 3) { puts(&quot;MTD type incorrect&quot;); return -1; }
</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\other\logotweak\logoread.c (Line 37:2 - Line 45:2), workspace\_unmaintained\miyoomini\other\logotweak\logowrite.c (Line 36:2 - Line 44:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-c text-sm text-gray-800">EEK_SET);
	if (read(mtdfd, read_buf, IMGSIZE) != IMGSIZE) { puts(&quot;failed to read&quot;); return -1; }
	close(mtdfd);
	puts(&quot;OK&quot;);

	printf(&quot;Checking partition ... &quot;);
	read_ofs = read_buf;		// &quot;SSTAR&quot; offset
	read_ofs32 = (uint32_t*)read_ofs;
	if ((read_ofs32[0] != 0x41545353)||(read_ofs32[1] != 0x52)||(read_ofs32[2] != 4)) { puts(&quot;missing SSTAR&quot;); return -1; }

	read_ofs = read_ofs + 12;	// &quot;DISP&quot; offset</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\other\logotweak\logomake.c (Line 20:4 - Line 55:21), workspace\_unmaintained\miyoomini\other\logotweak\logoread.c (Line 17:6 - Line 52:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-c text-sm text-gray-800">2_t	i, a, size, size32, imgcount, *read_ofs32;
	uint8_t		*read_buf, *read_ofs;
	const char	img_name[4][12] = { &quot;image1.jpg&quot;, &quot;image2.jpg&quot;, &quot;image3.jpg&quot;, &quot;logo.img&quot; };
	int		mtdfd, imgfd;
	struct stat	fst;

	read_buf = malloc(IMGSIZE);
	if (!read_buf) { puts(&quot;malloc failed&quot;); return -1; }

	printf(&quot;Reading /dev/mtd3 ... &quot;);
	mtdfd = open(&quot;/dev/mtd3&quot;, O_RDONLY);
	if (mtdfd &lt; 0) { puts(&quot;failed to open&quot;); return -1; }

	ioctl(mtdfd, MEMGETINFO, &amp;mtdinfo);
	if (mtdinfo.type != 3) { puts(&quot;MTD type incorrect&quot;); return -1; }
	if (mtdinfo.size != IMGSIZE) { puts(&quot;MTD size incorrect&quot;); return -1; }
	if (mtdinfo.erasesize != 0x10000) { puts(&quot;MTD erasesize incorrect&quot;); return -1; }

	lseek(mtdfd, 0, SEEK_SET);
	if (read(mtdfd, read_buf, IMGSIZE) != IMGSIZE) { puts(&quot;failed to read&quot;); return -1; }
	close(mtdfd);
	puts(&quot;OK&quot;);

	printf(&quot;Checking partition ... &quot;);
	read_ofs = read_buf;		// &quot;SSTAR&quot; offset
	read_ofs32 = (uint32_t*)read_ofs;
	if ((read_ofs32[0] != 0x41545353)||(read_ofs32[1] != 0x52)||(read_ofs32[2] != 4)) { puts(&quot;missing SSTAR&quot;); return -1; }

	read_ofs = read_ofs + 12;	// &quot;DISP&quot; offset
	read_ofs32 = (uint32_t*)read_ofs;
	if (read_ofs32[0] != 0x50534944) { puts(&quot;missing DISP&quot;); return -1; }
	for (i=1,a=0; i&lt;8; i++) a += read_ofs32[i];
	read_ofs = read_ofs + read_ofs32[8] + read_ofs32[9];	// 1st &quot;LOGO&quot; offset
	if ((a)||(read_ofs - read_buf) &gt;</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 134:2 - Line 139:21), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 37:4 - Line 42:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-c text-sm text-gray-800"> }

    return flag;
}

/*
 * ssid to netid
*/
int wpa_conf_ssid2netid(char *ssid, tKEY_MGMT key_mgmt, char *net_id, int *len)
{
    int ret = -1;
    char cmd[CMD_LEN + 1] = {0</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 139:5 - Line 146:37), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 47:5 - Line 54:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-c text-sm text-gray-800">md[CMD_LEN + 1] = {0};
    char reply[REPLY_BUF_SIZE] = {0}, key_type[128], key_reply[128];
    char *pssid_start=NULL, *pssid_end=NULL, *ptr=NULL;
    int flag = 0;

    /* parse key_type */
    if(key_mgmt == WIFIMG_WPA_PSK || ke</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 148:3 - Line 157:4), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 55:4 - Line 64:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-c text-sm text-gray-800">pe, &quot;WPA-PSK&quot;, 128);
    } else {
        strncpy(key_type, &quot;NONE&quot;, 128);
    }

    /* list ap in wpa_supplicant.conf */
    strncpy(cmd, &quot;LIST_NETWORKS&quot;, 15);
    cmd[15] = '\0';
    ret = wifi_command(cmd, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 157:4 - Line 171:2), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 64:2 - Line 78:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-c text-sm text-gray-800">_ERROR,&quot;do list networks error!\n&quot;);
        return -1;
    }

    ptr = reply;
    while((pssid_start=strstr(ptr, ssid)) != NULL){
        char *p_s=NULL, *p_e=NULL, *p_t=NULL;

        pssid_end = pssid_start + strlen(ssid);
        /* ssid is presuffix of searched network */
        if(*pssid_end != '\t'){
            p_e = strchr(pssid_start</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 171:2 - Line 182:4), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 78:2 - Line 87:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-c text-sm text-gray-800">        if(p_e != NULL){
                ptr = p_e;
                continue;
            }else{
                break;
            }
        }

       flag |=</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 194:8 - Line 201:3), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 101:4 - Line 108:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-c text-sm text-gray-800">p_s, tmp);
            net_id[tmp] = '\0';
            }
        }

        /* get key_mgmt */
        sprintf(cmd, &quot;GET_NETWORK %s key_mgmt&quot;, net_id);
        cmd[CMD_LEN] = '\0';
        ret = wifi_command(cmd, ke</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 202:2 - Line 224:4), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 112:2 - Line 130:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-c text-sm text-gray-800">tf(MSG_ERROR,&quot;do get network %s key_mgmt error!\n&quot;, net_id);
            return -1;
        }

        if(strcmp(key_reply, key_type) == 0){
           flag |= (0x01 &lt;&lt; 1);
	  *len =  strlen(net_id);
            break;
        }

        if(p_e == NULL){
            break;
        }else{
            *p_e = '\</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 235:8 - Line 242:4), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 55:4 - Line 62:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup10"><code class="language-c text-sm text-gray-800">0};
    char net_id[NET_ID_LEN+1];
    char *p_n = NULL, *p_t = NULL;

    /* list ap in wpa_supplicant.conf */
    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[CM</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 281:5 - Line 290:6), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 234:5 - Line 62:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup11"><code class="language-c text-sm text-gray-800">reply[REPLY_BUF_SIZE] = {0};
    char *p_c=NULL, *p_str = NULL;
    char *p_s=NULL, *p_e=NULL, *p=NULL;
    int is_ap_connected = 0;
    int ssid_len = strlen(ssid);

    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[CMD_L</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 329:2 - Line 334:2), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 131:2 - Line 276:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup12"><code class="language-c text-sm text-gray-800">ret = is_ip_exist();
    if(ret &gt; 0 &amp;&amp; is_ap_connected == 1){
            return ret;
    }else{
        return is_ap_connected;
   </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 334:5 - Line 344:3), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 279:2 - Line 62:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup13"><code class="language-c text-sm text-gray-800">  }
}

int wpa_conf_get_netid_connected(char *net_id, int *len)
{
    int ret = -1;
    char cmd[CMD_LEN+1] = {0};
    char reply[REPLY_BUF_SIZE] = {0};
    char *p_c=NULL;

    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[C</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 353:9 - Line 358:2), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 91:9 - Line 96:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup14"><code class="language-c text-sm text-gray-800">NULL, *p_e=NULL, *p=NULL;
        p_e = strchr(p_c, '\n');
        if(p_e){
            *p_e = '\0';
        }

        p_s = strrchr(reply, '\n');
        p_s++;
        p = strtok(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 374:6 - Line 401:6), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 131:7 - Line 355:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup15"><code class="language-c text-sm text-gray-800">;
            }
        }

        return 1;
    } else {
        return 0;
    }

}

/*
 * 1. link to ap
 * 2. get ip addr
 *
*/
int wpa_conf_get_ap_connected(char *netid, int *len)
{
    int ret = -1;
    char cmd[CMD_LEN+1] = {0};
    char reply[REPLY_BUF_SIZE] = {0};
    char *p_c=NULL;

    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[CMD_LEN] = '\0';

    ret = wifi_command(cmd, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do list networks error!\n&quot;);
        return -1;
    }

    if ((p_c=strstr(reply, &quot;CURRENT&quot;)) != NULL){
        char *p_s=NULL, *p_e=NULL, *p=NULL;
        p_e = strchr(p_c, '\n');</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 421:2 - Line 444:42), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 230:2 - Line 253:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup16"><code class="language-c text-sm text-gray-800">}

int wpa_conf_enable_all_networks()
{
    int ret = -1, len = 0;
    char cmd[CMD_LEN+1] = {0};
    char reply[REPLY_BUF_SIZE] = {0};
    char net_id[NET_ID_LEN+1] = {0};
    char *p_n = NULL, *p_t = NULL;

    /* list ap in wpa_supplicant.conf */
    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[CMD_LEN] = '\0';
    ret = wifi_command(cmd, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do list networks error!\n&quot;);
        return -1;
    }

    p_n = strchr(reply, '\n');
    while(p_n != NULL){
	  p_n++;
        if((p_t = strchr(p_n, '\t')) != NULL){
            len = p_t - p_n;
            if(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 466:29 - Line 495:20), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 416:29 - Line 445:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup17"><code class="language-c text-sm text-gray-800">d, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do save config error!\n&quot;);
        return -1;
    }

    return 0;
}

int wpa_conf_remove_all_networks()
{
    int ret = -1, len = 0;
    char cmd[CMD_LEN+1] = {0};
    char reply[REPLY_BUF_SIZE] = {0};
    char net_id[NET_ID_LEN+1] = {0};
    char *p_n = NULL, *p_t = NULL;

    /* list ap in wpa_supplicant.conf */
    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[CMD_LEN] = '\0';
    ret = wifi_command(cmd, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do list networks error!\n&quot;);
        return -1;
    }

    p_n = strchr(reply, '\n');
    while(p_n != NULL){
	  p_n++;
        if((p_t = strchr(p_n, '\t')) != NULL){
            len = p_t - p_n;
            if(len &lt;= NET_ID_LEN){
               strncp</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 498:32 - Line 516:33), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 448:32 - Line 466:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup18"><code class="language-c text-sm text-gray-800">cmd, &quot;REMOVE_NETWORK %s&quot;, net_id);
        ret = wifi_command(cmd, reply, sizeof(reply));
        if(ret){
            wmg_printf(MSG_ERROR,&quot;do remove network %s error!\n&quot;, net_id);
            return -1;
        }

        p_n = strchr(p_n, '\n');
    }

    /* save config */
	  sprintf(cmd, &quot;%s&quot;, &quot;SAVE_CONFIG&quot;);
	  ret = wifi_command(cmd, r</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 516:33 - Line 543:4), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 416:29 - Line 253:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup19"><code class="language-c text-sm text-gray-800">eply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do save config error!\n&quot;);
        return -1;
    }

    return 0;
}

int wpa_conf_remove_maxnetid_network()
{
    int ret = -1, len = 0;
    char cmd[CMD_LEN+1] = {0};
    char reply[REPLY_BUF_SIZE] = {0};
    char net_id[NET_ID_LEN+1] = {0};
    char *p_n = NULL, *p_t = NULL;

    /* list ap in wpa_supplicant.conf */
    strncpy(cmd, &quot;LIST_NETWORKS&quot;, CMD_LEN);
    cmd[CMD_LEN] = '\0';
    ret = wifi_command(cmd, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do list networks error!\n&quot;);
        return -1;
    }

    p_n = strchr(reply, '\n');
    while(p_n != NULL){
	p_n++;
        if((p_t = strchr(p_n, '\t')) != NULL){
     </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 548:23 - Line 555:18), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 495:20 - Line 502:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup20"><code class="language-c text-sm text-gray-800">_n = strchr(p_n, '\n');
    }

    /* cancel saved in wpa_supplicant.conf */
    sprintf(cmd, &quot;REMOVE_NETWORK %s&quot;, net_id);
    wmg_printf(MSG_DEBUG,&quot;remove network %s!\n&quot;, net_id);
    ret = w</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 552:2 - Line 564:2), workspace\tg5040\wifimanager\src\core\wpa_supplicant_conf.c (Line 452:2 - Line 464:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup21"><code class="language-c text-sm text-gray-800">k %s!\n&quot;, net_id);
    ret = wifi_command(cmd, reply, sizeof(reply));
    if(ret){
        wmg_printf(MSG_ERROR,&quot;do remove network %s error!\n&quot;, net_id);
        return -1;
    }

    /* save config */
      sprintf(cmd, &quot;%s&quot;, &quot;SAVE_CON</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\src\core\scan.c (Line 53:5 - Line 71:7), workspace\tg5040\wifimanager\src\core\scan.c (Line 32:5 - Line 50:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup22"><code class="language-c text-sm text-gray-800">       *(ptr++) = *(ftr++);
            *ptr = '\0';
            continue; //restart new search at ptr_s after removing slash
	}
        else
            ptr_s++; //restart new search at ptr_s++
    }

    ptr_s = scan.results;
    while(1)
    {
        ptr = strchr(ptr_s,'\\');
	if(ptr == NULL)
	    break;

        ptr_s = ptr;
        if((*(ptr-1)) == '\\')
	{
            ftr = pt</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\zero28\keymon\keymon.c (Line 40:2 - Line 50:4), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 50:1 - Line 60:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup23"><code class="language-c text-sm text-gray-800"> &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;

// #include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MA</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\platform\platform.c (Line 295:2 - Line 303:7), workspace\_unmaintained\zero28\platform\platform.c (Line 206:2 - Line 214:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup24"><code class="language-c text-sm text-gray-800">vid.disp_fd);
	
	SDL_Quit();
}

void PLAT_clearVideo(SDL_Surface* IGNORED) {
	if (!vid.cleared) memset(vid.screen-&gt;pixels, 0, vid.pitch * vid.height);
	m</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\platform\platform.c (Line 411:2 - Line 425:7), workspace\_unmaintained\zero28\platform\platform.c (Line 473:2 - Line 485:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup25"><code class="language-c text-sm text-gray-800">vid.buffer_config.info.fb.size[0].height = vid.width;
		vid.buffer_config.info.fb.crop.width  = (int64_t)vid.height &lt;&lt; 32;
		vid.buffer_config.info.fb.crop.height = (int64_t)vid.width  &lt;&lt; 32;
		uint32_t args[4] = {0, (uintptr_t)&amp;vid.buffer_config, 1, 0};
		ioctl(vid.disp_fd, DISP_LAYER_SET_CONFIG, args);
		vid.re</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\platform\platform.c (Line 493:10 - Line 503:6), workspace\_unmaintained\zero28\platform\platform.c (Line 531:33 - Line 541:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup26"><code class="language-c text-sm text-gray-800">
	munmap(adc.mem_map, adc.page_size*2);
	close(adc.mem_fd);
}

///////////////////////////////

#define USB_SPEED &quot;/sys/devices/platf</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 44:1 - Line 49:5), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 60:1 - Line 65:28)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup27"><code class="language-c text-sm text-gray-800">efaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 3,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 55:3 - Line 73:2), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 71:3 - Line 89:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup28"><code class="language-c text-sm text-gray-800">KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARE</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 83:2 - Line 99:9), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 103:2 - Line 120:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup29"><code class="language-c text-sm text-gray-800">aultSettings, shm_size);
		}

		// these shouldn't be persisted
		// settings-&gt;jack = 0;
	}
	printf(&quot;brightness: %i\nspeaker: %i \n&quot;, settings-&gt;brightness, settings-&gt;speaker);
	
	disp_fd = open(&quot;/dev/disp&quot;, O_RDWR);
	
	SetVolume(GetVolume());
	SetBrightness(GetBrightness());
}
void QuitSettings(void) {
	close(disp_fd);
	munmap(settings, shm</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 33:2 - Line 43:9), workspace\_unmaintained\zero28\keymon\keymon.c (Line 61:2 - Line 71:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup30"><code class="language-c text-sm text-gray-800">D	0
#define PRESSED		1

#define INPUT_COUNT 2
static int	input_fd = 0;
static struct input_event ev;

int main (int argc, char *argv[]) {
	InitSettings();
	
	input_fd = open(&quot;/dev/input/event0&quot;, O</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 80:5 - Line 89:14), workspace\_unmaintained\zero28\keymon\keymon.c (Line 134:5 - Line 143:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup31"><code class="language-c text-sm text-gray-800"> = down_just_pressed = val;
					if (val) down_repeat_at = now + 300;
				break;
				default:
				break;
			}
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (start_pressed) {
				val = GetBrightness();
				if (v</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 94:5 - Line 102:7), workspace\_unmaintained\zero28\keymon\keymon.c (Line 150:5 - Line 158:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup32"><code class="language-c text-sm text-gray-800">X) SetVolume(++val);
			}
			
			if (up_just_pressed) up_just_pressed = 0;
			else up_repeat_at += 100;
		}
		
		if (down_just_pressed || (down_pressed &amp;&amp; now&gt;=down_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\show\show.c (Line 10:1 - Line 25:4), workspace\_unmaintained\zero28\show\show.c (Line 15:1 - Line 30:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup33"><code class="language-c text-sm text-gray-800"> &lt;SDL2/SDL.h&gt;
#include &lt;SDL2/SDL_image.h&gt;

SDL_Window* window;
SDL_Surface* screen;

int main(int argc , char* argv[]) {
	if (argc&lt;2) {
		puts(&quot;Usage: show.elf image.png delay&quot;);
		return 0;
	}
	
	char path[256];
	strncpy(path,argv[1],256);
	if (access(path, F_OK)!=0) return 0; // nothing to show :(
	
	int delay = argc&gt;2</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\show\show.c (Line 30:7 - Line 36:24), workspace\_unmaintained\zero28\show\show.c (Line 44:6 - Line 48:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup34"><code class="language-c text-sm text-gray-800">UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	puts(&quot;&quot;);
	
	screen = SDL_GetWindowSurface(window); 
	SDL_FillRect(screen, NULL, 0);
	 
	SDL_Surface* img = IMG_Load(path); 
	SDL_BlitSurface(img, NULL, screen</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 167:2 - Line 172:3), workspace\_unmaintained\rgb30\platform\platform.c (Line 94:2 - Line 99:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup35"><code class="language-c text-sm text-gray-800">REPEAT_DELAY); }
				else if (code==RAW_LSY) { pad.laxis.y = (value * 32767) / 1800; PAD_setAnalog(BTN_ID_ANALOG_UP,   BTN_ID_ANALOG_DOWN,  pad.laxis.y, tick+PAD_REPEAT_DELAY); }
				/</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 182:1 - Line 203:12), workspace\_unmaintained\zero28\platform\platform.c (Line 35:1 - Line 55:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup36"><code class="language-c text-sm text-gray-800">0;
				else if (code==RAW_RSY) pad.raxis.x = (value * 32767) / 1800;
				
				btn = BTN_NONE; // already handled, force continue
			}
			
			if (btn==BTN_NONE) continue;
		
			if (!pressed) {
				pad.is_pressed		&amp;= ~btn; // unset
				pad.just_repeated	&amp;= ~btn; // unset
				pad.just_released	|= btn; // set
			}
			else if ((pad.is_pressed &amp; btn)==BTN_NONE) {
				pad.</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 302:2 - Line 318:13), workspace\_unmaintained\zero28\platform\platform.c (Line 114:2 - Line 130:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup37"><code class="language-c text-sm text-gray-800">_RendererInfo info;
	// SDL_GetRendererInfo(vid.renderer, &amp;info);
	// LOG_info(&quot;Current render driver: %s\n&quot;, info.name);
	
	SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY,&quot;1&quot;); // linear
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	vid.target	= NULL; // only needed for non-native sizes
	
	// TODO: doesn't work here
	// </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 328:2 - Line 336:51), workspace\_unmaintained\zero28\platform\platform.c (Line 146:2 - Line 154:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup38"><code class="language-c text-sm text-gray-800">/ SDL_GetTextureScaleMode(vid.texture, &amp;scale_mode);
	// LOG_info(&quot;texture scale mode: %i\n&quot;, scale_mode);
	
	// int format;
	// int access_;
	// SDL_QueryTexture(vid.texture, &amp;format, &amp;access_, NULL,NULL);
	// LOG_info(&quot;texture format: %s (streaming: %i)\n&quot;, SDL_GetPixelFormatName(format), access_==SDL_TEXTURE</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 337:2 - Line 349:7), workspace\_unmaintained\zero28\platform\platform.c (Line 155:39 - Line 168:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup39"><code class="language-c text-sm text-gray-800">AMING);
	
	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	vid.screen	= SDL_CreateRGBSurface(SDL_SWSURFACE, w,h, FIXED_DEPTH, RGBA_MASK_565);
	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
	
	device_width	= w;
	d</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 350:1 - Line 357:85), workspace\_unmaintained\zero28\platform\platform.c (Line 168:1 - Line 175:100)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup40"><code class="language-c text-sm text-gray-800">vice_height	= h;
	device_pitch	= p;
	
	vid.sharpness = SHARPNESS_SOFT;
	
	return vid.screen;
}

static void clearVideo(void) {
	SDL_FillRect(vid.screen, NULL, 0);
	for (int i=0; i&lt;3; i++) {
		SDL_RenderClear(vid.renderer);
		SDL_RenderPresent(vid.renderer);
	}
}

void P</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 361:2 - Line 399:3), workspace\_unmaintained\zero28\platform\platform.c (Line 179:2 - Line 306:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup41"><code class="language-c text-sm text-gray-800">arget);
	if (vid.effect) SDL_DestroyTexture(vid.effect);
	SDL_DestroyTexture(vid.texture);
	SDL_DestroyRenderer(vid.renderer);
	SDL_DestroyWindow(vid.window);
	
	// system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
	SDL_Quit();
}

void PLAT_clearVideo(SDL_Surface* screen) {
	SDL_FillRect(screen, NULL, 0); // TODO: revisit
}
void PLAT_clearAll(void) {
	PLAT_clearVideo(vid.screen); // TODO: revist
	SDL_RenderClear(vid.renderer);
}

void PLAT_setVsync(int vsync) {
	// buh
}

static int hard_scale = 4; // TODO: base src size, eg. 160x144 can be 4

static void resizeVideo(int w, int h, int p) {
	if (w==vid.width &amp;&amp; h==vid.height &amp;&amp; p==vid.pitch) return;
	
	// TODO: minarch disables crisp (and nn upscale before linear downscale) when native
	
	if (w&gt;=device_width &amp;&amp; h&gt;=device_height) hard_scale = 1;
	else if (h&gt;=160) hard_scale = 2; // limits gba and up to 2x (seems sufficient)
	else hard_scale = 4;

	LOG_info(&quot;resizeVideo(%i,%i,%i) hard_scale: %i crisp: %i\n&quot;,w,h,p, hard_scale,vid.sharpness==SHARPNESS_CRISP);

	SDL_FreeSurface(vid.buffer);
	SDL_DestroyTexture(vid.texture);
	if (vid.target) SDL_DestroyTexture(vid.target);
	
	SDL_SetHintWithPriority(SDL_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 397:1 - Line 486:2), workspace\_unmaintained\zero28\platform\platform.c (Line 215:1 - Line 304:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup42"><code class="language-c text-sm text-gray-800">(vid.target);
	
	SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, vid.sharpness==SHARPNESS_SOFT?&quot;1&quot;:&quot;0&quot;, SDL_HINT_OVERRIDE);
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, &quot;1&quot;, SDL_HINT_OVERRIDE);
		vid.target = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_TARGET, w * hard_scale,h * hard_scale);
	}
	else {
		vid.target = NULL;
	}

	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);

	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int p) {
	resizeVideo(w,h,p);
	return vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y, int width, int height) {
	// buh
}
void PLAT_setNearestNeighbor(int enabled) {
	// buh
}
void PLAT_setSharpness(int sharpness) {
	if (vid.sharpness==sharpness) return;
	int p = vid.pitch;
	vid.pitch = 0;
	vid.sharpness = sharpness;
	resizeVideo(vid.width,vid.height,p);
}

static struct FX_Context {
	int scale;
	int type;
	int color;
	int next_scale;
	int next_type;
	int next_color;
	int live_type;
} effect = {
	.scale = 1,
	.next_scale = 1,
	.type = EFFECT_NONE,
	.next_type = EFFECT_NONE,
	.live_type = EFFECT_NONE,
	.color = 0,
	.next_color = 0,
};
static void rgb565_to_rgb888(uint32_t rgb565, uint8_t *r, uint8_t *g, uint8_t *b) {
    // Extract the red component (5 bits)
    uint8_t red = (rgb565 &gt;&gt; 11) &amp; 0x1F;
    // Extract the green component (6 bits)
    uint8_t green = (rgb565 &gt;&gt; 5) &amp; 0x3F;
    // Extract the blue component (5 bits)
    uint8_t blue = rgb565 &amp; 0x1F;

    // Scale the values to 8-bit range
    *r = (red &lt;&lt; 3) | (red &gt;&gt; 2);
    *g = (green &lt;&lt; 2) | (green &gt;&gt; 4);
    *b = (blue &lt;&lt; 3) | (blue &gt;&gt; 2);
}
static void updateEffect(void) {
	if (effect.next_scale==effect.scale &amp;&amp; effect.next_type==effect.type &amp;&amp; effect.next_color==effect.color) return; // unchanged
	
	int live_scale = effect.scale;
	int live_color = effect.color;
	effect.scale = effect.next_scale;
	effect.type = effect.next_type;
	effect.color = effect.next_color;
	
	if (effect.type==EFFECT_NONE) return; // disabled
	if (effect.type==effect.live_type &amp;&amp; effect.scale==live_scale &amp;&amp; effect.color==live_color) return; // already loaded
	
	char* effect_path;
	int opacity = 128; // 1 - 1/2 = 50%
	if (effect.type==EFFECT_LINE) {
		if (effe</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 486:3 - Line 510:37), workspace\_unmaintained\zero28\platform\platform.c (Line 305:3 - Line 329:38)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup43"><code class="language-c text-sm text-gray-800">ect.scale&lt;3) {
			effect_path = RES_PATH &quot;/line-2.png&quot;;
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/line-3.png&quot;;
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/line-4.png&quot;;
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/line-5.png&quot;;
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/line-6.png&quot;;
		}
		else {
			effect_path = RES_PATH &quot;/line-8.png&quot;;
		}
	}
	else if (effect.type==EFFECT_GRID) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/grid-2.png&quot;;
			opacity = 64; // 1 - 3/4 = 25%
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/grid-3.png&quot;;
			opacity = 112; // 1 </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 512:5 - Line 523:2), workspace\_unmaintained\zero28\platform\platform.c (Line 331:5 - Line 343:48)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup44"><code class="language-c text-sm text-gray-800">4%
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/grid-4.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/grid-5.png&quot;;
			opacity = 160; // 1 - 9/25 = ~64%
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/grid-6.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;11) {
			effect_path = RES_PATH &quot;/grid-8.png&quot;;
</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 523:4 - Line 559:15), workspace\_unmaintained\zero28\platform\platform.c (Line 344:4 - Line 381:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup45"><code class="language-c text-sm text-gray-800">
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else {
			effect_path = RES_PATH &quot;/grid-11.png&quot;;
			opacity = 136; // 1 - 57/121 = ~52%
		}
	}
	
	// LOG_info(&quot;effect: %s opacity: %i\n&quot;, effect_path, opacity);
	SDL_Surface* tmp = IMG_Load(effect_path);
	if (tmp) {
		if (effect.type==EFFECT_GRID) {
			if (effect.color) {
				// LOG_info(&quot;dmg color grid...\n&quot;);
			
				uint8_t r,g,b;
				rgb565_to_rgb888(effect.color,&amp;r,&amp;g,&amp;b);
				// LOG_info(&quot;rgb %i,%i,%i\n&quot;,r,g,b);
				
				uint32_t* pixels = (uint32_t*)tmp-&gt;pixels;
				int width = tmp-&gt;w;
				int height = tmp-&gt;h;
				for (int y = 0; y &lt; height; ++y) {
				    for (int x = 0; x &lt; width; ++x) {
				        uint32_t pixel = pixels[y * width + x];
				        uint8_t _,a;
				        SDL_GetRGBA(pixel, tmp-&gt;format, &amp;_, &amp;_, &amp;_, &amp;a);
				        if (a) pixels[y * width + x] = SDL_MapRGBA(tmp-&gt;format, r,g,b, a);
				    }
				}
			}
		}
		
		if (vid.effect) SDL_DestroyTexture(vid.effect);
		vid.effect = SDL_CreateTextureFromSurface(vid.renderer, tmp);
		SDL_SetTextureAlphaM</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 559:3 - Line 617:15), workspace\_unmaintained\zero28\platform\platform.c (Line 382:2 - Line 440:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup46"><code class="language-c text-sm text-gray-800">tTextureAlphaMod(vid.effect, opacity);
		SDL_FreeSurface(tmp);
		effect.live_type = effect.type;
	}
	}
void PLAT_setEffect(int next_type) {
	effect.next_type = next_type;
}
void PLAT_setEffectColor(int next_color) {
	effect.next_color = next_color;
}
void PLAT_vsync(int remaining) {
	if (remaining&gt;0) SDL_Delay(remaining);
}

scaler_t PLAT_getScaler(GFX_Renderer* renderer) {
	// LOG_info(&quot;getScaler for scale: %i\n&quot;, renderer-&gt;scale);
	effect.next_scale = renderer-&gt;scale;
	return scale1x1_c16;
}

void PLAT_blitRenderer(GFX_Renderer* renderer) {
	vid.blit = renderer;
	SDL_RenderClear(vid.renderer);
	resizeVideo(vid.blit-&gt;true_w,vid.blit-&gt;true_h,vid.blit-&gt;src_p);
}

void PLAT_flip(SDL_Surface* IGNORED, int ignored) {
	if (!vid.blit) {
		resizeVideo(device_width,device_height,FIXED_PITCH); // !!!???
		SDL_UpdateTexture(vid.texture,NULL,vid.screen-&gt;pixels,vid.screen-&gt;pitch);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_RenderPresent(vid.renderer);
		return;
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_UpdateTexture(vid.texture,NULL,vid.blit-&gt;src,vid.blit-&gt;src_p);
	// LOG_info(&quot;blit blocked for %ims (%i,%i)\n&quot;, SDL_GetTicks()-then,vid.buffer-&gt;w,vid.buffer-&gt;h);
	
	SDL_Texture* target = vid.texture;
	int x = vid.blit-&gt;src_x;
	int y = vid.blit-&gt;src_y;
	int w = vid.blit-&gt;src_w;
	int h = vid.blit-&gt;src_h;
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetRenderTarget(vid.renderer,vid.target);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_SetRenderTarget(vid.renderer,NULL);
		x *= hard_scale;
		y *= hard_scale;
		w *= hard_scale;
		h *= hard_scale;
		target = vid.target;
	}
	
	SDL_Rect* src_rect = &amp;(SDL_Rect){x,y,w,h};
	SDL_Rect* dst_rect = &amp;(SDL_Rect){0,0,device_width,device_hei</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 621:3 - Line 630:4), workspace\_unmaintained\zero28\platform\platform.c (Line 451:2 - Line 459:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup47"><code class="language-c text-sm text-gray-800">ct-&gt;w,src_rect-&gt;h);

		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h * vid.blit-&gt;scale;
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
		
		// LOG</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 630:2 - Line 677:36), workspace\_unmaintained\zero28\platform\platform.c (Line 456:5 - Line 505:45)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup48"><code class="language-c text-sm text-gray-800">-&gt;x,dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h);
	}
	else if (vid.blit-&gt;aspect&gt;0) { // aspect
		int h = device_height;
		int w = h * vid.blit-&gt;aspect;
		if (w&gt;device_width) {
			double ratio = 1 / vid.blit-&gt;aspect;
			w = device_width;
			h = w * ratio;
		}
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		// dst_rect = &amp;(SDL_Rect){x,y,w,h};
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
	}
	
	SDL_RenderCopy(vid.renderer, target, src_rect, dst_rect);
	
	updateEffect();
	if (vid.blit &amp;&amp; effect.type!=EFFECT_NONE &amp;&amp; vid.effect) {
		SDL_RenderCopy(vid.renderer, vid.effect, &amp;(SDL_Rect){0,0,dst_rect-&gt;w,dst_rect-&gt;h},dst_rect);
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_RenderPresent(vid.renderer);
	// LOG_info(&quot;SDL_RenderPresent blocked for %ims\n&quot;, SDL_GetTicks()-then);
	vid.blit = NULL;
}

int PLAT_supportsOverscan(void) { return 1; }

///////////////////////////////

// TODO: 
#define OVERLAY_WIDTH PILL_SIZE // unscaled
#define OVERLAY_HEIGHT PILL_SIZE // unscaled
#define OVERLAY_BPP 4
#define OVERLAY_DEPTH 16
#define OVERLAY_PITCH (OVERLAY_WID</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 682:2 - Line 688:7), workspace\_unmaintained\zero28\platform\platform.c (Line 510:2 - Line 517:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup49"><code class="language-c text-sm text-gray-800">ext {
	SDL_Surface* overlay;
} ovl;

SDL_Surface* PLAT_initOverlay(void) {
	ovl.overlay = SDL_CreateRGBSurface(SDL_SWSURFACE, SCALE2(OVERLAY_WIDTH,OVERLAY_HEIG</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 692:2 - Line 701:11), workspace\_unmaintained\zero28\platform\platform.c (Line 532:2 - Line 541:39)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup50"><code class="language-c text-sm text-gray-800">(ovl.overlay);
}
void PLAT_enableOverlay(int enable) {

}

///////////////////////////////

static int online = 0;
void PLAT_getBatteryStatus</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 703:1 - Line 712:8), workspace\_unmaintained\zero28\platform\platform.c (Line 547:2 - Line 556:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup51"><code class="language-c text-sm text-gray-800">
	PLAT_getBatteryStatusFine(is_charging, charge);

	// worry less about battery and more about the game you're playing
	     if (*charge&gt;80) *charge = 100;
	else if (*charge&gt;60) *charge =  80;
	e</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\platform\platform.c (Line 716:5 - Line 727:7), workspace\_unmaintained\trimuismart\platform\platform.c (Line 521:4 - Line 532:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup52"><code class="language-c text-sm text-gray-800">
}

void PLAT_getBatteryStatusFine(int* is_charging, int* charge)
{
	// *is_charging = 0;
	// *charge = PWR_LOW_CHARGE;
	// return;
	
	*is_ch</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 25:5 - Line 32:5), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 27:5 - Line 34:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup53"><code class="language-c text-sm text-gray-800"> 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for futur</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 33:2 - Line 48:4), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 35:2 - Line 45:68)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup54"><code class="language-c text-sm text-gray-800">E: doesn't really need to be persisted but still needs to be shared
	int jack; 
	int hdmi; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERS</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 48:1 - Line 69:27), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 50:1 - Line 54:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup55"><code class="language-c text-sm text-gray-800">ERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
	.hdmi = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

#define BACKLIGHT_PATH &quot;/sys/class/backlight/backlight/bl_power&quot;
#define BRIGHTNESS_PATH &quot;/sys/class/backlight/backlight/brightness&quot;
#define JACK_STATE_PATH &quot;/sys/bus/platform/devices/singleadc-joypad/hp&quot;
#define HDMI_STATE_PATH &quot;/sys/class/extcon/hdmi/cable.0/state&quot;

int getInt(char* path) {
	int i = 0;
	FILE *file = fopen(path, &quot;r&quot;);</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 70:3 - Line 89:2), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 71:3 - Line 90:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup56"><code class="language-c text-sm text-gray-800">f (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}


void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // sho</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 101:1 - Line 119:3), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 101:1 - Line 120:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup57"><code class="language-c text-sm text-gray-800">ose(fd);
		}
		else {
			// load defaults
			memcpy(settings, &amp;DefaultSettings, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
		// settings-&gt;hdmi = 0;
	}
	
	int jack = getInt(JACK_STATE_PATH);
	int hdmi = getInt(HDMI_STATE_PATH);
	printf(&quot;brightness: %i (hdmi: %i)\nspeaker: %i (jack: %i)\n&quot;, settings-&gt;brightness, hdmi, settings-&gt;spe</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 134:3 - Line 142:7), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 133:3 - Line 141:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup58"><code class="language-c text-sm text-gray-800">(fd);
		sync();
	}
}

int GetBrightness(void) { // 0-10
	return settings-&gt;brightness;
}
void SetBrightness(int value) {
	if (settings-&gt;hdmi) retur</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 137:6 - Line 145:5), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 116:2 - Line 124:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup59"><code class="language-c text-sm text-gray-800">
void SetBrightness(int value) {
	if (settings-&gt;hdmi) return;
	
	int raw;
	switch (value) {
		// TODO: redo, range is 0-255
		case 0: raw=4; break; 		//  0
		case 1: ra</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\keymon\keymon.c (Line 34:9 - Line 48:7), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 41:2 - Line 60:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup60"><code class="language-c text-sm text-gray-800">ude &lt;msettings.h&gt;

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define REPEAT		2

// L3 or R3
#define CODE_MENU 317 // 11 in SDL for some reason...
</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\keymon\keymon.c (Line 89:2 - Line 120:2), workspace\_unmaintained\zero28\keymon\keymon.c (Line 59:2 - Line 90:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup61"><code class="language-c text-sm text-gray-800"> {
			had_headphones = has_headphones;
			SetJack(has_headphones);
		}
		
		has_hdmi = getInt(HDMI_STATE_PATH);
		if (had_hdmi!=has_hdmi) {
			had_hdmi = has_hdmi;
			SetHDMI(has_hdmi);
		}
	}
	
	return 0;
}


int main (int argc, char *argv[]) {
	printf(&quot;keymon\n&quot;); fflush(stdout);
	InitSettings();
	pthread_create(&amp;ports_pt, NULL, &amp;watchPorts, NULL);
	
	char path[32];
	for (int i=0; i&lt;INPUT_COUNT-1; i++) {
		sprintf(path, &quot;/dev/input/event%i&quot;, i);
		inputs[i] = open(path, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	}
	inputs[5] = open(&quot;/dev/input/js0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	
	uint32_t input;
	uint32_t val;
	uint32_t menu_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\keymon\keymon.c (Line 125:4 - Line 151:4), workspace\_unmaintained\zero28\keymon\keymon.c (Line 102:6 - Line 128:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup62"><code class="language-c text-sm text-gray-800">/ essential SDL_GetTicks()
	ignore = 0;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		for (int i=0; i&lt;INPUT_COUNT; i++) {
			input = inputs[i];
			while(read(input, &amp;ev, sizeof(ev))==sizeof(ev)) {
				if (ignore) continue;
				val = ev.value;
				if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
				// printf(&quot;value: %i code: %i\n&quot;, val, ev.code); fflush(stdout);
				switch (ev.code) {
					case CODE_MENU:
					case COD</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\keymon\keymon.c (Line 154:2 - Line 165:4), workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 79:2 - Line 144:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup63"><code class="language-c text-sm text-gray-800">ssed = up_just_pressed = val;
						if (val) up_repeat_at = now + 300;
					break;
					case CODE_MINUS:
						down_pressed = down_just_pressed = val;
						if (val) down_repeat_at = now + 300;
					break;
					default:
					break;
				}
			}
		}
		
		if </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rgb30\keymon\keymon.c (Line 168:2 - Line 182:2), workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 93:2 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup64"><code class="language-c text-sm text-gray-800">d = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBri</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\show\show.c (Line 12:1 - Line 27:2), workspace\_unmaintained\zero28\show\show.c (Line 15:1 - Line 30:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup65"><code class="language-c text-sm text-gray-800">stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;SDL2/SDL.h&gt;
#include &lt;SDL2/SDL_image.h&gt;

#define FIXED_BPP		2
#define FIXED_DEPTH		(FIXED_BPP * 8)

#define RGBA_MASK_565	0xF800, 0x07E0, 0x001F, 0x0000

int main(int argc , char* argv[]) {
	if (argc&lt;2) {
		puts(&quot;Usage: show.elf image.png delay&quot;);
		return 0;
	}
	
	char path[256];</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\show\show.c (Line 29:2 - Line 35:2), workspace\_unmaintained\zero28\show\show.c (Line 32:12 - Line 38:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup66"><code class="language-c text-sm text-gray-800">56);
	if (access(path, F_OK)!=0) return 0; // nothing to show :(
	
	int delay = argc&gt;2 ? atoi(argv[2]) : 2;
	
	SDL_Init(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	int w = 0;
	int h = 0;
	int p = 0;
	SDL_Window* window = SDL_CreateWi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\show\show.c (Line 38:10 - Line 51:2), workspace\_unmaintained\zero28\show\show.c (Line 38:2 - Line 51:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup67"><code class="language-c text-sm text-gray-800">EFINED, w,h, SDL_WINDOW_SHOWN);
	
	int rotate = 0;
	SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	if (mode.h&gt;mode.w) rotate = 3;
	w = mode.w;
	h = mode.h;
	p = mode.w * FIXED_BPP;
	
	SDL_Renderer* renderer = SDL_CreateRenderer(window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	SDL_Texture* texture = SDL_CreateTexture(renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	SDL_Surface* screen = SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	
	SDL_LockTexture(texture,NULL,&amp;screen-&gt;pixels,&amp;screen-&gt;pitch);
	SDL_FillRect(screen, NULL, 0);
	SDL_Surface* img = IMG_Load(path);
	SDL_BlitSurface(i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\show\show.c (Line 51:2 - Line 63:2), workspace\_unmaintained\zero28\show\show.c (Line 51:2 - Line 63:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup68"><code class="language-c text-sm text-gray-800">, NULL, screen, &amp;(SDL_Rect){(screen-&gt;w-img-&gt;w)/2,(screen-&gt;h-img-&gt;h)/2});
	SDL_FreeSurface(img);
	SDL_UnlockTexture(texture);

	if (rotate) SDL_RenderCopyEx(renderer,texture,NULL,&amp;(SDL_Rect){0,w,w,h},rotate*90,&amp;(SDL_Point){0,0},SDL_FLIP_NONE);
	else SDL_RenderCopy(renderer, texture, NULL,NULL</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 167:2 - Line 200:16), workspace\_unmaintained\rgb30\platform\platform.c (Line 60:10 - Line 93:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup69"><code class="language-c text-sm text-gray-800">um GamepadType {
	kGamepadTypeUnknown,
	kGamepadTypeRGP01,
	kGamepadTypeXbox,
} GamepadType;

#define INPUT_COUNT 3
static int inputs[INPUT_COUNT];

#define kPadIndex 2
static GamepadType pad_type = kGamepadTypeUnknown;

#define LID_PATH &quot;/sys/class/power_supply/axp2202-battery/hallkey&quot;
void PLAT_initLid(void) {
	lid.has_lid = exists(LID_PATH);
}
int PLAT_lidChanged(int* state) {
	if (lid.has_lid) {
		int lid_open = getInt(LID_PATH);
		if (lid_open!=lid.is_open) {
			lid.is_open = lid_open;
			if (state) *state = lid_open;
			return 1;
		}
	}
	return 0;
}

static void checkForGamepad(void) {
	uint32_t now = SDL_GetTicks();
	static uint32_t last_check = 0;
	if</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 202:2 - Line 207:3), workspace\_unmaintained\rgb30\platform\platform.c (Line 93:2 - Line 98:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup70"><code class="language-c text-sm text-gray-800">check==0 || now-last_check&gt;2000) {
		last_check = now;
		int connected = exists(&quot;/dev/input/event3&quot;);
		if (inputs[kPadIndex]&lt;0</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 207:9 - Line 223:51), workspace\_unmaintained\rgb30\platform\platform.c (Line 97:2 - Line 113:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup71"><code class="language-c text-sm text-gray-800">	LOG_info(&quot;Connecting gamepad: &quot;);
			char pad_name[256];
			getFile(&quot;/sys/class/input/event3/device/name&quot;, pad_name, 256);
			if (containsString(pad_name,&quot;Anbernic&quot;)) {
				LOG_info(&quot;P01\n&quot;);
				pad_type = kGamepadTypeRGP01;
			}
			else if (containsString(pad_name, &quot;Microsoft&quot;)) {
				LOG_info(&quot;Xbox\n&quot;);
				pad_type = kGamepadTypeXbox;
			}
			else {
				LOG_info(&quot;Unknown\n&quot;);
				pad_type = kGamepadTypeUnknown;
			}
			
			inputs[kPadIndex] = open(&quot;/dev/input/event3&quot;, </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 259:8 - Line 282:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 114:7 - Line 137:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup72"><code class="language-c text-sm text-gray-800"> BTN_ID_Y; }
						else if (code==RGP01_START)		{ btn = BTN_START; 		id = BTN_ID_START; }
						else if (code==RGP01_SELECT)	{ btn = BTN_SELECT; 	id = BTN_ID_SELECT; }
						else if (code==RGP01_MENU)		{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
						else if (code==RGP01_MENU1)		{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
						else if (code==RGP01_MENU2)		{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
						else if (code==RGP01_L1)		{ btn = BTN_L1; 		id = BTN_ID_L1; }
						else if (code==RGP01_L2)		{ btn = BTN_L2; 		id = BTN_ID_L2; }
						else if (code==RGP01_L3)		{ btn = BTN_L3; 		id = BTN_ID_L3; }
						else if (code==RGP01_R1)		{ btn = BTN_R1; 		id = BTN_ID_R1; }
						else if (code==RGP01_R2)		{ btn = BTN_R2; 		id = BTN_ID_R2; }
						else if (code==RGP01_R3)		{ btn = BTN_R3; 		id = BTN_ID_R3; }
					}
					else if (pad_type==kGamepadTypeXbox) {
							 if (code==XBOX_A)			{ btn = BTN_A; 			id = BTN_ID_A; }
						else if (code==XBOX_B)			{ btn = BTN_B; 			id = BTN_ID_B; }
						else if (code==XBOX_X)			{ btn = BTN_X; 			id = BTN_ID_X; }
						else if (code==XBOX_Y)			{ btn = BTN_Y; 			id = BTN_ID_Y; }
						else if (code==XBOX_START)		{ btn = BTN_START; 		id = BTN_ID_START; }
						else if (code==XBOX_SELECT)		{ btn = BTN_SELECT; 	id = BTN_ID_SELECT; }
						else if (code==XBOX_MENU)		{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
						else if (code==XBOX_MENU1)		{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
						else if (code==XBOX_MENU2)		{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
						else if (code==XBOX_L1)			{ btn = BTN_L1</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 302:2 - Line 307:6), workspace\_unmaintained\rgb30\platform\platform.c (Line 151:8 - Line 156:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup73"><code class="language-c text-sm text-gray-800">		id = BTN_ID_A; }
					else if (code==RAW_B)		{ btn = BTN_B; 			id = BTN_ID_B; }
					else if (code==RAW_X)		{ btn = BTN_X; 			id = BTN_ID_X; }
					else i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 307:2 - Line 315:4), workspace\_unmaintained\rgb30\platform\platform.c (Line 156:2 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup74"><code class="language-c text-sm text-gray-800">==RAW_Y)		{ btn = BTN_Y; 			id = BTN_ID_Y; }
					else if (code==RAW_START)	{ btn = BTN_START; 		id = BTN_ID_START; }
					else if (code==RAW_SELECT)	{ btn = BTN_SELECT; 	id = BTN_ID_SELECT; }
					else if (code==RAW_MENU)	{ btn = BTN</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 339:4 - Line 357:3), workspace\_unmaintained\rgb30\platform\platform.c (Line 147:4 - Line 164:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup75"><code class="language-c text-sm text-gray-800">pad.repeat_at[id]	= tick + PAD_REPEAT_DELAY;
						}
					}
					
					btn = BTN_NONE; // already handled, force continue
				}
				else if (i==kPadIndex) {
					if (pad_type==kGamepadTypeRGP01) {
							 if (code==RGP01_LSX) { pad.laxis.x = ((value-128) * 32767) / 128; PAD_setAnalog(BTN_ID_ANALOG_LEFT, BTN_ID_ANALOG_RIGHT, pad.laxis.x, tick+PAD_REPEAT_DELAY); }
						else if (code==RGP01_LSY) { pad</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 364:2 - Line 369:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 94:2 - Line 172:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup76"><code class="language-c text-sm text-gray-800">f (code==RGP01_RSY) pad.raxis.y = ((value-128) * 32767) / 128;
					}
					else if (pad_type==kGamepadTypeXbox) {
							 if (code==XBOX_LSX) { pad.laxis.x = value; PAD_setAnalog(BTN_ID_ANALOG_LEFT, BTN_ID_ANALOG_RIGHT, pad.laxis.x, tic</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 385:1 - Line 408:33), workspace\_unmaintained\zero28\platform\platform.c (Line 35:1 - Line 57:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup77"><code class="language-c text-sm text-gray-800">e if (code==XBOX_L2) { pressed = value&gt;0; btn = BTN_L2; id = BTN_ID_L2; }
						else if (code==XBOX_R2) { pressed = value&gt;0; btn = BTN_R2; id = BTN_ID_R2; }
					}
				}
				else {
						 if (code==RAW_LSX) { pad.laxis.x = (value * 32767) / 4096; PAD_setAnalog(BTN_ID_ANALOG_LEFT, BTN_ID_ANALOG_RIGHT, pad.laxis.x, tick+PAD_REPEAT_DELAY); }
					else if (code==RAW_LSY) { pad.laxis.y = (value * 32767) / 4096; PAD_setAnalog(BTN_ID_ANALOG_UP,   BTN_I</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 412:6 - Line 446:54), workspace\_unmaintained\rgb30\platform\platform.c (Line 207:2 - Line 241:43)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup78"><code class="language-c text-sm text-gray-800">W_RSY) pad.raxis.y = (value * 32767) / 4096;
				}
			}
			
			if (btn==BTN_NONE) continue;
		
			if (!pressed) {
				pad.is_pressed		&amp;= ~btn; // unset
				pad.just_repeated	&amp;= ~btn; // unset
				pad.just_released	|= btn; // set
			}
			else if ((pad.is_pressed &amp; btn)==BTN_NONE) {
				pad.just_pressed	|= btn; // set
				pad.just_repeated	|= btn; // set
				pad.is_pressed		|= btn; // set
				pad.repeat_at[id]	= tick + PAD_REPEAT_DELAY;
			}
		}
	}
	
	if (lid.has_lid &amp;&amp; PLAT_lidChanged(NULL)) pad.just_released |= BTN_SLEEP;
}

int PLAT_shouldWake(void) {
	int lid_open = 1; // assume open by default
	if (lid.has_lid &amp;&amp; PLAT_lidChanged(&amp;lid_open) &amp;&amp; lid_open) return 1;
	
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		input = inputs[i];
		while (read(input, &amp;event, sizeof(event))==sizeof(event)) {
			if (event.type==EV_KEY &amp;&amp; event.code==RAW_POWER &amp;&amp; event.value==0) {
				// ignore input while lid is closed
				if (lid.has_lid &amp;&amp; !lid.is_open) return 0;  // do it here so we eat the input
				return 1;
			}
		}
	}
	return 0;
}

///////////////////////////////

// based on rgb30 + tg5040 + m17
#define HDMI_STATE_PATH &quot;/sys/class/switch/hdmi/cable.0/state&quot; // TODO: can detect but doesn't update automatically
#define BLANK_PATH &quot;/sys/class/graphics/fb0/blank&quot;

static </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 468:2 - Line 491:3), workspace\_unmaintained\rgb30\platform\platform.c (Line 258:2 - Line 282:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup79"><code class="language-c text-sm text-gray-800">ed SDL version %d.%d.%d ...\n&quot;, compiled.major, compiled.minor, compiled.patch);
	// LOG_info(&quot;Linked SDL version %d.%d.%d.\n&quot;, linked.major, linked.minor, linked.patch);
	//
	// int num_displays = SDL_GetNumVideoDisplays();
	// LOG_info(&quot;SDL_GetNumVideoDisplays(): %i\n&quot;, num_displays);
	//
	// LOG_info(&quot;Available video drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumVideoDrivers(); i++) {
	// 	LOG_info(&quot;- %s\n&quot;, SDL_GetVideoDriver(i));
	// }
	// LOG_info(&quot;Current video driver: %s\n&quot;, SDL_GetCurrentVideoDriver());
	//
	// LOG_info(&quot;Available render drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumRenderDrivers(); i++) {
	// 	SDL_RendererInfo info;
	// 	SDL_GetRenderDriverInfo(i,&amp;info);
	// 	LOG_info(&quot;- %s\n&quot;, info.name);
	// }
	//
	// LOG_info(&quot;Available display modes:\n&quot;);
	// SDL_DisplayMode mode;
	// for (int i=0; i&lt;SDL_GetNumDisplayModes(0); i++) {
	// 	SDL_GetDisplayMode(0, i, &amp;mode);
	// 	LOG_info(&quot;- %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	// }
	// SDL_GetCurrentDisplayMode(0, &amp;mode);
	// LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));

	// SDL_SetHint</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 492:2 - Line 570:58), workspace\_unmaintained\rgb30\platform\platform.c (Line 282:2 - Line 360:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup80"><code class="language-c text-sm text-gray-800">DL_HINT_RENDER_VSYNC,&quot;0&quot;); // ignored

	int w = FIXED_WIDTH;
	int h = FIXED_HEIGHT;
	int p = FIXED_PITCH;
	if (getInt(HDMI_STATE_PATH)) { // can't use getHDMI() from settings because it hasn't be initialized yet
		w = HDMI_WIDTH;
		h = HDMI_HEIGHT;
		p = HDMI_PITCH;
		on_hdmi = 1;
	}
	
	SDL_InitSubSystem(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	vid.window   = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	// LOG_info(&quot;window size: %ix%i\n&quot;, w,h);
	
	SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	if (mode.h&gt;mode.w) rotate = 3; // no longer set on 28xx (because of SDL2 rotation patch?)
	vid.renderer = SDL_CreateRenderer(vid.window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	// SDL_RenderSetLogicalSize(vid.renderer, w,h); // TODO: wrong, but without and with the below it's even wrong-er
	
	// int renderer_width,renderer_height;
	// SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// LOG_info(&quot;output size: %ix%i\n&quot;, renderer_width, renderer_height);
	// if (renderer_width!=w) { // I think this can only be hdmi
	// 	float x_scale = (float)renderer_width / w;
	// 	float y_scale = (float)renderer_height / h;
	// 	SDL_SetWindowSize(vid.window, w / x_scale, h / y_scale);
	//
	// 	SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// 	LOG_info(&quot;adjusted size: %ix%i\n&quot;, renderer_width, renderer_height);
	// 	x_scale = (float)renderer_width / w;
	// 	y_scale = (float)renderer_height / h;
	// 	SDL_RenderSetScale(vid.renderer, x_scale,y_scale);
	//
	// 	// for some reason we need to clear and present
	// 	// after setting the window size or we'll miss
	// 	// the first frame
	// 	SDL_RenderClear(vid.renderer);
	// 	SDL_RenderPresent(vid.renderer);
	// }
	//
	// SDL_RendererInfo info;
	// SDL_GetRendererInfo(vid.renderer, &amp;info);
	// LOG_info(&quot;Current render driver: %s\n&quot;, info.name);
	
	SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY,&quot;1&quot;); // linear
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	vid.target	= NULL; // only needed for non-native sizes
	
	// TODO: doesn't work here
	// SDL_SetTextureScaleMode(vid.texture, SDL_ScaleModeLinear); // we always start at device size so use linear for better upscaling over hdmi
	
	// SD</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 571:2 - Line 767:8), workspace\_unmaintained\zero28\platform\platform.c (Line 179:2 - Line 378:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup81"><code class="language-c text-sm text-gray-800">ScaleMode scale_mode;
	// SDL_GetTextureScaleMode(vid.texture, &amp;scale_mode);
	// LOG_info(&quot;texture scale mode: %i\n&quot;, scale_mode);
	
	// int format;
	// int access_;
	// SDL_QueryTexture(vid.texture, &amp;format, &amp;access_, NULL,NULL);
	// LOG_info(&quot;texture format: %s (streaming: %i)\n&quot;, SDL_GetPixelFormatName(format), access_==SDL_TEXTUREACCESS_STREAMING);
	
	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	vid.screen	= SDL_CreateRGBSurface(SDL_SWSURFACE, w,h, FIXED_DEPTH, RGBA_MASK_565);
	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
	
	device_width	= w;
	device_height	= h;
	device_pitch	= p;
	
	vid.sharpness = SHARPNESS_SOFT;
	
	return vid.screen;
}

static void clearVideo(void) {
	SDL_FillRect(vid.screen, NULL, 0);
	for (int i=0; i&lt;3; i++) {
		SDL_RenderClear(vid.renderer);
		SDL_RenderPresent(vid.renderer);
	}
}

void PLAT_quitVideo(void) {
	// clearVideo();

	SDL_FreeSurface(vid.screen);
	SDL_FreeSurface(vid.buffer);
	if (vid.target) SDL_DestroyTexture(vid.target);
	if (vid.effect) SDL_DestroyTexture(vid.effect);
	SDL_DestroyTexture(vid.texture);
	SDL_DestroyRenderer(vid.renderer);
	SDL_DestroyWindow(vid.window);

	// system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
	SDL_Quit();
}

void PLAT_clearVideo(SDL_Surface* screen) {
	SDL_FillRect(screen, NULL, 0); // TODO: revisit
}
void PLAT_clearAll(void) {
	PLAT_clearVideo(vid.screen); // TODO: revist
	SDL_RenderClear(vid.renderer);
}

void PLAT_setVsync(int vsync) {
	// buh
}

static int hard_scale = 4; // TODO: base src size, eg. 160x144 can be 4

static void resizeVideo(int w, int h, int p) {
	if (w==vid.width &amp;&amp; h==vid.height &amp;&amp; p==vid.pitch) return;
	
	// TODO: minarch disables crisp (and nn upscale before linear downscale) when native
	
	if (w&gt;=device_width &amp;&amp; h&gt;=device_height) hard_scale = 1;
	else if (h&gt;=160) hard_scale = 2; // limits gba and up to 2x (seems sufficient for 640x480)
	else hard_scale = 4;

	LOG_info(&quot;resizeVideo(%i,%i,%i) hard_scale: %i crisp: %i\n&quot;,w,h,p, hard_scale,vid.sharpness==SHARPNESS_CRISP);

	SDL_FreeSurface(vid.buffer);
	SDL_DestroyTexture(vid.texture);
	if (vid.target) SDL_DestroyTexture(vid.target);
	
	SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, vid.sharpness==SHARPNESS_SOFT?&quot;1&quot;:&quot;0&quot;, SDL_HINT_OVERRIDE);
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, &quot;1&quot;, SDL_HINT_OVERRIDE);
		vid.target = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_TARGET, w * hard_scale,h * hard_scale);
	}
	else {
		vid.target = NULL;
	}

	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);

	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int p) {
	resizeVideo(w,h,p);
	return vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y, int width, int height) {
	// buh
}
void PLAT_setNearestNeighbor(int enabled) {
	// buh
}
void PLAT_setSharpness(int sharpness) {
	if (vid.sharpness==sharpness) return;
	int p = vid.pitch;
	vid.pitch = 0;
	vid.sharpness = sharpness;
	resizeVideo(vid.width,vid.height,p);
}

static struct FX_Context {
	int scale;
	int type;
	int color;
	int next_scale;
	int next_type;
	int next_color;
	int live_type;
} effect = {
	.scale = 1,
	.next_scale = 1,
	.type = EFFECT_NONE,
	.next_type = EFFECT_NONE,
	.live_type = EFFECT_NONE,
	.color = 0,
	.next_color = 0,
};
static void rgb565_to_rgb888(uint32_t rgb565, uint8_t *r, uint8_t *g, uint8_t *b) {
    // Extract the red component (5 bits)
    uint8_t red = (rgb565 &gt;&gt; 11) &amp; 0x1F;
    // Extract the green component (6 bits)
    uint8_t green = (rgb565 &gt;&gt; 5) &amp; 0x3F;
    // Extract the blue component (5 bits)
    uint8_t blue = rgb565 &amp; 0x1F;

    // Scale the values to 8-bit range
    *r = (red &lt;&lt; 3) | (red &gt;&gt; 2);
    *g = (green &lt;&lt; 2) | (green &gt;&gt; 4);
    *b = (blue &lt;&lt; 3) | (blue &gt;&gt; 2);
}
static void updateEffect(void) {
	if (effect.next_scale==effect.scale &amp;&amp; effect.next_type==effect.type &amp;&amp; effect.next_color==effect.color) return; // unchanged
	
	int live_scale = effect.scale;
	int live_color = effect.color;
	effect.scale = effect.next_scale;
	effect.type = effect.next_type;
	effect.color = effect.next_color;
	
	if (effect.type==EFFECT_NONE) return; // disabled
	if (effect.type==effect.live_type &amp;&amp; effect.scale==live_scale &amp;&amp; effect.color==live_color) return; // already loaded
	
	char* effect_path;
	int opacity = 128; // 1 - 1/2 = 50%
	if (effect.type==EFFECT_LINE) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/line-2.png&quot;;
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/line-3.png&quot;;
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/line-4.png&quot;;
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/line-5.png&quot;;
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/line-6.png&quot;;
		}
		else {
			effect_path = RES_PATH &quot;/line-8.png&quot;;
		}
	}
	else if (effect.type==EFFECT_GRID) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/grid-2.png&quot;;
			opacity = 64; // 1 - 3/4 = 25%
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/grid-3.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/grid-4.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/grid-5.png&quot;;
			opacity = 160; // 1 - 9/25 = ~64%
		}
		else if (effect.scale&lt;8</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 772:13 - Line 831:4), workspace\_unmaintained\zero28\platform\platform.c (Line 381:2 - Line 440:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup82"><code class="language-c text-sm text-gray-800">ity: %i\n&quot;, effect_path, opacity);
	SDL_Surface* tmp = IMG_Load(effect_path);
	if (tmp) {
		if (effect.type==EFFECT_GRID) {
			if (effect.color) {
				// LOG_info(&quot;dmg color grid...\n&quot;);
			
				uint8_t r,g,b;
				rgb565_to_rgb888(effect.color,&amp;r,&amp;g,&amp;b);
				// LOG_info(&quot;rgb %i,%i,%i\n&quot;,r,g,b);
				
				uint32_t* pixels = (uint32_t*)tmp-&gt;pixels;
				int width = tmp-&gt;w;
				int height = tmp-&gt;h;
				for (int y = 0; y &lt; height; ++y) {
				    for (int x = 0; x &lt; width; ++x) {
				        uint32_t pixel = pixels[y * width + x];
				        uint8_t _,a;
				        SDL_GetRGBA(pixel, tmp-&gt;format, &amp;_, &amp;_, &amp;_, &amp;a);
				        if (a) pixels[y * width + x] = SDL_MapRGBA(tmp-&gt;format, r,g,b, a);
				    }
				}
			}
		}
		
		if (vid.effect) SDL_DestroyTexture(vid.effect);
		vid.effect = SDL_CreateTextureFromSurface(vid.renderer, tmp);
		SDL_SetTextureAlphaMod(vid.effect, opacity);
		SDL_FreeSurface(tmp);
		effect.live_type = effect.type;
	}
	}
void PLAT_setEffect(int next_type) {
	effect.next_type = next_type;
}
void PLAT_setEffectColor(int next_color) {
	effect.next_color = next_color;
}
void PLAT_vsync(int remaining) {
	if (remaining&gt;0) SDL_Delay(remaining);
}

scaler_t PLAT_getScaler(GFX_Renderer* renderer) {
	// LOG_info(&quot;getScaler for scale: %i\n&quot;, renderer-&gt;scale);
	effect.next_scale = renderer-&gt;scale;
	return scale1x1_c16;
}

void PLAT_blitRenderer(GFX_Renderer* renderer) {
	vid.blit = renderer;
	SDL_RenderClear(vid.renderer);
	resizeVideo(vid.blit-&gt;true_w,vid.blit-&gt;true_h,vid.blit-&gt;src_p);
}

void PLAT_flip(SDL_Surface* IGNORED, int ignored) {
	
	on_hdmi = GetHDMI(); // use settings instead of getInt(HDMI_STATE_PATH)
	
	if (!vid.blit) {
		resizeVideo(device_width,device_height,FIXED_PITCH); // !!!???
		SDL_UpdateTexture(vid.texture,NULL,vid.screen-&gt;pixels,vid.screen-</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 834:8 - Line 839:53), workspace\_unmaintained\zero28\platform\platform.c (Line 444:7 - Line 449:97)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup83"><code class="language-c text-sm text-gray-800">L,&amp;(SDL_Rect){0,device_width,device_width,device_height},rotate*90,&amp;(SDL_Point){0,0},SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_RenderPresent(vid.renderer);
		return;
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_UpdateTexture(vid.texture,NULL,vid.blit-&gt;src,vid.blit-&gt;src_p);
	// LOG_info(&quot;blit blocked</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 844:8 - Line 854:10), workspace\_unmaintained\zero28\platform\platform.c (Line 450:7 - Line 630:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup84"><code class="language-c text-sm text-gray-800">_h;
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetRenderTarget(vid.renderer,vid.target);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_SetRenderTarget(vid.renderer,NULL);
		x *= hard_scale;
		y *= hard_scale;
		w *= hard_scale;
		h *= hard_scale;
		target = vid.target;
	}
	
	SDL_Rect* src_rect = &amp;(SDL_Rect){x,y,w,h};
	SDL_Rect* dst_rect = &amp;(SDL_Rect){0,0,device_width,device_height};
	if (vid.blit-&gt;aspect==0) { // native or cropped
		// LOG_info(&quot;src_rect %i,%i %ix%i\n&quot;,src_rect-&gt;x</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 854:10 - Line 905:58), workspace\_unmaintained\zero28\platform\platform.c (Line 456:5 - Line 509:61)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup85"><code class="language-c text-sm text-gray-800">,src_rect-&gt;y,src_rect-&gt;w,src_rect-&gt;h);

		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h * vid.blit-&gt;scale;
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
		
		// LOG_info(&quot;dst_rect %i,%i %ix%i\n&quot;,dst_rect-&gt;x,dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h);
	}
	else if (vid.blit-&gt;aspect&gt;0) { // aspect
		int h = device_height;
		int w = h * vid.blit-&gt;aspect;
		if (w&gt;device_width) {
			double ratio = 1 / vid.blit-&gt;aspect;
			w = device_width;
			h = w * ratio;
		}
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		// dst_rect = &amp;(SDL_Rect){x,y,w,h};
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
	}
	
	int ox,oy;
	oy = (device_width-device_height)/2;
	ox = -oy;
	if (rotate &amp;&amp; !on_hdmi) SDL_RenderCopyEx(vid.renderer,target,src_rect,&amp;(SDL_Rect){ox+dst_rect-&gt;x,oy+dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h},rotate*90,NULL,SDL_FLIP_NONE);
	else SDL_RenderCopy(vid.renderer, target, src_rect, dst_rect);
	
	updateEffect();
	if (vid.blit &amp;&amp; effect.type!=EFFECT_NONE &amp;&amp; vid.effect) {
		// ox = effect.scale - (dst_rect-&gt;x % effect.scale);
		// oy = effect.scale - (dst_rect-&gt;y % effect.scale);</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 903:51 - Line 913:3), workspace\_unmaintained\rgb30\platform\platform.c (Line 679:43 - Line 517:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup86"><code class="language-c text-sm text-gray-800">scale);
		// oy = effect.scale - (dst_rect-&gt;y % effect.scale);
		// if (ox==effect.scale) ox = 0;
		// if (oy==effect.scale) oy = 0;
		// LOG_info(&quot;rotate: %i ox: %i oy: %i\n&quot;, rotate, ox,oy);
		if (rotate &amp;&amp; !on_hdmi) S</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 921:2 - Line 931:7), workspace\_unmaintained\zero28\platform\platform.c (Line 526:19 - Line 536:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup87"><code class="language-c text-sm text-gray-800">ffect, &amp;(SDL_Rect){0,0,dst_rect-&gt;w,dst_rect-&gt;h},dst_rect);
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_RenderPresent(vid.renderer);
	// LOG_info(&quot;SDL_Rend</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 957:1 - Line 965:59), workspace\_unmaintained\rgb30\platform\platform.c (Line 721:1 - Line 729:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup88"><code class="language-c text-sm text-gray-800">eRGBSurface(SDL_SWSURFACE, SCALE2(OVERLAY_WIDTH,OVERLAY_HEIGHT),OVERLAY_DEPTH,OVERLAY_RGBA_MASK);
	return ovl.overlay;
}
void PLAT_quitOverlay(void) {
	if (ovl.overlay) SDL_FreeSurface(ovl.overlay</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 15:1 - Line 44:34), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 14:1 - Line 45:68)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup89"><code class="language-c text-sm text-gray-800">o.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
	int hdmi; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 47:1 - Line 121:5), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 50:1 - Line 123:30)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup90"><code class="language-c text-sm text-gray-800">.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
	.hdmi = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

#define JACK_STATE_PATH &quot;/sys/module/snd_soc_sunxi_component_jack/parameters/jack_state&quot; // TODO: doesn't change, always 0
#define HDMI_STATE_PATH &quot;/sys/class/switch/hdmi/cable.0/state&quot;

int getInt(char* path) {
	int i = 0;
	FILE *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}

void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // should always be keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) {
			read(fd, settings, shm_size);
			// TODO: use settings-&gt;version for future proofing?
			close(fd);
		}
		else {
			// load defaults
			memcpy(settings, &amp;DefaultSettings, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
		// settings-&gt;hdmi = 0;
	}
	
	int jack = getInt(JACK_STATE_PATH);
	int hdmi = getInt(HDMI_STATE_PATH);
	printf(&quot;brightness: %i (hdmi: %i)\nspeaker: %i (jack: %i)\n&quot;, settings-&gt;brightness, hdmi, settings-&gt;speaker, jack); fflush(stdout);
	
	// both of these set volume
	SetJack(jack);
	SetHDMI(hdmi);
	
	SetBrightness(GetBrightness());
	// system(&quot;echo $(&lt; &quot; BRI</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 121:3 - Line 157:7), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 124:3 - Line 158:58)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup91"><code class="language-c text-sm text-gray-800"> BRIGHTNESS_PATH &quot;)&quot;);
}
void QuitSettings(void) {
	munmap(settings, shm_size);
	if (is_host) shm_unlink(SHM_KEY);
}
static inline void SaveSettings(void) {
	int fd = open(SettingsPath, O_CREAT|O_WRONLY, 0644);
	if (fd&gt;=0) {
		write(fd, settings, shm_size);
		close(fd);
		sync();
	}
}

int GetBrightness(void) { // 0-10
	return settings-&gt;brightness;
}
void SetBrightness(int value) {
	if (settings-&gt;hdmi) return;
	
	int raw;
	switch (value) {
		case  0: raw=  4; break;	//  0
		case  1: raw=  6; break;	//  2
		case  2: raw= 10; break;	//  4
		case  3: raw= 16; break;	//  6
		case  4: raw= 32; break;	// 16
		case  5: raw= 48; break;	// 16
		case  6: raw= 64; break;	// 16
		case  7: raw= 96; break;	// 32
		case  8: raw=128; break;	// 32
		case  9: raw=192; break;	// 64
		case 10: raw=255; break;	// 64
	}
	
	SetRawBrightness(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 157:2 - Line 165:11), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 162:2 - Line 171:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup92"><code class="language-c text-sm text-gray-800">tness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	return settings-&gt;jack ? settings-&gt;headphones : settings-&gt;speaker;
}
void SetVolume(int value) {
	if (settings-&gt;hdmi) return;
	
	if (settings-&gt;jack) settings</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 184:2 - Line 195:9), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 184:2 - Line 195:82)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup93"><code class="language-c text-sm text-gray-800">tf(&quot;SetRawVolume(%i)\n&quot;, val); fflush(stdout);
	char cmd[256];
	sprintf(cmd, &quot;amixer sset 'lineout volume' %i%% &gt; /dev/null 2&gt;&amp;1&quot;, val);
	// // puts(cmd); fflush(stdout);
	system(cmd);
}

// monitored and set by thread in keymon
int GetJack(void) {
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 195:2 - Line 201:2), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 197:2 - Line 203:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup94"><code class="language-c text-sm text-gray-800">oid) {
	return settings-&gt;jack;
}
void SetJack(int value) {
	// printf(&quot;SetJack(%i)\n&quot;, value); fflush(stdout);
	
	// char cmd[256];
	// sprintf(cmd, &quot;amixer cset na</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 37:8 - Line 50:10), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 41:2 - Line 48:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup95"><code class="language-c text-sm text-gray-800">ttings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;

// #include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MAX 		20
#define BRIGHTNESS_MI</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 59:3 - Line 70:13), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 66:3 - Line 78:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup96"><code class="language-c text-sm text-gray-800">E_MINUS		114

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define REPEAT		2

static int	input_fd = 0;
static struct input_event ev;

static pthread_t hdmi_pt;
#define HDMI_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 73:20 - Line 99:31), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 87:17 - Line 83:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup97"><code class="language-c text-sm text-gray-800"> *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}

static void* watchHDMI(void *arg) {
	int has_hdmi,had_hdmi;
	
	has_hdmi = had_hdmi = getInt(HDMI_STATE_PATH);
	SetHDMI(has_hdmi);
	
	while(1) {
		sleep(1);
		
		has_hdmi = getInt(HDMI_STATE_PATH);
		if (had_hdmi!=has_hdmi) {
			had_hdmi = has_hdmi;
			SetHDMI(has_hdmi);
		}
	}
	
	return 0;
}

int main (int argc, char *argv[]) {
	InitSettings();
	pthread_create(&amp;hdmi_pt, NULL, &amp;watchHDMI, NULL);
	
	input_fd = open(&quot;/dev/input/event1&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	
	uint32_t i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 102:9 - Line 107:60), workspace\_unmaintained\zero28\keymon\keymon.c (Line 87:6 - Line 121:65)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup98"><code class="language-c text-sm text-gray-800">ed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0;
	uint32_t down_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint8_t ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 108:4 - Line 126:3), workspace\_unmaintained\zero28\keymon\keymon.c (Line 99:5 - Line 116:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup99"><code class="language-c text-sm text-gray-800">ttimeofday(&amp;tod, NULL);
	then = tod.tv_sec * 1000 + tod.tv_usec / 1000; // essential SDL_GetTicks()
	ignore = 0;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		// TODO: check if if necessary
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		while(read(input_fd, &amp;ev, sizeof(ev))==s</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 123:4 - Line 136:46), workspace\_unmaintained\zero28\keymon\keymon.c (Line 115:4 - Line 128:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup100"><code class="language-c text-sm text-gray-800">izeof(ev))==sizeof(ev)) {
			if (ignore) continue;
			val = ev.value;

			if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
			// printf(&quot;code: %i (%i)\n&quot;, ev.code, val); fflush(stdout);
			switch (ev.code) {
				case CODE_MENU:
					menu_pressed = val;
				break;
				break;
				case CODE_PLUS:
					u</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 142:5 - Line 152:48), workspace\_unmaintained\zero28\keymon\keymon.c (Line 134:5 - Line 144:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup101"><code class="language-c text-sm text-gray-800">d = val;
					if (val) down_repeat_at = now + 300;
				break;
				default:
				break;
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		if (up_just_pressed || (up_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 158:5 - Line 171:2), workspace\_unmaintained\zero28\keymon\keymon.c (Line 150:5 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup102"><code class="language-c text-sm text-gray-800">BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else {
				// printf(&quot;volume up\n&quot;); fflush(stdout);
				val = GetVolume();
				if (val&lt;VOLUME_MAX) SetVolume(++val);
			}
			
			if (up_just_pressed) up_just_pressed = 0;
</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\platform\platform.c (Line 356:2 - Line 365:4), workspace\_unmaintained\rg35xx\platform\platform.c (Line 311:2 - Line 320:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup103"><code class="language-c text-sm text-gray-800">E(0)/4]&gt;&gt;16)+1;
	
	vid.de_mem[DE_OVL_ISIZE(0)/4] = vid.de_mem[DE_OVL_ISIZE(2)/4] = ((vid.width-1) &amp; 0xFFFF) | ((vid.height-1) &lt;&lt; 16);
	vid.de_mem[DE_OVL_SR(0)/4] = vid.de_mem[DE_OVL_SR(2)/4] = ((0x2000*vid.width/vw)&amp;0xFFFF) | ((0x2000*vid.height/vh)&lt;&lt;16);
	vid.de_mem[DE_OVL_STR(0)/4] = vid.de_mem[DE_OVL_STR(2)/4] = vid.pitch / 8;
	vid.de_mem[DE_OVL_BA0(0)/4] = (uintptr_t)(vid.fb_info.padd + PAGE_SIZE);
	
	GFX_setNearestNeighbor(0); // false?  
	
	return vid.screen;
}

void PLAT_quitVideo(void) {
	ion_free(vid.fd_ion, &amp;vid.fb_info);
	munmap(vid.de_mem, DE_SIZE);
	close(vid.fd_mem);
	close(vid.fd_ion);
	clo</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\platform\platform.c (Line 415:2 - Line 426:3), workspace\_unmaintained\trimuismart\platform\platform.c (Line 316:2 - Line 327:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup104"><code class="language-c text-sm text-gray-800">nt height) {
	DE_setRect(vid.de_mem, x,y,width,height);
}

void PLAT_setNearestNeighbor(int enabled) {
	int scale_coef = enabled ? DE_SCOEF_NONE : DE_SCOEF_HALF_ZOOMOUT;
	DE_setScaleCoef(vid.de_mem, 0, scale_coef);
	DE_setScaleCoef(vid.de_mem, 1, scale_coef);
	DE_setScaleCoef(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\platform\platform.c (Line 530:1 - Line 544:2), workspace\_unmaintained\zero28\platform\platform.c (Line 486:1 - Line 501:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup105"><code class="language-c text-sm text-gray-800">rlay-&gt;w;
	x = FIXED_WIDTH - SCALE1(PADDING) - w;
	y = SCALE1(PADDING);
	
	ovl.oinfo.mem_off = (uintptr_t)ovl.ov_info.padd - vid.finfo.smem_start;
	ovl.oinfo.mem_size = size;
	ovl.oinfo.screen_width = PAGE_WIDTH; // ???
	ovl.oinfo.color_mode = OWL_DSS_COLOR_ARGB32;
	ovl.oinfo.img_width = w;
	ovl.oinfo.img_height = h;
	ovl.oinfo.xoff = 0;
	ovl.oinfo.yoff = 0;
	ovl.oinfo.width = w;
	ovl.oinfo.height = h;
	ovl.oinfo.rotation = 0;
	ovl.oinfo.pos_x = x;	// position
	o</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\platform\platform.c (Line 555:44 - Line 568:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 688:42 - Line 702:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup106"><code class="language-c text-sm text-gray-800">VERLAY_ENABLE, &amp;ovl.oargs)&lt;0) printf(&quot;ENABLE failed %s\n&quot;,strerror(errno));
	DE_enableLayer(vid.de_mem); // we don't want it to show immediately
	
	return ovl.overlay;
}
void PLAT_quitOverlay(void) {
	if (ovl.overlay) SDL_Free</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\platform\platform.c (Line 567:11 - Line 577:8), workspace\_unmaintained\trimuismart\platform\platform.c (Line 504:2 - Line 515:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup107"><code class="language-c text-sm text-gray-800">FreeSurface(ovl.overlay);
	ion_free(vid.fd_ion, &amp;ovl.ov_info);

	memset(&amp;ovl.oargs, 0, sizeof(struct owlfb_overlay_args));
	ovl.oargs.fb_id = OVERLAY_FB;
	ovl.oargs.overlay_id = OVERLAY_ID;
	ovl.oargs.overlay_type = OWLFB_OVERLAY_VIDEO;
	ovl.oargs</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 21:2 - Line 28:2), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 23:2 - Line 30:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup108"><code class="language-c text-sm text-gray-800"> &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int h</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 21:8 - Line 32:2), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 24:5 - Line 33:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup109"><code class="language-c text-sm text-gray-800">h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 28:2 - Line 45:5), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 30:2 - Line 45:68)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup110"><code class="language-c text-sm text-gray-800">eadphones;
	int speaker;
	int unused[2]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
} Settings;
static Settings DefaultSettings = {
	.version = S</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 37:2 - Line 77:10), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 40:2 - Line 76:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup111"><code class="language-c text-sm text-gray-800">hared
	int jack; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

#define BACKLIGHT_PATH &quot;/sys/class/backlight/backlight.2/bl_power&quot;
#define BRIGHTNESS_PATH &quot;/sys/class/backlight/backlight.2/brightness&quot;
#define VOLUME_PATH &quot;/sys/class/volume/value&quot;

void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PRO</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 77:2 - Line 99:5), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 99:2 - Line 122:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup112"><code class="language-c text-sm text-gray-800">size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) {
			read(fd, settings, shm_size);
			// TODO: use settings-&gt;version for future proofing?
			close(fd);
		}
		else {
			// load defaults
			memcpy(settings, &amp;DefaultSettings, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
	}
	printf(&quot;brightness: %i\nspeaker: %i \n&quot;, settings-&gt;brightness, settings-&gt;speaker);
	
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 110:2 - Line 123:2), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 135:2 - Line 127:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup113"><code class="language-c text-sm text-gray-800">gs-&gt;brightness;
}
void SetBrightness(int value) {
	int raw;
	switch (value) {
		case 0: raw=16; break; 		//   0
		case 1: raw=24; break; 		//   8
		case 2: raw=40; break; 		//  16
		case 3: raw=64; break; 		//  24
		case 4: raw=128; break;		//	64
		case 5: raw=192; break;		//  64
		case 6: raw=256; break;		//</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 129:2 - Line 136:10), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 158:2 - Line 165:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup114"><code class="language-c text-sm text-gray-800">68; break;		// 256
		case 10: raw=1024; break;	// 256
	}
	SetRawBrightness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	return settings-&gt;jack ? settings</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 142:1 - Line 163:2), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 145:1 - Line 165:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup115"><code class="language-c text-sm text-gray-800">&gt;headphones = value;
	else settings-&gt;speaker = value;
	
	int raw = value * 2;
	SetRawVolume(raw);
	SaveSettings();
}

void SetRawBrightness(int val) { // 0 - 1024
	// printf(&quot;SetRawBrightness(%i)\n&quot;, val); fflush(stdout);
	int fd = open(BRIGHTNESS_PATH, O_WRONLY);
	if (fd&gt;=0) {
		dprintf(fd,&quot;%d&quot;,val);
		close(fd);
	}
}
void SetRawVolume(int val) { /</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 25:1 - Line 46:15), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 31:1 - Line 50:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup116"><code class="language-c text-sm text-gray-800">#include &lt;stdint.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;dirent.h&gt;
#include &lt;linux/input.h&gt;

#include &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;pthread.h&gt;

#include &quot;defines.h&quot;

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define REPEAT		</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 47:15 - Line 57:2), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 55:9 - Line 66:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup117"><code class="language-c text-sm text-gray-800">ct input_event ev;

static pthread_t ports_pt;

#define JACK_STATE_PATH &quot;/sys/class/switch/h2w/state&quot;
#define BACKLIGHT_PATH &quot;/sys/class/backlight/backlight.2/bl_power&quot;

int getInt(char*</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 67:12 - Line 72:9), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 83:2 - Line 87:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup118"><code class="language-c text-sm text-gray-800">int has_headphones,had_headphones;
	
	has_headphones = had_headphones = getInt(JACK_STATE_PATH);
	SetJack(has_headphones);
	
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 75:2 - Line 105:7), workspace\_unmaintained\zero28\keymon\keymon.c (Line 61:2 - Line 121:65)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup119"><code class="language-c text-sm text-gray-800">(had_headphones!=has_headphones) {
			had_headphones = has_headphones;
			SetJack(has_headphones);
		}
	}
	
	return 0;
}

int main (int argc, char *argv[]) {
	InitSettings();
	pthread_create(&amp;ports_pt, NULL, &amp;watchPorts, NULL);
	
	char path[32];
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		sprintf(path, &quot;/dev/input/event%i&quot;, i);
		inputs[i] = open(path, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	}
	
	uint32_t input;
	uint32_t val;
	uint32_t menu_pressed = 0;
	uint32_t power_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0;
	uint32_t down_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint8_t ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	
	gettimeofday(&amp;tod, NULL);
	then = tod.t</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 110:2 - Line 128:14), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 125:2 - Line 120:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup120"><code class="language-c text-sm text-gray-800">LL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		for (int i=0; i&lt;INPUT_COUNT; i++) {
			input = inputs[i];
			while(read(input, &amp;ev, sizeof(ev))==sizeof(ev)) {
				if (ignore) continue;
				val = ev.value;
				if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
				</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 128:2 - Line 168:2), workspace\_unmaintained\zero28\keymon\keymon.c (Line 119:2 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup121"><code class="language-c text-sm text-gray-800">witch (ev.code) {
					case CODE_MENU:
						menu_pressed = val;
					break;
					case CODE_POWER:
						power_pressed = val;
					break;
					case CODE_PLUS:
						up_pressed = up_just_pressed = val;
						if (val) up_repeat_at = now + 300;
					break;
					case CODE_MINUS:
						down_pressed = down_just_pressed = val;
						if (val) down_repeat_at = now + 300;
					break;
					default:
					break;
				}
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			power_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else {
				val = GetVolume();
				if (val&lt;VOLUME_MAX) SetVolume(++val);
			}
			
			if (up_j</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\show\show.c (Line 1:1 - Line 63:2), workspace\_unmaintained\rg35xxplus\show\show.c (Line 1:1 - Line 63:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup122"><code class="language-c text-sm text-gray-800">// rg35xxplus
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;SDL2/SDL.h&gt;
#include &lt;SDL2/SDL_image.h&gt;

#define FIXED_BPP		2
#define FIXED_DEPTH		(FIXED_BPP * 8)

#define RGBA_MASK_565	0xF800, 0x07E0, 0x001F, 0x0000

int main(int argc , char* argv[]) {
	if (argc&lt;2) {
		puts(&quot;Usage: show.elf image.png delay&quot;);
		return 0;
	}
	
	char path[256];
	strncpy(path,argv[1],256);
	if (access(path, F_OK)!=0) return 0; // nothing to show :(
	
	int delay = argc&gt;2 ? atoi(argv[2]) : 2;
	
	SDL_Init(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	int w = 0;
	int h = 0;
	int p = 0;
	SDL_Window* window = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	
	int rotate = 0;
	SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	if (mode.h&gt;mode.w) rotate = 3;
	w = mode.w;
	h = mode.h;
	p = mode.w * FIXED_BPP;
	
	SDL_Renderer* renderer = SDL_CreateRenderer(window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	SDL_Texture* texture = SDL_CreateTexture(renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	SDL_Surface* screen = SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	
	SDL_LockTexture(texture,NULL,&amp;screen-&gt;pixels,&amp;screen-&gt;pitch);
	SDL_FillRect(screen, NULL, 0);
	SDL_Surface* img = IMG_Load(path);
	SDL_BlitSurface(img, NULL, screen, &amp;(SDL_Rect){(screen-&gt;w-img-&gt;w)/2,(screen-&gt;h-img-&gt;h)/2});
	SDL_FreeSurface(img);
	SDL_UnlockTexture(texture);

	if (rotate) SDL_RenderCopyEx(renderer,texture,NULL,&amp;(SDL_Rect){0,w,w,h},rotate*90,&amp;(SDL_Point){0,0},SDL_FLIP_NONE);
	else SDL_RenderCopy(renderer, texture, NULL,NULL</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 27:1 - Line 42:32), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 114:1 - Line 129:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup123"><code class="language-c text-sm text-gray-800">e &lt;sys/mman.h&gt;

#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;pthread.h&gt;

#include &lt;msettings.h&gt;

#include &quot;defines.h&quot;
#include &quot;platform.h&quot;
#include &quot;api.h&quot;
#include &quot;utils.h&quot;

#include &quot;scaler.h&quot;

int on_hdmi = 0;

///////////////////////////////

#define LID_PATH &quot;/sys/devices/pla</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 42:1 - Line 59:4), workspace\_unmaintained\zero28\platform\platform.c (Line 21:1 - Line 35:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup124"><code class="language-c text-sm text-gray-800">fine LID_PATH &quot;/sys/devices/platform/hall-mh248/hallvalue&quot; // 1 open, 0 closed
void PLAT_initLid(void) {
	lid.has_lid = exists(LID_PATH);
}
int PLAT_lidChanged(int* state) {
	if (lid.has_lid) {
		int lid_open = getInt(LID_PATH);
		if (lid_open!=lid.is_open) {
			lid.is_open = lid_open;
			if (state) *state = li</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 65:1 - Line 88:9), workspace\_unmaintained\zero28\platform\platform.c (Line 35:1 - Line 57:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup125"><code class="language-c text-sm text-gray-800">put(void) {
	SDL_InitSubSystem(SDL_INIT_JOYSTICK);
	joystick = SDL_JoystickOpen(0);
}
void PLAT_quitInput(void) {
	SDL_JoystickClose(joystick);
	SDL_QuitSubSystem(SDL_INIT_JOYSTICK);
}

///////////////////////////////

#define BLANK_PATH &quot;/sys/class/backlight/backlight/bl_power&quot;
#define HDMI_STATE_PATH &quot;/sys/class/drm/card0-HDMI-A-1/status&quot;

static int HDMI_enabled(void) {
	char value[64];
	getFile(HDMI_STATE_PATH, value,</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 94:2 - Line 101:4), workspace\_unmaintained\zero28\platform\platform.c (Line 60:2 - Line 67:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup126"><code class="language-c text-sm text-gray-800">e* target;
	SDL_Texture* effect;

	SDL_Surface* buffer;
	SDL_Surface* screen;
	
	GFX_Renderer* blit; // yeesh
	
	int width;
	int height;
	int pitch;
	int sharpness;
} vid;

static int device_width;
static int device_height;
static int device_pitch;
static int rotate = 0;
SDL_Surface*</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 102:13 - Line 124:9), workspace\_unmaintained\zero28\platform\platform.c (Line 65:6 - Line 87:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup127"><code class="language-c text-sm text-gray-800"> is_cubexx = exactMatch(&quot;RGcubexx&quot;, model);
	// is_rg34xx = exactMatch(&quot;RG34xx&quot;, model);
	
	SDL_version compiled;
	SDL_version linked;
	SDL_VERSION(&amp;compiled);
	SDL_GetVersion(&amp;linked);
	LOG_info(&quot;Compiled SDL version %d.%d.%d ...\n&quot;, compiled.major, compiled.minor, compiled.patch);
	LOG_info(&quot;Linked SDL version %d.%d.%d.\n&quot;, linked.major, linked.minor, linked.patch);

	int num_displays = SDL_GetNumVideoDisplays();
	LOG_info(&quot;SDL_GetNumVideoDisplays(): %i\n&quot;, num_displays);

	LOG_info(&quot;Available video drivers:\n&quot;);
	for (int i=0; i&lt;SDL_GetNumVideoDrivers(); i++) {
		LOG_info(&quot;- %s\n&quot;, SDL_GetVideoDriver(i));
	}
	LOG_info(&quot;Current video driver: %s\n&quot;, SDL_GetCurrentVideoDriver())</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 131:2 - Line 144:25), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 451:16 - Line 464:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup128"><code class="language-c text-sm text-gray-800">
	SDL_DisplayMode mode;
	for (int i=0; i&lt;SDL_GetNumDisplayModes(0); i++) {
		SDL_GetDisplayMode(0, i, &amp;mode);
		LOG_info(&quot;- %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	}
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));

	// SDL_SetHint(SDL_HINT_RENDER_VSYNC,&quot;0&quot;); // ignored

	i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 145:2 - Line 172:17), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 465:2 - Line 282:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup129"><code class="language-c text-sm text-gray-800"> w = FIXED_WIDTH;
	int h = FIXED_HEIGHT;
	int p = FIXED_PITCH;
	if (HDMI_enabled()) { // can't use getHDMI() from settings because it hasn't be initialized yet
		w = HDMI_WIDTH;
		h = HDMI_HEIGHT;
		p = HDMI_PITCH;
		on_hdmi = 1;
	}
	
	SDL_InitSubSystem(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	vid.window   = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	// LOG_info(&quot;window size: %ix%i\n&quot;, w,h);
	
	// SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	if (mode.h&gt;mode.w) rotate = 3; // no longer set on 28xx (because of SDL2 rotation patch?)
	vid.renderer = SDL_CreateRenderer(vid.window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	// SDL_RenderSetLogicalSize(vid.renderer, w,h); // TODO: wrong, but without and with the below it's even wrong-er
	
	// int renderer_width,renderer_height;
	// SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// LOG_info(&quot;output size: %ix%i\n&quot;, renderer_width, renderer_height);
	// if (renderer_width!=w) { // I think this can only be hdmi
	// 	float x_scale = (float)renderer_width / w;
	// 	float y_scale = (float)renderer_height / h;
	// 	SDL_SetWindowSize(vid.window, w / x_scale, h / y_scale);
	//
	// 	SDL_GetRendererOutputSize(vid.renderer, &amp;rende</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 176:2 - Line 534:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 286:2 - Line 630:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup130"><code class="language-c text-sm text-gray-800">/ 	x_scale = (float)renderer_width / w;
	// 	y_scale = (float)renderer_height / h;
	// 	SDL_RenderSetScale(vid.renderer, x_scale,y_scale);
	//
	// 	// for some reason we need to clear and present
	// 	// after setting the window size or we'll miss
	// 	// the first frame
	// 	SDL_RenderClear(vid.renderer);
	// 	SDL_RenderPresent(vid.renderer);
	// }

	SDL_RendererInfo info;
	SDL_GetRendererInfo(vid.renderer, &amp;info);
	LOG_info(&quot;Current render driver: %s\n&quot;, info.name);
	
	SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY,&quot;1&quot;); // linear
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	vid.target	= NULL; // only needed for non-native sizes
	
	// TODO: doesn't work here
	// SDL_SetTextureScaleMode(vid.texture, SDL_ScaleModeLinear); // we always start at device size so use linear for better upscaling over hdmi
	
	// SDL_ScaleMode scale_mode;
	// SDL_GetTextureScaleMode(vid.texture, &amp;scale_mode);
	// LOG_info(&quot;texture scale mode: %i\n&quot;, scale_mode);
	
	// int format;
	// int access_;
	// SDL_QueryTexture(vid.texture, &amp;format, &amp;access_, NULL,NULL);
	// LOG_info(&quot;texture format: %s (streaming: %i)\n&quot;, SDL_GetPixelFormatName(format), access_==SDL_TEXTUREACCESS_STREAMING);
	
	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	vid.screen	= SDL_CreateRGBSurface(SDL_SWSURFACE, w,h, FIXED_DEPTH, RGBA_MASK_565);
	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
	
	device_width	= w;
	device_height	= h;
	device_pitch	= p;
	
	vid.sharpness = SHARPNESS_SOFT;
	
	return vid.screen;
}

static void clearVideo(void) {
	SDL_FillRect(vid.screen, NULL, 0);
	for (int i=0; i&lt;3; i++) {
		SDL_RenderClear(vid.renderer);
		SDL_RenderPresent(vid.renderer);
	}
}

void PLAT_quitVideo(void) {
	// clearVideo();

	SDL_FreeSurface(vid.screen);
	SDL_FreeSurface(vid.buffer);
	if (vid.target) SDL_DestroyTexture(vid.target);
	if (vid.effect) SDL_DestroyTexture(vid.effect);
	SDL_DestroyTexture(vid.texture);
	SDL_DestroyRenderer(vid.renderer);
	SDL_DestroyWindow(vid.window);

	// system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
	SDL_Quit();
}

void PLAT_clearVideo(SDL_Surface* screen) {
	SDL_FillRect(screen, NULL, 0); // TODO: revisit
}
void PLAT_clearAll(void) {
	PLAT_clearVideo(vid.screen); // TODO: revist
	SDL_RenderClear(vid.renderer);
}

void PLAT_setVsync(int vsync) {
	// buh
}

static int hard_scale = 4; // TODO: base src size, eg. 160x144 can be 4

static void resizeVideo(int w, int h, int p) {
	if (w==vid.width &amp;&amp; h==vid.height &amp;&amp; p==vid.pitch) return;
	
	// TODO: minarch disables crisp (and nn upscale before linear downscale) when native
	
	if (w&gt;=device_width &amp;&amp; h&gt;=device_height) hard_scale = 1;
	else if (h&gt;=160) hard_scale = 2; // limits gba and up to 2x (seems sufficient for 640x480)
	else hard_scale = 4;

	LOG_info(&quot;resizeVideo(%i,%i,%i) hard_scale: %i crisp: %i\n&quot;,w,h,p, hard_scale,vid.sharpness==SHARPNESS_CRISP);

	SDL_FreeSurface(vid.buffer);
	SDL_DestroyTexture(vid.texture);
	if (vid.target) SDL_DestroyTexture(vid.target);
	
	SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, vid.sharpness==SHARPNESS_SOFT?&quot;1&quot;:&quot;0&quot;, SDL_HINT_OVERRIDE);
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, &quot;1&quot;, SDL_HINT_OVERRIDE);
		vid.target = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_TARGET, w * hard_scale,h * hard_scale);
	}
	else {
		vid.target = NULL;
	}

	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);

	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int p) {
	resizeVideo(w,h,p);
	return vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y, int width, int height) {
	// buh
}
void PLAT_setNearestNeighbor(int enabled) {
	// buh
}
void PLAT_setSharpness(int sharpness) {
	if (vid.sharpness==sharpness) return;
	int p = vid.pitch;
	vid.pitch = 0;
	vid.sharpness = sharpness;
	resizeVideo(vid.width,vid.height,p);
}

static struct FX_Context {
	int scale;
	int type;
	int color;
	int next_scale;
	int next_type;
	int next_color;
	int live_type;
} effect = {
	.scale = 1,
	.next_scale = 1,
	.type = EFFECT_NONE,
	.next_type = EFFECT_NONE,
	.live_type = EFFECT_NONE,
	.color = 0,
	.next_color = 0,
};
static void rgb565_to_rgb888(uint32_t rgb565, uint8_t *r, uint8_t *g, uint8_t *b) {
    // Extract the red component (5 bits)
    uint8_t red = (rgb565 &gt;&gt; 11) &amp; 0x1F;
    // Extract the green component (6 bits)
    uint8_t green = (rgb565 &gt;&gt; 5) &amp; 0x3F;
    // Extract the blue component (5 bits)
    uint8_t blue = rgb565 &amp; 0x1F;

    // Scale the values to 8-bit range
    *r = (red &lt;&lt; 3) | (red &gt;&gt; 2);
    *g = (green &lt;&lt; 2) | (green &gt;&gt; 4);
    *b = (blue &lt;&lt; 3) | (blue &gt;&gt; 2);
}
static void updateEffect(void) {
	if (effect.next_scale==effect.scale &amp;&amp; effect.next_type==effect.type &amp;&amp; effect.next_color==effect.color) return; // unchanged
	
	int live_scale = effect.scale;
	int live_color = effect.color;
	effect.scale = effect.next_scale;
	effect.type = effect.next_type;
	effect.color = effect.next_color;
	
	if (effect.type==EFFECT_NONE) return; // disabled
	if (effect.type==effect.live_type &amp;&amp; effect.scale==live_scale &amp;&amp; effect.color==live_color) return; // already loaded
	
	char* effect_path;
	int opacity = 128; // 1 - 1/2 = 50%
	if (effect.type==EFFECT_LINE) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/line-2.png&quot;;
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/line-3.png&quot;;
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/line-4.png&quot;;
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/line-5.png&quot;;
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/line-6.png&quot;;
		}
		else {
			effect_path = RES_PATH &quot;/line-8.png&quot;;
		}
	}
	else if (effect.type==EFFECT_GRID) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/grid-2.png&quot;;
			opacity = 64; // 1 - 3/4 = 25%
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/grid-3.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/grid-4.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/grid-5.png&quot;;
			opacity = 160; // 1 - 9/25 = ~64%
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/grid-6.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;11) {
			effect_path = RES_PATH &quot;/grid-8.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else {
			effect_path = RES_PATH &quot;/grid-11.png&quot;;
			opacity = 136; // 1 - 57/121 = ~52%
		}
	}
	
	// LOG_info(&quot;effect: %s opacity: %i\n&quot;, effect_path, opacity);
	SDL_Surface* tmp = IMG_Load(effect_path);
	if (tmp) {
		if (effect.type==EFFECT_GRID) {
			if (effect.color) {
				// LOG_info(&quot;dmg color grid...\n&quot;);
			
				uint8_t r,g,b;
				rgb565_to_rgb888(effect.color,&amp;r,&amp;g,&amp;b);
				// LOG_info(&quot;rgb %i,%i,%i\n&quot;,r,g,b);
				
				uint32_t* pixels = (uint32_t*)tmp-&gt;pixels;
				int width = tmp-&gt;w;
				int height = tmp-&gt;h;
				for (int y = 0; y &lt; height; ++y) {
				    for (int x = 0; x &lt; width; ++x) {
				        uint32_t pixel = pixels[y * width + x];
				        uint8_t _,a;
				        SDL_GetRGBA(pixel, tmp-&gt;format, &amp;_, &amp;_, &amp;_, &amp;a);
				        if (a) pixels[y * width + x] = SDL_MapRGBA(tmp-&gt;format, r,g,b, a);
				    }
				}
			}
		}
		
		if (vid.effect) SDL_DestroyTexture(vid.effect);
		vid.effect = SDL_CreateTextureFromSurface(vid.renderer, tmp);
		SDL_SetTextureAlphaMod(vid.effect, opacity);
		SDL_FreeSurface(tmp);
		effect.live_type = effect.type;
	}
	}
void PLAT_setEffect(int next_type) {
	effect.next_type = next_type;
}
void PLAT_setEffectColor(int next_color) {
	effect.next_color = next_color;
}
void PLAT_vsync(int remaining) {
	if (remaining&gt;0) SDL_Delay(remaining);
}

scaler_t PLAT_getScaler(GFX_Renderer* renderer) {
	// LOG_info(&quot;getScaler for scale: %i\n&quot;, renderer-&gt;scale);
	effect.next_scale = renderer-&gt;scale;
	return scale1x1_c16;
}

void PLAT_blitRenderer(GFX_Renderer* renderer) {
	vid.blit = renderer;
	SDL_RenderClear(vid.renderer);
	resizeVideo(vid.blit-&gt;true_w,vid.blit-&gt;true_h,vid.blit-&gt;src_p);
}

void PLAT_flip(SDL_Surface* IGNORED, int ignored) {
	
	on_hdmi = GetHDMI(); // use settings instead of getInt(HDMI_STATE_PATH)
	
	if (!vid.blit) {
		resizeVideo(device_width,device_height,FIXED_PITCH); // !!!???
		SDL_UpdateTexture(vid.texture,NULL,vid.screen-&gt;pixels,vid.screen-&gt;pitch);
		if (rotate &amp;&amp; !on_hdmi) SDL_RenderCopyEx(vid.renderer,vid.texture,NULL,&amp;(SDL_Rect){0,device_width,device_width,device_height},rotate*90,&amp;(SDL_Point){0,0},SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_RenderPresent(vid.renderer);
		return;
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_UpdateTexture(vid.texture,NULL,vid.blit-&gt;src,vid.blit-&gt;src_p);
	// LOG_info(&quot;blit blocked for %ims (%i,%i)\n&quot;, SDL_GetTicks()-then,vid.buffer-&gt;w,vid.buffer-&gt;h);
	
	SDL_Texture* target = vid.texture;
	int x = vid.blit-&gt;src_x;
	int y = vid.blit-&gt;src_y;
	int w = vid.blit-&gt;src_w;
	int h = vid.blit-&gt;src_h;
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetRenderTarget(vid.renderer,vid.target);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_SetRenderTarget(vid.renderer,NULL);
		x *= hard_scale;
		y *= hard_scale;
		w *= hard_scale;
		h *= hard_scale;
		target = vid.target;
	}
	
	SDL_Rect* src_rect = &amp;(SDL_Rect){x,y,w,h};
	SDL_Rect* dst_rect = &amp;(SDL_Rect){0,0,device_width,device_height};
	if (vid.blit-&gt;aspect==0) { // native or cropped
		// LOG_info(&quot;src_rect %i,%i %ix%i\n&quot;,src_rect-&gt;x,src_rect-&gt;y,src_rect-&gt;w,src_rect-&gt;h);

		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h * vid.blit-&gt;scale;
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
		
		// LOG_info(&quot;dst_rect %i,%i %ix%i\n&quot;,dst_rect-&gt;x,dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h);
	}
	else if (vid.blit-&gt;aspect&gt;0) { // aspect
		int h = device_height;
		int w = h * vid.blit-&gt;aspect;
		if (w&gt;device_width) {
			double ratio = 1 / vid.blit-&gt;aspect;
			w = device_width;
			h = w * ratio;
		}
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		// dst_rect = &amp;(SDL_Rect){x,y,w,h};
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
	}
	
	int ox,oy;
	oy = (device_width-device_height)/2;
	ox = -oy;
	if (rotate &amp;&amp; !on_hdmi) SDL_RenderCopyEx(vid.renderer,target,src_rect,&amp;(SDL_Rect){ox+dst_rect-&gt;x,oy+dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h},rotate*90,NULL,SDL_FLIP_NONE);
	else SDL_RenderCopy(vid.renderer, target, src_rect, dst_rect);
	
	updateEffect();
	if (vid.blit &amp;&amp; effect.type!=EFFECT_NONE &amp;&amp; vid.effect) {
		// ox = effect.scale - (dst_rect-&gt;x % effect.scale);
		// oy = effect.scale - (dst_rect-&gt;y % effect.scale);
		// if (ox==effect.scale) ox = 0;
		// if (oy==effect.scale) oy = 0;
		// LOG_info(&quot;rotate: %i ox: %i oy: %i\n&quot;, rotate, ox,oy);
		if (rotate &amp;&amp; !on_hdmi) SDL_RenderCopyEx(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 534:2 - Line 601:4), workspace\_unmaintained\zero28\platform\platform.c (Line 456:5 - Line 921:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup131"><code class="language-c text-sm text-gray-800">vid.renderer,vid.effect,&amp;(SDL_Rect){0,0,dst_rect-&gt;w,dst_rect-&gt;h},&amp;(SDL_Rect){ox+dst_rect-&gt;x,oy+dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h},rotate*90,NULL,SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.effect, &amp;(SDL_Rect){0,0,dst_rect-&gt;w,dst_rect-&gt;h},dst_rect);
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_RenderPresent(vid.renderer);
	// LOG_info(&quot;SDL_RenderPresent blocked for %ims\n&quot;, SDL_GetTicks()-then);
	vid.blit = NULL;
}

int PLAT_supportsOverscan(void) { return 0; }

///////////////////////////////

// TODO: 
#define OVERLAY_WIDTH PILL_SIZE // unscaled
#define OVERLAY_HEIGHT PILL_SIZE // unscaled
#define OVERLAY_BPP 4
#define OVERLAY_DEPTH 16
#define OVERLAY_PITCH (OVERLAY_WIDTH * OVERLAY_BPP) // unscaled
#define OVERLAY_RGBA_MASK 0x00ff0000,0x0000ff00,0x000000ff,0xff000000 // ARGB
static struct OVL_Context {
	SDL_Surface* overlay;
} ovl;

SDL_Surface* PLAT_initOverlay(void) {
	ovl.overlay = SDL_CreateRGBSurface(SDL_SWSURFACE, SCALE2(OVERLAY_WIDTH,OVERLAY_HEIGHT),OVERLAY_DEPTH,OVERLAY_RGBA_MASK);
	return ovl.overlay;
}
void PLAT_quitOverlay(void) {
	if (ovl.overlay) SDL_FreeSurface(ovl.overlay);
}
void PLAT_enableOverlay(int enable) {

}

///////////////////////////////

static int online = 0;
void PLAT_getBatteryStatus(int* is_charging, int* charge) {
	PLAT_getBatteryStatusFine(is_charging, charge);

	// worry less about battery and more about the game you're playing
	     if (*charge&gt;80) *charge = 100;
	else if (*charge&gt;60) *charge =  80;
	else if (*charge&gt;40) *charge =  60;
	else if (*charge&gt;20) *charge =  40;
	else if (*charge&gt;10) *charge =  20;
	else           		 *cha</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 601:4 - Line 611:45), workspace\_unmaintained\zero28\platform\platform.c (Line 526:19 - Line 931:60)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup132"><code class="language-c text-sm text-gray-800">rge =  10;
}

void PLAT_getBatteryStatusFine(int* is_charging, int* charge)
{
	// *is_charging = 0;
	// *charge = PWR_LOW_CHARGE;
	// return;
	
	*is_charging = getInt(&quot;/sys/class/power_supply/ac/online</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 624:2 - Line 643:3), workspace\_unmaintained\zero28\platform\platform.c (Line 547:2 - Line 720:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup133"><code class="language-c text-sm text-gray-800">&quot;/sys/class/leds/work/brightness&quot;
void PLAT_enableBacklight(int enable) {
	if (enable) {
		putInt(BLANK_PATH, FB_BLANK_UNBLANK); // wake
		SetBrightness(GetBrightness());
		putInt(LED_PATH,0);
	}
	else {
		putInt(BLANK_PATH, FB_BLANK_POWERDOWN); // sleep
		SetRawBrightness(0);
		putInt(LED_PATH,255);
	}
}

void PLAT_powerOff(void) {
	system(&quot;rm -f /tmp/nextui_exec &amp;&amp; sync&quot;);
	sleep(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 639:1 - Line 651:5), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 951:1 - Line 963:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup134"><code class="language-c text-sm text-gray-800">(&quot;rm -f /tmp/nextui_exec &amp;&amp; sync&quot;);
	sleep(2);

	SetRawVolume(MUTE_VOLUME_RAW);
	PLAT_enableBacklight(0);
	system(&quot;echo 255 &gt; /sys/class/leds/work/brightness&quot;);
	SND_quit();
	VIB_quit();
	PWR_quit();
	GFX_quit();

	// system(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\platform\platform.c (Line 644:2 - Line 652:13), workspace\_unmaintained\rg35xx\platform\platform.c (Line 590:4 - Line 598:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup135"><code class="language-c text-sm text-gray-800">ass/leds/work/brightness&quot;);
	SND_quit();
	VIB_quit();
	PWR_quit();
	GFX_quit();

	// system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
	//</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 15:1 - Line 53:8), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 14:1 - Line 60:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup136"><code class="language-c text-sm text-gray-800">o.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
	int hdmi; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
	.hdmi = 0,
};
static Settings* settings;

#define SHM_KEY &quot;</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 91:1 - Line 97:5), workspace\_unmaintained\my355\platform\platform.c (Line 59:1 - Line 65:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup137"><code class="language-c text-sm text-gray-800">e) {
	char buffer[8];
	sprintf(buffer, &quot;%d&quot;, value);
	putFile(path, buffer);
}

int exactMatch(char* str1, char* str2) {
	int len1 = str</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 94:2 - Line 129:13), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 57:2 - Line 91:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup138"><code class="language-c text-sm text-gray-800">en1 = strlen(str1);
	if (len1!=strlen(str2)) return 0;
	return (strncmp(str1,str2,len1)==0);
}


#define JACK_STATE_PATH &quot;/sys/class/gpio/gpio150/value&quot;
#define HDMI_STATE_PATH &quot;/sys/class/drm/card0-HDMI-A-1/status&quot;

static int JACK_enabled(void) {
	return !getInt(JACK_STATE_PATH);
}
static int HDMI_enabled(void) {
	char value[64];
	getFile(HDMI_STATE_PATH, value, 64);
	return exactMatch(value, &quot;connected\n&quot;);
}

void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // should always be keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size,</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 130:2 - Line 137:5), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 92:16 - Line 99:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup139"><code class="language-c text-sm text-gray-800">SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) {
			read(fd, settings, shm_size);
			// TODO: use settings-&gt;version for future proofing?
			close(fd);
		}
		else {
			// load d</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 141:2 - Line 166:17), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 97:5 - Line 123:30)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup140"><code class="language-c text-sm text-gray-800"> = 0;
	}
	
	int jack = JACK_enabled();
	int hdmi = HDMI_enabled();
	printf(&quot;brightness: %i (hdmi: %i)\nspeaker: %i (jack: %i)\n&quot;, settings-&gt;brightness, hdmi, settings-&gt;speaker, jack); fflush(stdout);
	
	// both of these set volume
	SetJack(jack);
	SetHDMI(hdmi);
	
	char cmd[256];
	sprintf(cmd, &quot;amixer sset 'Playback Path' '%s' &gt; /dev/null 2&gt;&amp;1&quot;, GetJack() ? &quot;HP&quot; : &quot;SPK&quot;);
	system(cmd);

	SetVolume(GetVolume());
	SetBrightness(GetBrightness());
	// system(&quot;echo $(&lt; &quot; BRIGHTNESS_PATH &quot;)&quot;);
}
void QuitSettings(void) {</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 178:2 - Line 204:7), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 135:2 - Line 158:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup141"><code class="language-c text-sm text-gray-800">
	int raw;
	switch (value) {
		// TODO :revisit
		case  0: raw =   1; break;	// 
		case  1: raw =   6; break;	// 
		case  2: raw =  10; break;	// 
		case  3: raw =  16; break;	// 
		case  4: raw =  32; break;	// 
		case  5: raw =  48; break;	// 
		case  6: raw =  64; break;	// 
		case  7: raw =  96; break;	// 
		case  8: raw = 128; break;	// 
		case  9: raw = 192; break;	// 
		case 10: raw = 255; break;	// 
	}
	
	SetRawBrightness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	re</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\libmsettings\msettings.c (Line 232:2 - Line 258:2), workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 175:2 - Line 203:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup142"><code class="language-c text-sm text-gray-800">e speaker (not headphone as that produces white noise)
		puts(&quot;mute&quot;); fflush(stdout);
	}
	else {
		system(&quot;amixer sset 'Playback Path' 'SPK' &gt; /dev/null 2&gt;&amp;1&quot;);
		puts(&quot;speaker&quot;); fflush(stdout);
	}
	
	char cmd[256];
	sprintf(cmd, &quot;amixer sset 'SPK' %i%% &gt; /dev/null 2&gt;&amp;1&quot;, val);
	puts(cmd); fflush(stdout);
	system(cmd);
}

// monitored and set by thread in keymon
int GetJack(void) {
	// printf(&quot;GetJack() %i\n&quot;, settings-&gt;jack); fflush(stdout);
	return settings-&gt;jack;
}
void SetJack(int value) {
	// printf(&quot;SetJack(%i)\n&quot;, value); fflush(stdout);
	
	// char cmd[256];
	// sprintf(cmd, &quot;amixer cset name='Playback Path' '%s' &amp;&gt; /dev/nu</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\keymon\keymon.c (Line 34:1 - Line 55:4), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 50:1 - Line 65:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup143"><code class="language-c text-sm text-gray-800">lude &lt;fcntl.h&gt;
#include &lt;dirent.h&gt;
#include &lt;linux/input.h&gt;
#include &lt;pthread.h&gt;

#include &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;

// #include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MAX 		20
#define BRIGHTNESS_MIN 	0
#define BRIGHTNESS_MAX 	10

// uses different codes from SDL
#define CODE_MENU		1
#define CODE_PLUS		115
#define CODE_MINUS		114

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define R</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\keymon\keymon.c (Line 54:1 - Line 61:9), workspace\_unmaintained\my355\libmsettings\msettings.c (Line 76:1 - Line 88:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup144"><code class="language-c text-sm text-gray-800">ine REPEAT		2

int getInt(char* path) {
	int i = 0;
	FILE *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}
voi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\keymon\keymon.c (Line 68:1 - Line 77:5), workspace\_unmaintained\my355\libmsettings\msettings.c (Line 88:1 - Line 65:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup145"><code class="language-c text-sm text-gray-800">le = fopen(path, &quot;r&quot;);
	if (file) {
		fseek(file, 0L, SEEK_END);
		size_t size = ftell(file);
		if (size&gt;buffer_size-1) size = buffer_size - 1;
		rewind(file);
		fread(buffer, sizeof(char), size, file);
		fclose</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\keymon\keymon.c (Line 95:2 - Line 107:9), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 66:16 - Line 71:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup146"><code class="language-c text-sm text-gray-800">m/card0-HDMI-A-1/status&quot;

static int JACK_enabled(void) {
	return !getInt(JACK_STATE_PATH);
}
static int HDMI_enabled(void) {
	char value[64];
	getFile(HDMI_STATE_PATH, value, 64</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\keymon\keymon.c (Line 98:9 - Line 109:9), workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 55:15 - Line 66:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup147"><code class="language-c text-sm text-gray-800">JACK_STATE_PATH);
}
static int HDMI_enabled(void) {
	char value[64];
	getFile(HDMI_STATE_PATH, value, 64);
	return exactMatch(value, &quot;connected</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my355\keymon\keymon.c (Line 109:20 - Line 207:2), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 87:17 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup148"><code class="language-c text-sm text-gray-800">Ports(void *arg) {
	int has_jack,had_jack;
	had_jack = had_jack = JACK_enabled();
	SetJack(has_jack);

	int has_hdmi,had_hdmi;
	has_hdmi = had_hdmi = HDMI_enabled();
	SetHDMI(has_hdmi);
	
	while(1) {
		sleep(1);

		has_jack = JACK_enabled();
		if (had_jack!=has_jack) {
			had_jack = has_jack;
			SetJack(has_jack);
		}
		
		has_hdmi = HDMI_enabled();
		if (had_hdmi!=has_hdmi) {
			had_hdmi = has_hdmi;
			SetHDMI(has_hdmi);
		}
	}
	
	return 0;
}

int main (int argc, char *argv[]) {
	InitSettings();
	pthread_create(&amp;ports_pt, NULL, &amp;watchPorts, NULL);
	
	input_fd = open(&quot;/dev/input/event0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	
	uint32_t input;
	uint32_t val;
	uint32_t menu_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0;
	uint32_t down_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint8_t ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	
	gettimeofday(&amp;tod, NULL);
	then = tod.tv_sec * 1000 + tod.tv_usec / 1000; // essential SDL_GetTicks()
	ignore = 0;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		// TODO: check if if necessary
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		while(read(input_fd, &amp;ev, sizeof(ev))==sizeof(ev)) {
			if (ignore) continue;
			val = ev.value;

			if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
			// printf(&quot;code: %i (%i)\n&quot;, ev.code, val); fflush(stdout);
			switch (ev.code) {
				case CODE_MENU:
					menu_pressed = val;
				break;
				break;
				case CODE_PLUS:
					up_pressed = up_just_pressed = val;
					if (val) up_repeat_at = now + 300;
				break;
				case CODE_MINUS:
					down_pressed = down_just_pressed = val;
					if (val) down_repeat_at = now + 300;
				break;
				default:
				break;
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				// printf(&quot;brightness up\n&quot;); fflush(stdout);
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else {
				// printf(&quot;volume up\n&quot;); fflush(stdout);
				val = GetVolume();
				if (val&lt;VOLUME_MAX) SetVolume(++val);
		</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\show\show.c (Line 1:1 - Line 40:13), workspace\_unmaintained\zero28\show\show.c (Line 1:1 - Line 36:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup149"><code class="language-c text-sm text-gray-800">// my282
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;SDL2/SDL.h&gt;
#include &lt;SDL2/SDL_image.h&gt;

#define FIXED_WIDTH		640
#define FIXED_HEIGHT	480
#define FIXED_BPP		2
#define FIXED_DEPTH		(FIXED_BPP * 8)
#define FIXED_PITCH		(FIXED_WIDTH * FIXED_BPP)

#define RGBA_MASK_565	0xF800, 0x07E0, 0x001F, 0x0000

int main(int argc , char* argv[]) {
	if (argc&lt;2) {
		puts(&quot;Usage: show.elf image.png delay&quot;);
		return 0;
	}
	
	char path[256];
	strncpy(path,argv[1],256);
	if (access(path, F_OK)!=0) return 0; // nothing to show :(
	
	int delay = argc&gt;2 ? atoi(argv[2]) : 2;
	
	SDL_Init(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	int w = FIXED_WIDTH;
	i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\show\show.c (Line 38:2 - Line 63:2), workspace\_unmaintained\zero28\show\show.c (Line 38:2 - Line 63:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup150"><code class="language-c text-sm text-gray-800">= FIXED_WIDTH;
	int h = FIXED_HEIGHT;
	int p = FIXED_PITCH;
	SDL_Window* window = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	
	int rotate = 0;
	SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	if (mode.h&gt;mode.w) rotate = 3;
	
	SDL_Renderer* renderer = SDL_CreateRenderer(window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	SDL_Texture* texture = SDL_CreateTexture(renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	SDL_Surface* screen = SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	
	SDL_LockTexture(texture,NULL,&amp;screen-&gt;pixels,&amp;screen-&gt;pitch);
	SDL_FillRect(screen, NULL, 0);
	SDL_Surface* img = IMG_Load(path);
	SDL_BlitSurface(img, NULL, screen, &amp;(SDL_Rect){(screen-&gt;w-img-&gt;w)/2,(screen-&gt;h-img-&gt;h)/2});
	SDL_FreeSurface(img);
	SDL_UnlockTexture(texture);

	if (rotate) SDL_RenderCopyEx(renderer,texture,NULL,&amp;(SDL_Rect){0,w,w,h}</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 1:1 - Line 48:9), workspace\_unmaintained\rgb30\platform\platform.c (Line 1:1 - Line 58:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup151"><code class="language-c text-sm text-gray-800">// rgb30
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;sys/mman.h&gt;

#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;pthread.h&gt;

#include &lt;msettings.h&gt;
#include</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 54:2 - Line 105:5), workspace\_unmaintained\rgb30\platform\platform.c (Line 63:2 - Line 224:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup152"><code class="language-c text-sm text-gray-800">		103
#define RAW_DOWN	108
#define RAW_LEFT	105
#define RAW_RIGHT	106
#define RAW_A		 57
#define RAW_B		 29
#define RAW_X		 42
#define RAW_Y		 56
#define RAW_START	 28
#define RAW_SELECT	 97
#define RAW_MENU	  1
#define RAW_L1		 18
#define RAW_L2		 15
#define RAW_R1		 20
#define RAW_R2		 14
#define RAW_PLUS	115
#define RAW_MINUS	114
#define RAW_POWER	116

#define INPUT_COUNT 2
static int inputs[INPUT_COUNT];

void PLAT_initInput(void) {
	inputs[0] = open(&quot;/dev/input/event0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC); // power
	inputs[1] = open(&quot;/dev/input/event3&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC); // controller
	Stick_init(); // analog
}
void PLAT_quitInput(void) {
	Stick_quit();
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		close(inputs[i]);
	}
}

// from &lt;linux/input.h&gt; which has BTN_ constants that conflict with platform.h
struct input_event {
	struct timeval time;
	__u16 type;
	__u16 code;
	__s32 value;
};
#define EV_KEY			0x01
#define EV_ABS			0x03

void PLAT_pollInput(void) {
	// reset transient state
	pad.just_pressed = BTN_NONE;
	pad.just_released = BTN_NONE;
	pad.just_repeated = BTN_NONE;

	uint32_t tick = SDL_GetTicks();
	for (int i=0; i&lt;BTN_ID_COUNT; i++) {
		int btn = 1 &lt;&lt; i;
		if ((pad.is_pressed &amp; btn) &amp;&amp; (tick</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 105:7 - Line 116:7), workspace\_unmaintained\rgb30\platform\platform.c (Line 114:7 - Line 125:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup153"><code class="language-c text-sm text-gray-800">&amp;&amp; (tick&gt;=pad.repeat_at[i])) {
			pad.just_repeated |= btn; // set
			pad.repeat_at[i] += PAD_REPEAT_INTERVAL;
		}
	}
	
	// the actual poll
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		input = inputs[i];
		while (read(input, &amp;event, sizeof(event))==sizeof(event)) {
			if (event.type!=EV_KEY &amp;&amp; event.type!=EV_ABS) continue;

			int btn = BTN_NONE;
			int pressed = 0; // 0=up,1=down
			int id = -1;
			int type = event.type;
			int code = event.code;
			int value = event.value;
			
			// TODO: tmp, hardcoded, missing some buttons
			if (type==EV_KEY) {
				if (value&gt;1) continue; // ignore repeats
			
				pressed = value;
				// LOG_info(&quot;key event: %i (%i)\n&quot;, code,pressed);
					 if (code==RAW_UP) 		{ btn = BTN_DPAD_UP; 	id = BTN_ID_DPAD_UP; </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 119:10 - Line 125:3), workspace\_unmaintained\rgb30\platform\platform.c (Line 132:10 - Line 137:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup154"><code class="language-c text-sm text-gray-800">AD_RIGHT; }
				else if (code==RAW_A)		{ btn = BTN_A; 			id = BTN_ID_A; }
				else if (code==RAW_B)		{ btn = BTN_B; 			id = BTN_ID_B; }
				else if (code==RAW_X)		{ btn = BTN_X; 			id = BTN_ID_X; }
				else if (code==RAW_Y)		{ btn </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 122:13 - Line 141:10), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 337:5 - Line 164:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup155"><code class="language-c text-sm text-gray-800">de==RAW_Y)		{ btn = BTN_Y; 			id = BTN_ID_Y; }
				else if (code==RAW_START)	{ btn = BTN_START; 		id = BTN_ID_START; }
				else if (code==RAW_SELECT)	{ btn = BTN_SELECT; 	id = BTN_ID_SELECT; }
				else if (code==RAW_MENU)	{ btn = BTN_MENU; 		id = BTN_ID_MENU; }
				else if (code==RAW_L1)		{ btn = BTN_L1; 		id = BTN_ID_L1; }
				else if (code==RAW_L2)		{ btn = BTN_L2; 		id = BTN_ID_L2; }
				else if (code==RAW_R1)</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 144:1 - Line 153:7), workspace\_unmaintained\rgb30\platform\platform.c (Line 164:1 - Line 370:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup156"><code class="language-c text-sm text-gray-800">		id = BTN_ID_MINUS; }
				else if (code==RAW_POWER)	{ btn = BTN_POWER; 		id = BTN_ID_POWER; }
			}
			
			if (btn==BTN_NONE) continue;
		
			if (!pressed) {
				pad.is_pressed		&amp;= ~btn; // unset
				pad.just_repeated	&amp;= ~btn; // unset
				pad.just_released	|= btn; // set
			}
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 155:3 - Line 189:18), workspace\_unmaintained\rgb30\platform\platform.c (Line 173:3 - Line 410:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup157"><code class="language-c text-sm text-gray-800">(pad.is_pressed &amp; btn)==BTN_NONE) {
				pad.just_pressed	|= btn; // set
				pad.just_repeated	|= btn; // set
				pad.is_pressed		|= btn; // set
				pad.repeat_at[id]	= tick + PAD_REPEAT_DELAY;
			}
		}
	}
	
	Stick_get(&amp;(pad.laxis.x), &amp;(pad.laxis.y));
	PAD_setAnalog(BTN_ID_ANALOG_LEFT, BTN_ID_ANALOG_RIGHT, pad.laxis.x, tick+PAD_REPEAT_DELAY);
	PAD_setAnalog(BTN_ID_ANALOG_UP,   BTN_ID_ANALOG_DOWN,  pad.laxis.y, tick+PAD_REPEAT_DELAY);
}

int PLAT_shouldWake(void) {
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i+</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 185:2 - Line 238:16), workspace\_unmaintained\rgb30\platform\platform.c (Line 202:13 - Line 255:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup158"><code class="language-c text-sm text-gray-800">dWake(void) {
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		input = inputs[i];
		while (read(input, &amp;event, sizeof(event))==sizeof(event)) {
			if (event.type==EV_KEY &amp;&amp; event.code==RAW_POWER &amp;&amp; event.value==0) {
				return 1;
			}
		}
	}
	return 0;
}

///////////////////////////////

// based on rg35xxplus

static struct VID_Context {
	SDL_Window* window;
	SDL_Renderer* renderer;
	SDL_Texture* texture;
	SDL_Texture* target;
	SDL_Texture* effect;

	SDL_Surface* buffer;
	SDL_Surface* screen;
	
	GFX_Renderer* blit; // yeesh
	
	int width;
	int height;
	int pitch;
	int sharpness;
} vid;

static int device_width;
static int device_height;
static int device_pitch;
static int rotate = 0;
SDL_Surface* PLAT_initVideo(void) {
	// LOG_info(&quot;PLAT_initVideo\n&quot;);
	
	SDL_InitSubSystem(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	// SDL_version compiled;
	// SDL_version linked;
	// SDL_VERSION(&amp;compiled);
	// SDL_GetVersion(&amp;linked);
	// LOG_info(&quot;Compiled SDL version %d.%d.%d ...\n&quot;, compiled.major, compiled.minor, compiled.patch);
	// LOG_info(&quot;Linked SDL version %d.%d.%d.\n&quot;, linked.major, linked.minor, linked.patch);
	//
	// int num_displays = SDL_GetNumVideoDisplays();
	// LOG_info(&quot;SDL_GetNumVideoDisplays(): %i\n&quot;, num_displays);
	//
	// LOG_info(&quot;Available video drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumVideoDrivers(); i++) {
	// 	LOG_info(&quot;- %s\n&quot;, SDL_GetVideoDriver(i));
	// }
	// LOG_info(&quot;Current video driver: %s\n&quot;, SDL_GetCurrentVideoDriver());
	//
	// LOG_info(&quot;Available render drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumRenderDrivers(); i++) {
	// 	SDL_RendererInfo info;
	// 	SDL_GetRenderDriverInfo(i,&amp;info);
	// 	LOG_info(&quot;- %s\n&quot;, info.name);
	// }
	//
	// LOG_info(&quot;Available display modes:\n&quot;);
	// SDL_DisplayMode mode;
	// for (int i=0; i&lt;SDL_GetNumDisplayModes(0); i++) {
	// 	SDL_GetDisplayMode(0, i, &amp;mode);
	// 	LOG_info(&quot;- %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 242:2 - Line 543:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 258:2 - Line 381:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup159"><code class="language-c text-sm text-gray-800">o drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumAudioDrivers(); i++) {
	// 	LOG_info(&quot;- %s\n&quot;, SDL_GetAudioDriver(i));
	// }
	// LOG_info(&quot;Current audio driver: %s\n&quot;, SDL_GetCurrentAudioDriver()); // NOTE: hadn't been selected yet so will always be NULL!

	// SDL_SetHint(SDL_HINT_RENDER_VSYNC,&quot;0&quot;); // ignored?

	int w = FIXED_WIDTH;
	int h = FIXED_HEIGHT;
	int p = FIXED_PITCH;
	vid.window   = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	LOG_info(&quot;window size: %ix%i\n&quot;, w,h);
	
	SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	if (mode.h&gt;mode.w) rotate = 3;
	vid.renderer = SDL_CreateRenderer(vid.window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	// SDL_RenderSetLogicalSize(vid.renderer, w,h); // TODO: wrong, but without and with the below it's even wrong-er
	
	// int renderer_width,renderer_height;
	// SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// LOG_info(&quot;output size: %ix%i\n&quot;, renderer_width, renderer_height);
	// if (renderer_width!=w) { // I think this can only be hdmi
	// 	float x_scale = (float)renderer_width / w;
	// 	float y_scale = (float)renderer_height / h;
	// 	SDL_SetWindowSize(vid.window, w / x_scale, h / y_scale);
	//
	// 	SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// 	LOG_info(&quot;adjusted size: %ix%i\n&quot;, renderer_width, renderer_height);
	// 	x_scale = (float)renderer_width / w;
	// 	y_scale = (float)renderer_height / h;
	// 	SDL_RenderSetScale(vid.renderer, x_scale,y_scale);
	//
	// 	// for some reason we need to clear and present
	// 	// after setting the window size or we'll miss
	// 	// the first frame
	// 	SDL_RenderClear(vid.renderer);
	// 	SDL_RenderPresent(vid.renderer);
	// }
	
	// SDL_RendererInfo info;
	// SDL_GetRendererInfo(vid.renderer, &amp;info);
	// LOG_info(&quot;Current render driver: %s\n&quot;, info.name);
	
	SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY,&quot;1&quot;); // linear
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	vid.target	= NULL; // only needed for non-native sizes
	
	// TODO: doesn't work here
	// SDL_SetTextureScaleMode(vid.texture, SDL_ScaleModeLinear); // we always start at device size so use linear for better upscaling over hdmi
	
	// SDL_ScaleMode scale_mode;
	// SDL_GetTextureScaleMode(vid.texture, &amp;scale_mode);
	// LOG_info(&quot;texture scale mode: %i\n&quot;, scale_mode);
	
	// int format;
	// int access_;
	// SDL_QueryTexture(vid.texture, &amp;format, &amp;access_, NULL,NULL);
	// LOG_info(&quot;texture format: %s (streaming: %i)\n&quot;, SDL_GetPixelFormatName(format), access_==SDL_TEXTUREACCESS_STREAMING);
	
	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	vid.screen	= SDL_CreateRGBSurface(SDL_SWSURFACE, w,h, FIXED_DEPTH, RGBA_MASK_565);
	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
	
	device_width	= w;
	device_height	= h;
	device_pitch	= p;
	
	vid.sharpness = SHARPNESS_SOFT;
	
	return vid.screen;
}

static void clearVideo(void) {
	SDL_FillRect(vid.screen, NULL, 0);
	for (int i=0; i&lt;3; i++) {
		SDL_RenderClear(vid.renderer);
		SDL_RenderPresent(vid.renderer);
	}
}

void PLAT_quitVideo(void) {
	// clearVideo();

	SDL_FreeSurface(vid.screen);
	SDL_FreeSurface(vid.buffer);
	if (vid.target) SDL_DestroyTexture(vid.target);
	if (vid.effect) SDL_DestroyTexture(vid.effect);
	SDL_DestroyTexture(vid.texture);
	SDL_DestroyRenderer(vid.renderer);
	SDL_DestroyWindow(vid.window);
	
	// system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
	SDL_Quit();
}

void PLAT_clearVideo(SDL_Surface* screen) {
	SDL_FillRect(screen, NULL, 0); // TODO: revisit
}
void PLAT_clearAll(void) {
	PLAT_clearVideo(vid.screen); // TODO: revist
	SDL_RenderClear(vid.renderer);
}

void PLAT_setVsync(int vsync) {
	// buh
}

static int hard_scale = 4; // TODO: base src size, eg. 160x144 can be 4

static void resizeVideo(int w, int h, int p) {
	if (w==vid.width &amp;&amp; h==vid.height &amp;&amp; p==vid.pitch) return;
	
	// TODO: minarch disables crisp (and nn upscale before linear downscale) when native
	
	if (w&gt;=device_width &amp;&amp; h&gt;=device_height) hard_scale = 1;
	else if (h&gt;=160) hard_scale = 2; // limits gba and up to 2x (seems sufficient)
	else hard_scale = 4;

	LOG_info(&quot;resizeVideo(%i,%i,%i) hard_scale: %i crisp: %i\n&quot;,w,h,p, hard_scale,vid.sharpness==SHARPNESS_CRISP);

	SDL_FreeSurface(vid.buffer);
	SDL_DestroyTexture(vid.texture);
	if (vid.target) SDL_DestroyTexture(vid.target);
	
	SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, vid.sharpness==SHARPNESS_SOFT?&quot;1&quot;:&quot;0&quot;, SDL_HINT_OVERRIDE);
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, &quot;1&quot;, SDL_HINT_OVERRIDE);
		vid.target = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_TARGET, w * hard_scale,h * hard_scale);
	}
	else {
		vid.target = NULL;
	}

	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);

	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int p) {
	resizeVideo(w,h,p);
	return vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y, int width, int height) {
	// buh
}
void PLAT_setNearestNeighbor(int enabled) {
	// buh
}
void PLAT_setSharpness(int sharpness) {
	if (vid.sharpness==sharpness) return;
	int p = vid.pitch;
	vid.pitch = 0;
	vid.sharpness = sharpness;
	resizeVideo(vid.width,vid.height,p);
}

static struct FX_Context {
	int scale;
	int type;
	int color;
	int next_scale;
	int next_type;
	int next_color;
	int live_type;
} effect = {
	.scale = 1,
	.next_scale = 1,
	.type = EFFECT_NONE,
	.next_type = EFFECT_NONE,
	.live_type = EFFECT_NONE,
	.color = 0,
	.next_color = 0,
};
static void rgb565_to_rgb888(uint32_t rgb565, uint8_t *r, uint8_t *g, uint8_t *b) {
    // Extract the red component (5 bits)
    uint8_t red = (rgb565 &gt;&gt; 11) &amp; 0x1F;
    // Extract the green component (6 bits)
    uint8_t green = (rgb565 &gt;&gt; 5) &amp; 0x3F;
    // Extract the blue component (5 bits)
    uint8_t blue = rgb565 &amp; 0x1F;

    // Scale the values to 8-bit range
    *r = (red &lt;&lt; 3) | (red &gt;&gt; 2);
    *g = (green &lt;&lt; 2) | (green &gt;&gt; 4);
    *b = (blue &lt;&lt; 3) | (blue &gt;&gt; 2);
}
static void updateEffect(void) {
	if (effect.next_scale==effect.scale &amp;&amp; effect.next_type==effect.type &amp;&amp; effect.next_color==effect.color) return; // unchanged
	
	int live_scale = effect.scale;
	int live_color = effect.color;
	effect.scale = effect.next_scale;
	effect.type = effect.next_type;
	effect.color = effect.next_color;
	
	if (effect.type==EFFECT_NONE) return; // disabled
	if (effect.type==effect.live_type &amp;&amp; effect.scale==live_scale &amp;&amp; effect.color==live_color) return; // already loaded
	
	char* effect_path;
	int opacity = 128; // 1 - 1/2 = 50%
	if (effect.type==EFFECT_LINE) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/line-2.png&quot;;
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/line-3.png&quot;;
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/line-4.png&quot;;
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/line-5.png&quot;;
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/line-6.png&quot;;
		}
		else {
			effect_path = RES_PATH &quot;/line-8.png&quot;;
		}
	}
	else if (effect.type==EFFECT_GRID) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/grid-2.png&quot;;
			opacity = 64; // 1 - 3/4 = 25%
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/grid-3.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/grid-4.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/grid-5.png&quot;;
			opacity = 160; // 1 - 9/25 = ~64%
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/grid-6.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;11) {
			effect_path = RES_PATH &quot;/grid-8.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else {
			effect_path = RES_PATH &quot;/grid-11.png&quot;;
			opacity = 136; // 1 - 57/121 = ~52%
		}
	}
	
	// LOG_info(&quot;effect: %s opacity: %i\n&quot;, effect_path, opacity);
	SDL_Surface* tmp = IMG_Load(effect_path);
	if (tmp) {
		if (effect.type==EFFECT_GRID) {
			if (effect.color) {
				// LOG_info(&quot;dmg color grid...\n&quot;);
			
				uint8_t r,g,b;
				rgb565_to_rgb888(effect.color,&amp;r,&amp;g,&amp;b);
				// LOG_info(&quot;rgb %i,%i,%i\n&quot;,r,g,b);
				
				uint32_t* pixels = (uint32_t*)tmp-&gt;pixels;
				int width = tmp-&gt;w;
				int height = tmp-&gt;h;
				for (int y = 0; y &lt; height; ++y) {
				    for (int x = 0; x &lt; width; ++x) {
				        uint32_t pixel = pixels[y * width + x];
				        uint8_t _,a;
				        SDL_GetRGBA(pixel, tmp-&gt;format, &amp;_, &amp;_, &amp;_, &amp;a);
				        if (a) pixels[y * width + x] = SDL_MapRGBA(tmp-&gt;format, r,g,b, a);
				    }
				}
			}
		}
		
		if (vid.effect) SDL_DestroyTexture(vid.effect);
		vid.effect = SDL_CreateTextureFromSurface(vid.renderer, tmp);
		SDL_SetTextureAlphaMod(vid.effect, opacity);
		SDL_FreeSurface(tmp);
		effect.live_type = effect.type;
	}
	}
void PLAT_setEffect(int next_type) {
	effect.next_type = next_type;
}
void PLAT_setEffectColor(int next_color) {
	effect.next_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 543:7 - Line 605:2), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 772:8 - Line 834:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup160"><code class="language-c text-sm text-gray-800">pe;
}
void PLAT_setEffectColor(int next_color) {
	effect.next_color = next_color;
}
void PLAT_vsync(int remaining) {
	if (remaining&gt;0) SDL_Delay(remaining);
}

scaler_t PLAT_getScaler(GFX_Renderer* renderer) {
	// LOG_info(&quot;getScaler for scale: %i\n&quot;, renderer-&gt;scale);
	effect.next_scale = renderer-&gt;scale;
	return scale1x1_c16;
}

void PLAT_blitRenderer(GFX_Renderer* renderer) {
	vid.blit = renderer;
	SDL_RenderClear(vid.renderer);
	resizeVideo(vid.blit-&gt;true_w,vid.blit-&gt;true_h,vid.blit-&gt;src_p);
}

void PLAT_flip(SDL_Surface* IGNORED, int ignored) {
	if (!vid.blit) {
		resizeVideo(device_width,device_height,FIXED_PITCH); // !!!???
		SDL_UpdateTexture(vid.texture,NULL,vid.screen-&gt;pixels,vid.screen-&gt;pitch);
		if (rotate) SDL_RenderCopyEx(vid.renderer,vid.texture,NULL,&amp;(SDL_Rect){0,device_width,device_width,device_height},rotate*90,&amp;(SDL_Point){0,0},SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_RenderPresent(vid.renderer);
		return;
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_UpdateTexture(vid.texture,NULL,vid.blit-&gt;src,vid.blit-&gt;src_p);
	// LOG_info(&quot;blit blocked for %ims (%i,%i)\n&quot;, SDL_GetTicks()-then,vid.buffer-&gt;w,vid.buffer-&gt;h);
	
	SDL_Texture* target = vid.texture;
	int x = vid.blit-&gt;src_x;
	int y = vid.blit-&gt;src_y;
	int w = vid.blit-&gt;src_w;
	int h = vid.blit-&gt;src_h;
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetRenderTarget(vid.renderer,vid.target);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_SetRenderTarget(vid.renderer,NULL);
		x *= hard_scale;
		y *= hard_scale;
		w *= hard_scale;
		h *= hard_scale;
		target = vid.target;
	}
	
	SDL_Rect* src_rect = &amp;(SDL_Rect){x,y,w,h};
	SDL_Rect* dst_rect = &amp;(SDL_Rect){0,0,device_width,device_height};
	if (vid.blit-&gt;aspect==0) { // native or cropped
		// LOG_info(&quot;src_rect %i,%i %ix%i\n&quot;,src_rect-&gt;x,src_rect-&gt;y,src_rect-&gt;w,src_rect-&gt;h);

		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 602:2 - Line 615:2), workspace\_unmaintained\zero28\platform\platform.c (Line 441:2 - Line 844:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup161"><code class="language-c text-sm text-gray-800">

		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h * vid.blit-&gt;scale;
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
		
		// LOG_info(&quot;dst_rect %i,%i %ix%i\n&quot;,dst_rect-&gt;x,dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h);
	}
	else if (vid.blit-&gt;aspect&gt;0) { // aspect
		int h = device_height;
		int w = h * vid.blit-&gt;aspect;
		if (w&gt;device_width) {
			double ratio = 1 / vid.blit-&gt;aspect;
			w = device_width;
			h = w * ratio;
		}
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		// d</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 615:3 - Line 670:37), workspace\_unmaintained\zero28\platform\platform.c (Line 450:3 - Line 505:45)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup162"><code class="language-c text-sm text-gray-800">/ 2;
		// dst_rect = &amp;(SDL_Rect){x,y,w,h};
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
	}
	
	int ox,oy;
	oy = (device_width-device_height)/2;
	ox = -oy;
	if (rotate) SDL_RenderCopyEx(vid.renderer,target,src_rect,&amp;(SDL_Rect){ox+dst_rect-&gt;x,oy+dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h},rotate*90,NULL,SDL_FLIP_NONE);
	else SDL_RenderCopy(vid.renderer, target, src_rect, dst_rect);
	
	updateEffect();
	if (vid.blit &amp;&amp; effect.type!=EFFECT_NONE &amp;&amp; vid.effect) {
		// ox = effect.scale - (dst_rect-&gt;x % effect.scale);
		// oy = effect.scale - (dst_rect-&gt;y % effect.scale);
		// if (ox==effect.scale) ox = 0;
		// if (oy==effect.scale) oy = 0;
 		// LOG_info(&quot;rotate: %i ox: %i oy: %i\n&quot;, rotate, ox,oy);
		if (rotate) SDL_RenderCopyEx(vid.renderer,vid.effect,&amp;(SDL_Rect){0,0,dst_rect-&gt;w,dst_rect-&gt;h},&amp;(SDL_Rect){ox+dst_rect-&gt;x,oy+dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h},rotate*90,NULL,SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.effect, &amp;(SDL_Rect){0,0,dst_rect-&gt;w,dst_rect-&gt;h},dst_rect);
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_RenderPresent(vid.renderer);
	// LOG_info(&quot;SDL_RenderPresent blocked for %ims\n&quot;, SDL_GetTicks()-then);
	vid.blit = NULL;
}

///////////////////////////////

// TODO: 
#define OVERLAY_WIDTH PILL_SIZE // unscaled
#define OVERLAY_HEIGHT PILL_SIZE // unscaled
#define OVERLAY_BPP 4
#define OVERLAY_DEPTH 16
#define OVERLAY_PITCH (OVERLAY_WIDTH * OVERLAY_BPP) // unscaled
#define OVERLAY_RGBA_MASK 0x00ff0000,0x0000ff00,0x000000ff,0xff000000 // ARGB
static struct OVL_Context {
	SDL_Surface* overlay;</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 687:3 - Line 698:7), workspace\_unmaintained\my355\platform\platform.c (Line 600:3 - Line 536:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup163"><code class="language-c text-sm text-gray-800">PLAT_getBatteryStatus(int* is_charging, int* charge) {
	PLAT_getBatteryStatusFine(is_charging, charge);

	// worry less about battery and more about the game you're playing
	     if (*charge&gt;80) *cha</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\platform\platform.c (Line 725:5 - Line 733:12), workspace\_unmaintained\my355\platform\platform.c (Line 644:2 - Line 598:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup164"><code class="language-c text-sm text-gray-800">e = prefixMatch(&quot;up&quot;, status);
}

#define LED_PATH &quot;/sys/class/leds/led1/brightness&quot;
void PLAT_enableBacklight(int enable) {
	if (enable)</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\libmstick\mstick.c (Line 288:6 - Line 300:19), workspace\_unmaintained\my282\libmstick\mstick.c (Line 261:6 - Line 272:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup165"><code class="language-c text-sm text-gray-800">libration.y_max) calibration.y_max = maxY;
		if (minY&lt;calibration.y_min) calibration.y_min = minY;
		calibration.y_mid = (calibration.y_min + calibration.y_max) / 2;
	}

	int value = 0;</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\libmsettings\msettings.c (Line 15:1 - Line 76:7), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 14:1 - Line 91:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup166"><code class="language-c text-sm text-gray-800">o.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 1
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
	int hdmi; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
	.hdmi = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // should always be keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (f</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\libmsettings\msettings.c (Line 76:7 - Line 103:2), workspace\_unmaintained\my355\libmsettings\msettings.c (Line 139:4 - Line 121:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup167"><code class="language-c text-sm text-gray-800">fing?
			close(fd);
		}
		else {
			// load defaults
			memcpy(settings, &amp;DefaultSettings, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
		// settings-&gt;hdmi = 0;
	}
	
	printf(&quot;brightness: %i \nspeaker: %i\n&quot;, settings-&gt;brightness, settings-&gt;speaker); fflush(stdout);
	
	SetVolume(GetVolume());
	SetBrightness(GetBrightness());
	// system(&quot;echo $(&lt; &quot; BRIGHTNESS_PATH &quot;)&quot;);
}
void QuitSettings(void) {
	munmap(settings, shm_size);
	if (is_host) shm_unlink(SHM_KEY);
}
static inline void SaveSettings(void) {
	int fd = op</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\libmsettings\msettings.c (Line 114:2 - Line 149:54), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 135:2 - Line 168:53)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup168"><code class="language-c text-sm text-gray-800">   5;	break; 	// 1
		case 3:  raw =   6;	break; 	// 1
		case 4:  raw =   8;	break;	// 2
		case 5:  raw =  12;	break;	// 4
		case 6:  raw =  16;	break;	// 4
		case 7:  raw =  24;	break;	// 8
		case 8:  raw =  72;	break;	// 48
		case 9:  raw = 128;	break;	// 80
		case 10: raw = 255;	break;	// *
	}
	SetRawBrightness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	return settings-&gt;jack ? settings-&gt;headphones : settings-&gt;speaker;
}
void SetVolume(int value) {
	if (settings-&gt;hdmi) return;
	
	if (settings-&gt;jack) settings-&gt;headphones = value;
	else settings-&gt;speaker = value;
	
	int raw = value * 5;
	SetRawVolume(raw);
	SaveSettings();
}

#define DISP_LCD_SET_BRIGHTNESS  0x102
void SetRawBrightness(int val) { // 0 - 255
	if (settings-&gt;hdmi) return;
	
	printf(&quot;SetRawBrightness(%i)\n&quot;, val); fflush(stdout)</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\libmsettings\msettings.c (Line 158:2 - Line 163:10), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 153:2 - Line 161:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup169"><code class="language-c text-sm text-gray-800">		close(fd);
	}
}
void SetRawVolume(int val) { // 0 - 100
	printf(&quot;SetRawVolume(%i)\n&quot;, val); fflush(stdout);
	char cmd</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\keymon\keymon.c (Line 43:20 - Line 72:4), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 87:17 - Line 86:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup170"><code class="language-c text-sm text-gray-800">e CODE_PLUS		115
#define CODE_MINUS		114

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define REPEAT		2

#define INPUT_COUNT 2
static int inputs[INPUT_COUNT];
static struct input_event ev;

int main (int argc, char *argv[]) {
	InitSettings();
	
	// TODO: will require two inputs
	// input_fd = open(&quot;/dev/input/event0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	inputs[0] = open(&quot;/dev/input/event0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	inputs[1] = open(&quot;/dev/input/event3&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	
	uint32_t input;
	uint32_t val;
	uint32_t menu_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\my282\keymon\keymon.c (Line 73:4 - Line 143:2), workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 102:3 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup171"><code class="language-c text-sm text-gray-800">n_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint8_t ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	
	gettimeofday(&amp;tod, NULL);
	then = tod.tv_sec * 1000 + tod.tv_usec / 1000; // essential SDL_GetTicks()
	ignore = 0;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		for (int i=0; i&lt;INPUT_COUNT; i++) {
			int input_fd = inputs[i];
			while(read(input_fd, &amp;ev, sizeof(ev))==sizeof(ev)) {
				if (ignore) continue;
				val = ev.value;

				if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
				// printf(&quot;code: %i (%i)\n&quot;, ev.code, val); fflush(stdout);
				switch (ev.code) {
					case CODE_MENU:
						menu_pressed = val;
					break;
					break;
					case CODE_PLUS:
						up_pressed = up_just_pressed = val;
						if (val) up_repeat_at = now + 300;
					break;
					case CODE_MINUS:
						down_pressed = down_just_pressed = val;
						if (val) down_repeat_at = now + 300;
					break;
					default:
					break;
				}
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				// printf(&quot;brightness up\n&quot;); fflush(stdout);
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else {
				// printf(&quot;volume up\n&quot;); fflush(stdout);
				val = GetVolume();
				if (val&lt;VOLUME_MAX) SetVolume(++val);
			}
			
			if (up_just_pressed) up_just_pressed = 0;
			else up_repeat_at += 100;
		}
		
		if (down_just_pressed || </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\show\show.c (Line 11:1 - Line 23:4), workspace\_unmaintained\trimuismart\show\show.c (Line 13:1 - Line 25:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup172"><code class="language-c text-sm text-gray-800">&lt;SDL/SDL.h&gt;
#include &lt;SDL/SDL_image.h&gt;

#include &lt;fcntl.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;unistd.h&gt;

int main(int argc , char* argv[]) {
	if (argc&lt;2) {
		puts(&quot;Usage: show.elf image.png&quot;);
		return 0;
	}
	
	char path[256];
	if (strchr(argv[1], '/')==NULL) sprintf(p</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 262:2 - Line 267:2), workspace\_unmaintained\miyoomini\platform\platform.c (Line 201:2 - Line 207:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup173"><code class="language-c text-sm text-gray-800">(&quot;GFX_BLOCKING=1&quot;);
	}
	SDL_GetVideoInfo();
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int pitch) {
	vid.direct = w==FIXED_WIDTH &amp;&amp; h==FIXED_HEIGHT &amp;&amp; pitch==FIXED_PITCH;
	vid.width = w;
	vid.height = h;
	vid.pitch = pitch;
	
	if (vid.direct) memset(vid.video-&gt;pixels, 0, vid.pi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 269:2 - Line 278:7), workspace\_unmaintained\zero28\platform\platform.c (Line 207:2 - Line 305:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup174"><code class="language-c text-sm text-gray-800">een-&gt;pixels = NULL;
		vid.screen-&gt;pixelsPa = NULL; // otherwise custom SDL will try to free it?
		SDL_FreeSurface(vid.screen);
		
		vid.screen = SDL_Cre</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 277:1 - Line 292:10), workspace\_unmaintained\rg35xx\platform\platform.c (Line 380:1 - Line 396:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup175"><code class="language-c text-sm text-gray-800"> SDL_CreateRGBSurfaceFrom(vid.buffer.vadd + ALIGN4K(vid.page*PAGE_SIZE),vid.width,vid.height,FIXED_DEPTH,vid.pitch,RGBA_MASK_AUTO);
		vid.screen-&gt;pixelsPa = vid.buffer.padd + ALIGN4K(vid.page*PAGE_SIZE);
		memset(vid.screen-&gt;pixels, 0, vid.pitch * vid.height);
	}
	
	return vid.direct ? vid.video : vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 292:10 - Line 332:3), workspace\_unmaintained\rg35xx\platform\platform.c (Line 396:2 - Line 435:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup176"><code class="language-c text-sm text-gray-800">) {
	// buh
}
void PLAT_setNearestNeighbor(int enabled) {
	// buh
}
static int next_effect = EFFECT_NONE;
static int effect_type = EFFECT_NONE;
void PLAT_setSharpness(int sharpness) {
	// force effect to reload
	// on scaling change
	if (effect_type&gt;=EFFECT_NONE) next_effect = effect_type;
	effect_type = -1;
}

void PLAT_setEffect(int effect) {
	next_effect = effect;
}

void PLAT_vsync(int remaining) {
	if (remaining&gt;0) SDL_Delay(remaining);
}

scaler_t PLAT_getScaler(GFX_Renderer* renderer) {
	if (effect_type==EFFECT_LINE) {
		switch (renderer-&gt;scale) {
			case 4:  return scale4x_line;
			case 3:  return scale3x_line;
			case 2:  return scale2x_line;
			default: return scale1x_line;
		}
	}
	else if (effect_type==EFFECT_GRID) {
		switch (renderer-&gt;scale) {
			case 3:  return scale3x_grid;
			case 2:  return scale2x_grid;
		}
	}
	
	switch (renderer-&gt;scale) {
		case 6:  return scale6x6_n16;
		case 5:  return scale5x5_n16;
		case 4:  return scale4x4_n16;
		case 3:  return scale3x3_n16;
		case 2:  return scale2x2_n16;
		default: return scale1x1_n16;
	}
}

void PLAT_blitRenderer(GFX_Renderer*</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 351:1 - Line 375:28), workspace\_unmaintained\trimuismart\platform\platform.c (Line 399:1 - Line 485:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup177"><code class="language-c text-sm text-gray-800">) GFX_BlitSurfaceExec(vid.screen, NULL, vid.video, NULL, 0,0,1); // TODO: handle aspect clipping
	SDL_Flip(vid.video);
	
	// swap backbuffer
	if (!vid.direct) {
		vid.page ^= 1;
		vid.screen-&gt;pixels = vid.buffer.vadd + ALIGN4K(vid.page*PAGE_SIZE);
		vid.screen-&gt;pixelsPa = vid.buffer.padd + ALIGN4K(vid.page*PAGE_SIZE);
	}
	
	if (vid.cleared) {
		PLAT_clearVideo(vid.screen);
		vid.cleared = 0;
	}
}

///////////////////////////////

// TODO:
#define OVERLAY_WIDTH PILL_SIZE // unscaled
#</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 423:4 - Line 429:4), workspace\_unmaintained\miyoomini\platform\platform.c (Line 386:2 - Line 392:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup178"><code class="language-c text-sm text-gray-800">(ret &lt; 0) return -1;
	return 0;
}

//
//	AXP223 read (plus)
//		00 .. C4/C5(USBDC connected) 00(dischargi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 438:2 - Line 444:4), workspace\_unmaintained\miyoomini\platform\platform.c (Line 399:2 - Line 405:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup179"><code class="language-c text-sm text-gray-800">used by axp_test)
//			bit2: Indicating the Battery current direction 0: discharging, 1: charging
//			bit0: Indi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 444:4 - Line 463:8), workspace\_unmaintained\rg35xx\platform\platform.c (Line 525:7 - Line 544:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup180"><code class="language-c text-sm text-gray-800">cating whether the boot source is ACIN or VBUS
//		01 .. 70(charging) 30(non-charging)
//			bit6: Charge indication 0:not charge or charge finished, 1: in charging
//		B9 .. (&amp; 0x7F) battery percentage
//
int axp_read(unsigned char address) {
	struct i2c_msg msg[2];
	struct i2c_rdwr_ioctl_data packets;
	unsigned char val;
	int ret;
	int fd = open(AXPDEV, O_RDWR);
	ioctl(fd, I2C_TIMEOUT, 5);
	ioctl(fd, I2C_RETRIES, 1);

	msg[0].addr = AXPID;
	msg[0].flags = 0;
	msg[0].len = 1;
	msg[0].buf = &amp;address;
	msg[1].addr = AXPID</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 485:1 - Line 502:81), workspace\_unmaintained\rgb30\platform\platform.c (Line 689:1 - Line 708:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup181"><code class="language-c text-sm text-gray-800">PLAT_getBatteryStatusFine(int* is_charging, int* charge)
{
	*is_charging = is_plus ? (axp_read(0x00) &amp; 0x4) &gt; 0 : getInt(&quot;/sys/devices/gpiochip0/gpio/gpio59/value&quot;);
	
	*charge = getInt(&quot;/tmp/battery&quot;); // 0-100?

	// TODO: tmp
	// *is_charging = 0;
	// *charge = PWR_LOW_CHARGE;
}

void PLAT_enableBacklight(int enable)</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 511:1 - Line 526:7), workspace\_unmaintained\trimuismart\platform\platform.c (Line 510:1 - Line 588:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup182"><code class="language-c text-sm text-gray-800">n&quot;, &quot;out&quot;);
		putInt(&quot;/sys/class/gpio/gpio4/value&quot;, 0);
	}
}
void PLAT_powerOff(void) {
	sleep(2);

	SetRawVolume(MUTE_VOLUME_RAW);
	PLAT_enableBacklight(0);
	SND_quit();
	VIB_quit();
	PWR_quit();
	GFX_quit();
	
	system(&quot;shutdown&quot;);
	while (1) pause(); // lolwat
}

///////////////////////////////

// #define GOVERNOR_PATH &quot;/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor&quot;
// void PLAT_se</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\platform\platform.c (Line 534:8 - Line 540:10), workspace\_unmaintained\miyoomini\other\screenshot\main.c (Line 24:2 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup183"><code class="language-c text-sm text-gray-800">PATH, &quot;performance&quot;);
// }

// copy/paste of 35XX version now that we have our own overclock.elf
void PLAT_setCPUSpeed(int speed) {
	int freq = 0;
	switch (speed) {
		case CPU_SPEED_MENU: 		freq =  504000; break;
		case CPU_SPEED_POWERSAVE:	freq = 1104000; break;
		case CPU_SPEED_NORMAL: 		freq = 1296000; break;
		case CPU_SPEED_PERFORMANCE: freq = 1488000; break</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\overclock\overclock.c (Line 120:8 - Line 128:11), workspace\_unmaintained\rg35xx\overclock\overclock.c (Line 90:8 - Line 98:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup184"><code class="language-c text-sm text-gray-800">LL_SIZE, PROT_READ|PROT_WRITE, MAP_SHARED, fd_mem, BASE_REG_MPLL_PA);
	
	if (argc&lt;2) {
		printf(&quot;Usage: %s &lt;freq&gt;\n&quot;, argv[0]);
		for (int i=0; cpu_clocks[i]; i++) {
			printf(&quot;  %8i\n&quot;, cpu_clocks</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\libmsettings\msettings.c (Line 21:1 - Line 93:40), workspace\_unmaintained\miyoomini\platform\platform.c (Line 375:1 - Line 447:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup185"><code class="language-c text-sm text-gray-800">#include &lt;fcntl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &lt;mi_ao.h&gt;
#include &lt;stdint.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;linux/i2c.h&gt;
#include &lt;linux/i2c-dev.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

//	mmplus axp223 (via eggs)
#define	AXPDEV	&quot;/dev/i2c-1&quot;
#define	AXPID	(0x34)

//
//	AXP223 write (plus)
//		32 .. bit7: Shutdown Control
//
int axp_write(unsigned char address, unsigned char val) {
	struct i2c_msg msg[1];
	struct i2c_rdwr_ioctl_data packets;
	unsigned char buf[2];
	int ret;
	int fd = open(AXPDEV, O_RDWR);
	ioctl(fd, I2C_TIMEOUT, 5);
	ioctl(fd, I2C_RETRIES, 1);

	buf[0] = address;
	buf[1] = val;
	msg[0].addr = AXPID;
	msg[0].flags = 0;
	msg[0].len = 2;
	msg[0].buf = buf;

	packets.nmsgs = 1;
	packets.msgs = &amp;msg[0];
	ret = ioctl(fd, I2C_RDWR, &amp;packets);

	close(fd);
	if (ret &lt; 0) return -1;
	return 0;
}

//
//	AXP223 read (plus)
//		00 .. C4/C5(USBDC connected) 00(discharging)
//			bit7: ACIN presence indication 0:ACIN not exist, 1:ACIN exists
//			bit6: Indicating whether ACIN is usable (used by axp_test)
//			bit4: Indicating whether VBUS is usable (used by axp_test)
//			bit2: Indicating the Battery current direction 0: discharging, 1: charging
//			bit0: Indicating whether the boot source is ACIN or VBUS
//		01 .. 70(charging) 30(non-charging)
//			bit6: Charge indication 0:not charge or charge finished, 1: in charging
//		B9 .. (&amp; 0x7F) battery percentage
//
int axp_read(unsigned char address) {
	struct i2c_msg msg[2];
	struct i2c_rdwr_ioctl_data packets;
	unsigned char val;
	int ret;
	int fd = open(AXPDEV, O_RDWR);
	ioctl(fd, I2C_TIMEOUT, 5);
	ioctl(fd, I2C_RETRIES, 1</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\libmsettings\msettings.c (Line 105:3 - Line 114:7), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 35:2 - Line 45:68)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup186"><code class="language-c text-sm text-gray-800">2C_RDWR, &amp;packets);

	close(fd);
	if(ret &lt; 0) return -1;
	return val;
}

///////////////////////////////////////

typedef struct Settings {
	int version; // fu</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\libmsettings\msettings.c (Line 119:2 - Line 129:8), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 61:2 - Line 54:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup187"><code class="language-c text-sm text-gray-800">s;
static Settings DefaultSettings = {
	.version = 1,
	.brightness = 3,
	.speaker = 20,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);
static int is_plus = 0;

void InitSettings(void) {
	is_plus = access(&quot;/customer/app/axp_test&quot;, F_OK)==0;
	
	sprintf(SettingsPath, &quot;%s/msetti</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\libmsettings\msettings.c (Line 129:3 - Line 137:51), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 71:3 - Line 79:52)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup188"><code class="language-c text-sm text-gray-800">/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, s</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\libmsettings\msettings.c (Line 148:2 - Line 169:17), workspace\_unmaintained\rg35xx\libmsettings\msettings.c (Line 75:8 - Line 120:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup189"><code class="language-c text-sm text-gray-800">_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) {
			read(fd, settings, shm_size);
			// TODO: use settings-&gt;version for future proofing
			close(fd);
		}
		else {
			// load defaults
			memcpy(settings, &amp;DefaultSettings, shm_size);
		}
	}
	printf(&quot;brightness: %i\nspeaker: %i\n&quot;, settings-&gt;brightness, settings-&gt;speaker);

	MI_AO_Enable(0);
	MI_AO_EnableChn(0,0);
	SetVolume(GetVolume());
	SetBrightness(GetBrightness());</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\libmsettings\msettings.c (Line 218:1 - Line 228:2), workspace\_unmaintained\trimuismart\libmsettings\msettings.c (Line 155:1 - Line 165:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup190"><code class="language-c text-sm text-gray-800">uint64_t buf1[] = {sizeof(buf2), (uintptr_t)buf2};
		ioctl(fd, MI_AO_SETMUTE, buf1);
		close(fd);
	}
}

void SetRawVolume(int val) </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\keymon\keymon.c (Line 58:1 - Line 130:20), workspace\_unmaintained\miyoomini\platform\platform.c (Line 375:1 - Line 447:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup191"><code class="language-c text-sm text-gray-800">e &lt;linux/input.h&gt;
#include &lt;linux/i2c.h&gt;
#include &lt;linux/i2c-dev.h&gt;

#include &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;pthread.h&gt;

//	Button Defines
#define	BUTTON_MENU		KEY_ESC
#define	BUTTON_POWER	KEY_POWER
#define	BUTTON_SELECT	KEY_RIGHTCTRL
#define	BUTTON_START	KEY_ENTER
#define	BUTTON_L1		KEY_E
#define	BUTTON_R1		KEY_T
#define	BUTTON_L2		KEY_TAB
#define	BUTTON_R2		KEY_BACKSPACE
#define BUTTON_PLUS		KEY_VOLUMEUP
#define BUTTON_MINUS	KEY_VOLUMEDOWN

//	for keyshm
#define VOLUME		0
#define BRIGHTNESS	1
#define VOLMAX		20
#define BRIMAX		10

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define REPEAT		2

//	for button_flag
#define SELECT_BIT	0
#define START_BIT	1
#define SELECT		(1&lt;&lt;SELECT_BIT)
#define START		(1&lt;&lt;START_BIT)

//	for DEBUG
//#define	DEBUG
#ifdef	DEBUG
#define ERROR(str)	fprintf(stderr,str&quot;\n&quot;); quit(EXIT_FAILURE)
#else
#define ERROR(str)	quit(EXIT_FAILURE)
#endif

//	mmplus axp223 (via eggs)
#define	AXPDEV	&quot;/dev/i2c-1&quot;
#define	AXPID	(0x34)

//
//	AXP223 write (plus)
//		32 .. bit7: Shutdown Control
//
int axp_write(unsigned char address, unsigned char val) {
	struct i2c_msg msg[1];
	struct i2c_rdwr_ioctl_data packets;
	unsigned char buf[2];
	int ret;
	int fd = open(AXPDEV, O_RDWR);
	ioctl(fd, I2C_TIMEOUT, 5);
	ioctl(fd, I2C_RETRIES, 1);

	buf[0] = address;
	buf[1] = val;
	msg[0].addr = AXPID;
	msg[0].flags = 0;
	msg[0].len = 2;
	msg[0].buf = buf;

	packets.nmsgs = 1;
	packets.msgs = &amp;msg[0];
	ret = ioctl(fd, I2C_RDWR, &amp;packets);

	close(fd);
	if (ret &lt; 0) return -1;
	return 0;
}

//
//	AXP223 read (plus)
//		00 .. C4/C5(USBDC connected) 00(discharging)
//			bit7: ACIN presence indication </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\keymon\keymon.c (Line 184:43 - Line 191:8), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 52:5 - Line 48:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup192"><code class="language-c text-sm text-gray-800">    _IO(SARADC_IOC_MAGIC, 1)

static SAR_ADC_CONFIG_READ  adc_config = {0,0};
static int is_charging = 0;
static int is_pl</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\keymon\keymon.c (Line 306:2 - Line 317:38), workspace\_unmaintained\miyoomini\keymon\keymon.c (Line 280:2 - Line 291:42)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup193"><code class="language-c text-sm text-gray-800">~SELECT) | (val&lt;&lt;SELECT_BIT);
			// if (val) {
			// 	static int tick = 0;
			// 	char cmd[256];
			//
			// 	sprintf(cmd, &quot;ps ax -o pid,nice,comm,args &amp;&gt; /mnt/SDCARD/%04i-nice.txt&quot;, tick);
			// 	system(cmd);
			//
			// 	sprintf(cmd, &quot;top -b -n 1 &gt; /mnt/SDCARD/%04i-top.txt&quot;, tick++);
			// 	system(c</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\blank\blank.c (Line 12:2 - Line 18:7), workspace\_unmaintained\miyoomini\show\show.c (Line 23:2 - Line 28:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup194"><code class="language-c text-sm text-gray-800">lude &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;unistd.h&gt;

int main(int argc , char* argv[]) {
	// clear screen
	int fb0_fd = open(&quot;/dev/fb0&quot;, O_RDWR);
	struct fb_var_screeninfo vinfo;
	ioctl(fb0_fd, FBIOGET_VSCREENINFO, &amp;vinfo);
	int map_size = vinfo.xres * vinfo.yres * (vinfo.bits_per_pixel / 8); // </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\batmon\batmon.c (Line 16:1 - Line 88:7), workspace\_unmaintained\miyoomini\platform\platform.c (Line 375:1 - Line 447:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup195"><code class="language-c text-sm text-gray-800">DL.h&gt;
#include &lt;SDL/SDL_image.h&gt;

#include &lt;sys/ioctl.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;linux/input.h&gt;
#include &lt;pthread.h&gt;

#include &lt;linux/i2c.h&gt;
#include &lt;linux/i2c-dev.h&gt;
#include &lt;sys/ioctl.h&gt;

//	mmplus axp223 (via eggs)
#define	AXPDEV	&quot;/dev/i2c-1&quot;
#define	AXPID	(0x34)

//
//	AXP223 write (plus)
//		32 .. bit7: Shutdown Control
//
int axp_write(unsigned char address, unsigned char val) {
	struct i2c_msg msg[1];
	struct i2c_rdwr_ioctl_data packets;
	unsigned char buf[2];
	int ret;
	int fd = open(AXPDEV, O_RDWR);
	ioctl(fd, I2C_TIMEOUT, 5);
	ioctl(fd, I2C_RETRIES, 1);

	buf[0] = address;
	buf[1] = val;
	msg[0].addr = AXPID;
	msg[0].flags = 0;
	msg[0].len = 2;
	msg[0].buf = buf;

	packets.nmsgs = 1;
	packets.msgs = &amp;msg[0];
	ret = ioctl(fd, I2C_RDWR, &amp;packets);

	close(fd);
	if (ret &lt; 0) return -1;
	return 0;
}

//
//	AXP223 read (plus)
//		00 .. C4/C5(USBDC connected) 00(discharging)
//			bit7: ACIN presence indication 0:ACIN not exist, 1:ACIN exists
//			bit6: Indicating whether ACIN is usable (used by axp_test)
//			bit4: Indicating whether VBUS is usable (used by axp_test)
//			bit2: Indicating the Battery current direction 0: discharging, 1: charging
//			bit0: Indicating whether the boot source is ACIN or VBUS
//		01 .. 70(charging) 30(non-charging)
//			bit6: Charge indication 0:not charge or charge finished, 1: in charging
//		B9 .. (&amp; 0x7F) battery percentage
//
int axp_read(unsigned char address) {
	struct i2c_msg msg[2];
	struct i2c_rdwr_ioctl_data packets;
	unsigned char val;
	int ret;
	int fd = open(AXPDEV, O_RDWR);
	ioctl(fd, I2C_TIMEOUT, 5);
	ioctl(fd, I2C_RETRIES, 1);

	m</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\batmon\batmon.c (Line 101:1 - Line 112:10), workspace\_unmaintained\miyoomini\keymon\keymon.c (Line 180:2 - Line 48:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup196"><code class="language-c text-sm text-gray-800">c int screen_on = 0;
static unsigned long screen_start;
void screenOn(void) {
	screen_start = SDL_GetTicks();
	if (!screen_on) system(&quot;echo 50 &gt; /sys/class/pwm/pwmchip0/pwm0/duty_cycle&quot;);
	screen_on = 1;
}
void screenOff(void) {
	system(&quot;echo 0 &gt; /s</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\batmon\batmon.c (Line 134:2 - Line 142:47), workspace\_unmaintained\miyoomini\show\show.c (Line 23:2 - Line 30:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup197"><code class="language-c text-sm text-gray-800">rg) {
	struct input_event	event;
	while (read(input_fd, &amp;event, sizeof(event))==sizeof(event)) {
		if (event.type!=EV_KEY || event.value&gt;1) continue;
		if (event.type==EV_KEY) screenOn();
		if (event.code==KEY_POWER) launch = 1;
	}	
}

int main(void) {
	is_plus = access(&quot;/customer/app/axp_test&quot;, F_OK)==0;
	int fb0_fd = open(&quot;/dev/fb0&quot;, O_RDWR);
	struct fb_var_screeninfo vinfo;
	ioctl(fb0_fd, FBIOGET_VSCREENINFO, </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\miyoomini\batmon\batmon.c (Line 142:47 - Line 159:9), workspace\_unmaintained\miyoomini\show\show.c (Line 30:5 - Line 47:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup198"><code class="language-c text-sm text-gray-800">&amp;vinfo);
	int map_size = vinfo.xres * vinfo.yres * (vinfo.bits_per_pixel / 8); // 640x480x4
	char* fb0_map = (char*)mmap(0, map_size, PROT_READ | PROT_WRITE, MAP_SHARED, fb0_fd, 0);
	
	memset(fb0_map, 0, map_size); // clear screen
	
	SDL_Surface* img = IMG_Load(&quot;/mnt/SDCARD/.system/res/charging-640-480.png&quot;); // 24-bit opaque png
	
	uint8_t* dst = (uint8_t*)fb0_map; // rgba
	uint8_t* src = (uint8</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 22:1 - Line 62:20), workspace\_unmaintained\rgb30\platform\platform.c (Line 21:1 - Line 49:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup199"><code class="language-c text-sm text-gray-800">include &lt;stdlib.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;sys/mman.h&gt;

#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;errno.h&gt;
#include &lt;pthread.h&gt;

#include &lt;msettings.h&gt;

#include &quot;defines.h&quot;
#include &quot;platform.h&quot;
#include &quot;api.h</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 64:1 - Line 81:7), workspace\_unmaintained\rgb30\platform\platform.c (Line 61:1 - Line 78:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup200"><code class="language-c text-sm text-gray-800">546
#define RAW_RIGHT	547

#define RAW_A		308
#define RAW_B		305
#define RAW_X		307
#define RAW_Y		304

#define RAW_START	315
#define RAW_SELECT	314
#define RAW_MENU	704

#define RAW_L1		310
#define RAW_L2		313
#define RAW_L3		317
#define RAW_R1		311
#define RAW_R2		</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 82:7 - Line 97:5), workspace\_unmaintained\rgb30\platform\platform.c (Line 149:9 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn201" onclick="toggleCodeBlock('cloneGroup201', 'expandBtn201', 'collapseBtn201')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn201" onclick="toggleCodeBlock('cloneGroup201', 'expandBtn201', 'collapseBtn201')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup201"><code class="language-c text-sm text-gray-800">define RAW_LSY		1
#define RAW_LSX		0
#define RAW_RSY		2
#define RAW_RSX		5

#define RAW_MENU1	RAW_L3
#define RAW_MENU2	RAW_R3

#define INPUT_COUNT 3
static int inputs[INPUT_COUNT];

void PLAT_initInput(void) {
	inputs[0] = open(&quot;/dev/input/event0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC); // power
	inputs[1] = open(&quot;/dev/input/event2&quot;, O_RD</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 97:1 - Line 112:42), workspace\_unmaintained\rgb30\platform\platform.c (Line 78:1 - Line 93:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn202" onclick="toggleCodeBlock('cloneGroup202', 'expandBtn202', 'collapseBtn202')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn202" onclick="toggleCodeBlock('cloneGroup202', 'expandBtn202', 'collapseBtn202')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup202"><code class="language-c text-sm text-gray-800">O_RDONLY | O_NONBLOCK | O_CLOEXEC); // gamepad
	inputs[2] = open(&quot;/dev/input/event3&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC); // volume
}
void PLAT_quitInput(void) {
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		close(inputs[i]);
	}
}

// from &lt;linux/input.h&gt; which has BTN_ constants that conflict with platform.h
struct input_event {
	struct timeval time;
	__u16 type;
	__u16 code;
	__s32 value;
};
#define EV_KEY			0x01
#define EV_ABS			</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 122:2 - Line 167:23), workspace\_unmaintained\rgb30\platform\platform.c (Line 93:2 - Line 138:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn203" onclick="toggleCodeBlock('cloneGroup203', 'expandBtn203', 'collapseBtn203')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn203" onclick="toggleCodeBlock('cloneGroup203', 'expandBtn203', 'collapseBtn203')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup203"><code class="language-c text-sm text-gray-800">	pad.just_pressed	|= btn; // set
		pad.just_repeated	|= btn; // set
		pad.is_pressed		|= btn; // set
		pad.repeat_at[id]	= tick + PAD_REPEAT_DELAY;
	}
}

void PLAT_pollInput(void) {
	// reset transient state
	pad.just_pressed = BTN_NONE;
	pad.just_released = BTN_NONE;
	pad.just_repeated = BTN_NONE;

	uint32_t tick = SDL_GetTicks();
	for (int i=0; i&lt;BTN_ID_COUNT; i++) {
		int btn = 1 &lt;&lt; i;
		if ((pad.is_pressed &amp; btn) &amp;&amp; (tick&gt;=pad.repeat_at[i])) {
			pad.just_repeated |= btn; // set
			pad.repeat_at[i] += PAD_REPEAT_INTERVAL;
		}
	}
	
	// gross hack for out of order hat events
	// doesn't work because we can catch it's
	// bad state update but it's own internal
	// state is broken so it never sends the
	// real release event
	// static time_t x_sec = 0;
	// static time_t y_sec = 0;
	// static suseconds_t x_usec = 0;
	// static suseconds_t y_usec = 0;
	
	// the actual poll
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		input = inputs[i];
		while (read(input, &amp;event, sizeof(event))==sizeof(event)) {
			if (event.type!=EV_KEY &amp;&amp; event.type!=EV_ABS) continue;

			int btn = BTN_NONE;
			int pressed = 0; // 0=up,1=down
			int id = -1;
			int type = event.type;
			int code = event.code;
			int value = event.value;
			
			// TODO: tmp, hardcoded, missing some buttons
			if (type==EV_KEY) {
				if (value&gt;1) continue; // ignore repeats
			
				pressed = value;
				// LOG_info(&quot;key event: %i (%i)\n&quot;, code,pressed);
					 if (code==RAW_UP) 		{ btn = BTN_DPAD_UP; 	id = BTN_ID_DPAD_UP; }
	 			else if (code==RAW_DOWN)	{ btn = BTN_DPAD_DOWN; 	id = BTN_ID_DPAD_DOWN; }
				else if (code==RAW_LEFT)	{ btn = BTN_DPAD_LEFT; 	id = BTN_ID_DPAD_LEFT; }
				else if (code==RAW_RIGHT)	{ btn = BTN_DPAD_RIGHT; id = BTN_ID_DPAD_RIGHT; }
				else if (code==RAW_A)		{ btn = BTN_A; 			id = BTN_ID_A; }
				else if (code==RAW_B)		{ btn = BTN_B; 			id = BTN_ID_B; }
				else if (code==RAW_X)		{ btn = BTN_X; 			id = BTN_ID_X; }
				else if (code==RAW_Y)		{ btn = BTN_Y; 			id = BTN_ID_Y; }
				else if (code==RAW_START)	{ btn = BTN_START; 		id = BTN_ID_START; }
				else if (code==RAW_SELECT)	{ btn = BTN_SELECT; 	id = BTN_ID_SELECT; }
				else</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 178:3 - Line 309:24), workspace\_unmaintained\rgb30\platform\platform.c (Line 162:3 - Line 288:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn204" onclick="toggleCodeBlock('cloneGroup204', 'expandBtn204', 'collapseBtn204')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn204" onclick="toggleCodeBlock('cloneGroup204', 'expandBtn204', 'collapseBtn204')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup204"><code class="language-c text-sm text-gray-800">BTN_ID_R3; }
				else if (code==RAW_PLUS)	{ btn = BTN_PLUS; 		id = BTN_ID_PLUS; }
				else if (code==RAW_MINUS)	{ btn = BTN_MINUS; 		id = BTN_ID_MINUS; }
				else if (code==RAW_POWER)	{ btn = BTN_POWER; 		id = BTN_ID_POWER; }
			}
			else if (type==EV_ABS) {
				LOG_info(&quot;abs event: %i (%i)\n&quot;, code,value);
					 if (code==RAW_LSX) { pad.laxis.x = value; PAD_setAnalog(BTN_ID_ANALOG_LEFT, BTN_ID_ANALOG_RIGHT, pad.laxis.x, tick+PAD_REPEAT_DELAY); }
				else if (code==RAW_LSY) { pad.laxis.y = value; PAD_setAnalog(BTN_ID_ANALOG_UP,   BTN_ID_ANALOG_DOWN,  pad.laxis.y, tick+PAD_REPEAT_DELAY); }
				else if (code==RAW_RSX) pad.raxis.x = value;
				else if (code==RAW_RSY) pad.raxis.y = value;
			}
			
			if (btn==BTN_NONE) continue;
		
			updateButton(btn, id, pressed, tick);
			if (btn==BTN_L3||btn==BTN_R3) updateButton(BTN_MENU, BTN_ID_MENU, pressed, tick);
		}
	}
}

int PLAT_shouldWake(void) {
	
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		input = inputs[i];
		while (read(input, &amp;event, sizeof(event))==sizeof(event)) {
			if (event.type==EV_KEY &amp;&amp; event.code==RAW_POWER &amp;&amp; event.value==0) {
				return 1;
			}
		}
	}
	return 0;
}

///////////////////////////////

// based on rg35xxplus

static struct VID_Context {
	SDL_Window* window;
	SDL_Renderer* renderer;
	SDL_Texture* texture;
	SDL_Texture* target;
	SDL_Texture* effect;

	SDL_Surface* buffer;
	SDL_Surface* screen;
	
	GFX_Renderer* blit; // yeesh
	
	int width;
	int height;
	int pitch;
	int sharpness;
} vid;

static int device_width;
static int device_height;
static int device_pitch;
static int rotate = 0;
SDL_Surface* PLAT_initVideo(void) {
	// LOG_info(&quot;PLAT_initVideo\n&quot;);
	
	SDL_InitSubSystem(SDL_INIT_VIDEO);
	SDL_ShowCursor(0);
	
	// SDL_version compiled;
	// SDL_version linked;
	// SDL_VERSION(&amp;compiled);
	// SDL_GetVersion(&amp;linked);
	// LOG_info(&quot;Compiled SDL version %d.%d.%d ...\n&quot;, compiled.major, compiled.minor, compiled.patch);
	// LOG_info(&quot;Linked SDL version %d.%d.%d.\n&quot;, linked.major, linked.minor, linked.patch);
	//
	// int num_displays = SDL_GetNumVideoDisplays();
	// LOG_info(&quot;SDL_GetNumVideoDisplays(): %i\n&quot;, num_displays);
	//
	// LOG_info(&quot;Available video drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumVideoDrivers(); i++) {
	// 	LOG_info(&quot;- %s\n&quot;, SDL_GetVideoDriver(i));
	// }
	// LOG_info(&quot;Current video driver: %s\n&quot;, SDL_GetCurrentVideoDriver());
	//
	// LOG_info(&quot;Available render drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumRenderDrivers(); i++) {
	// 	SDL_RendererInfo info;
	// 	SDL_GetRenderDriverInfo(i,&amp;info);
	// 	LOG_info(&quot;- %s\n&quot;, info.name);
	// }
	//
	// LOG_info(&quot;Available display modes:\n&quot;);
	// SDL_DisplayMode mode;
	// for (int i=0; i&lt;SDL_GetNumDisplayModes(0); i++) {
	// 	SDL_GetDisplayMode(0, i, &amp;mode);
	// 	LOG_info(&quot;- %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	// }
	// SDL_GetCurrentDisplayMode(0, &amp;mode);
	// LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));

	// LOG_info(&quot;Available audio drivers:\n&quot;);
	// for (int i=0; i&lt;SDL_GetNumAudioDrivers(); i++) {
	// 	LOG_info(&quot;- %s\n&quot;, SDL_GetAudioDriver(i));
	// }
	// LOG_info(&quot;Current audio driver: %s\n&quot;, SDL_GetCurrentAudioDriver()); // NOTE: hadn't been selected yet so will always be NULL!

	// SDL_SetHint(SDL_HINT_RENDER_VSYNC,&quot;0&quot;); // ignored?

	int w = FIXED_WIDTH;
	int h = FIXED_HEIGHT;
	int p = FIXED_PITCH;
	vid.window   = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, w,h, SDL_WINDOW_SHOWN);
	LOG_info(&quot;window size: %ix%i\n&quot;, w,h);
	
	SDL_DisplayMode mode;
	SDL_GetCurrentDisplayMode(0, &amp;mode);
	LOG_info(&quot;Current display mode: %ix%i (%s)\n&quot;, mode.w,mode.h, SDL_GetPixelFormatName(mode.format));
	if (mode.h&gt;mode.w) rotate = 3;
	vid.renderer = SDL_CreateRenderer(vid.window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	// SDL_RenderSetLogicalSize(vid.renderer, w,h); // TODO: wrong, but without and with the below it's even wrong-er
	
	// int renderer_width,renderer_height;
	// SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// LOG_info(&quot;output size: %ix%i\n&quot;, renderer_width, renderer_height);
	// if (renderer_width!=w) { // I think this can only be hdmi
	// 	float x_scale = (float)renderer_width / w;
	// 	float y_scale = (float)renderer_height / h;
	// 	SDL_SetWindowSize(vid.win</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 309:20 - Line 394:24), workspace\_unmaintained\rgb30\platform\platform.c (Line 287:2 - Line 190:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn205" onclick="toggleCodeBlock('cloneGroup205', 'expandBtn205', 'collapseBtn205')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn205" onclick="toggleCodeBlock('cloneGroup205', 'expandBtn205', 'collapseBtn205')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup205"><code class="language-c text-sm text-gray-800">//
	// 	SDL_GetRendererOutputSize(vid.renderer, &amp;renderer_width, &amp;renderer_height);
	// 	LOG_info(&quot;adjusted size: %ix%i\n&quot;, renderer_width, renderer_height);
	// 	x_scale = (float)renderer_width / w;
	// 	y_scale = (float)renderer_height / h;
	// 	SDL_RenderSetScale(vid.renderer, x_scale,y_scale);
	//
	// 	// for some reason we need to clear and present
	// 	// after setting the window size or we'll miss
	// 	// the first frame
	// 	SDL_RenderClear(vid.renderer);
	// 	SDL_RenderPresent(vid.renderer);
	// }
	
	// SDL_RendererInfo info;
	// SDL_GetRendererInfo(vid.renderer, &amp;info);
	// LOG_info(&quot;Current render driver: %s\n&quot;, info.name);
	
	SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY,&quot;1&quot;); // linear
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	SDL_SetTextureBlendMode(vid.texture, SDL_BLENDMODE_BLEND);
	vid.target	= NULL; // only needed for non-native sizes
	
	// TODO: doesn't work here
	// SDL_SetTextureScaleMode(vid.texture, SDL_ScaleModeLinear); // we always start at device size so use linear for better upscaling over hdmi
	
	// SDL_ScaleMode scale_mode;
	// SDL_GetTextureScaleMode(vid.texture, &amp;scale_mode);
	// LOG_info(&quot;texture scale mode: %i\n&quot;, scale_mode);
	
	// int format;
	// int access_;
	// SDL_QueryTexture(vid.texture, &amp;format, &amp;access_, NULL,NULL);
	// LOG_info(&quot;texture format: %s (streaming: %i)\n&quot;, SDL_GetPixelFormatName(format), access_==SDL_TEXTUREACCESS_STREAMING);
	
	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	vid.screen	= SDL_CreateRGBSurface(SDL_SWSURFACE, w,h, FIXED_DEPTH, RGBA_MASK_565);
	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
	
	device_width	= w;
	device_height	= h;
	device_pitch	= p;
	
	vid.sharpness = SHARPNESS_SOFT;
	
	return vid.screen;
}

static void clearVideo(void) {
	SDL_FillRect(vid.screen, NULL, 0);
	for (int i=0; i&lt;3; i++) {
		SDL_RenderClear(vid.renderer);
		SDL_RenderPresent(vid.renderer);
	}
}

void PLAT_quitVideo(void) {
	// clearVideo();

	SDL_FreeSurface(vid.screen);
	SDL_FreeSurface(vid.buffer);
	if (vid.target) SDL_DestroyTexture(vid.target);
	if (vid.effect) SDL_DestroyTexture(vid.effect);
	SDL_DestroyTexture(vid.texture);
	SDL_DestroyRenderer(vid.renderer);
	SDL_DestroyWindow(vid.window);
	

	// system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
	SDL_Quit();
}

void PLAT_clearVideo(SDL_Surface* screen) {
	SDL_FillRect(screen, NULL, 0); // TODO: revisit
}
void PLAT_clearAll(void) {
	PLAT_clearVideo(vid.screen); // TODO: revist
	SDL_RenderClear(vid.renderer);
}

void PLAT_setVsync(int vsync) {
	// buh
}

static int hard_scale = 4; // TODO: b</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 394:20 - Line 399:24), workspace\_unmaintained\zero28\platform\platform.c (Line 188:2 - Line 193:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn206" onclick="toggleCodeBlock('cloneGroup206', 'expandBtn206', 'collapseBtn206')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn206" onclick="toggleCodeBlock('cloneGroup206', 'expandBtn206', 'collapseBtn206')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup206"><code class="language-c text-sm text-gray-800">4

static void resizeVideo(int w, int h, int p) {
	if (w==vid.width &amp;&amp; h==vid.height &amp;&amp; p==vid.pitch) return;
	
	// TODO: minarch disables crisp (and nn upscale before linear downscale) when native
	
	if (w&gt;=device_width &amp;&amp; h&gt;=device_height) hard_scale = 1;
	else if (h&gt;=160) har</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 399:20 - Line 439:4), workspace\_unmaintained\zero28\platform\platform.c (Line 192:11 - Line 232:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn207" onclick="toggleCodeBlock('cloneGroup207', 'expandBtn207', 'collapseBtn207')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn207" onclick="toggleCodeBlock('cloneGroup207', 'expandBtn207', 'collapseBtn207')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup207"><code class="language-c text-sm text-gray-800">p to 2x (seems sufficient)
	else hard_scale = 4;

	LOG_info(&quot;resizeVideo(%i,%i,%i) hard_scale: %i crisp: %i\n&quot;,w,h,p, hard_scale,vid.sharpness==SHARPNESS_CRISP);

	SDL_FreeSurface(vid.buffer);
	SDL_DestroyTexture(vid.texture);
	if (vid.target) SDL_DestroyTexture(vid.target);
	
	SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, vid.sharpness==SHARPNESS_SOFT?&quot;1&quot;:&quot;0&quot;, SDL_HINT_OVERRIDE);
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	SDL_SetTextureBlendMode(vid.texture, SDL_BLENDMODE_BLEND);
	
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, &quot;1&quot;, SDL_HINT_OVERRIDE);
		vid.target = SDL_CreateTexture(vid.</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 439:8 - Line 554:24), workspace\_unmaintained\zero28\platform\platform.c (Line 231:10 - Line 528:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn208" onclick="toggleCodeBlock('cloneGroup208', 'expandBtn208', 'collapseBtn208')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn208" onclick="toggleCodeBlock('cloneGroup208', 'expandBtn208', 'collapseBtn208')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup208"><code class="language-c text-sm text-gray-800">,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_TARGET, w * hard_scale,h * hard_scale);
		SDL_SetTextureBlendMode(vid.target, SDL_BLENDMODE_BLEND);
	}
	else {
		vid.target = NULL;
	}

	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);

	vid.width	= w;
	vid.height	= h;
	vid.pitch	= p;
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int p) {
	resizeVideo(w,h,p);
	return vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y, int width, int height) {
	// buh
}
void PLAT_setNearestNeighbor(int enabled) {
	// buh
}
void PLAT_setSharpness(int sharpness) {
	if (vid.sharpness==sharpness) return;
	int p = vid.pitch;
	vid.pitch = 0;
	vid.sharpness = sharpness;
	resizeVideo(vid.width,vid.height,p);
}

static struct FX_Context {
	int scale;
	int type;
	int color;
	int next_scale;
	int next_type;
	int next_color;
	int live_type;
	int opacity;
} effect = {
	.scale = 1,
	.next_scale = 1,
	.type = EFFECT_NONE,
	.next_type = EFFECT_NONE,
	.live_type = EFFECT_NONE,
	.color = 0,
	.next_color = 0,
};
static void rgb565_to_rgb888(uint32_t rgb565, uint8_t *r, uint8_t *g, uint8_t *b) {
    // Extract the red component (5 bits)
    uint8_t red = (rgb565 &gt;&gt; 11) &amp; 0x1F;
    // Extract the green component (6 bits)
    uint8_t green = (rgb565 &gt;&gt; 5) &amp; 0x3F;
    // Extract the blue component (5 bits)
    uint8_t blue = rgb565 &amp; 0x1F;

    // Scale the values to 8-bit range
    *r = (red &lt;&lt; 3) | (red &gt;&gt; 2);
    *g = (green &lt;&lt; 2) | (green &gt;&gt; 4);
    *b = (blue &lt;&lt; 3) | (blue &gt;&gt; 2);
}
static void updateEffect(void) {
	if (effect.next_scale==effect.scale &amp;&amp; effect.next_type==effect.type &amp;&amp; effect.next_color==effect.color) return; // unchanged
	
	int live_scale = effect.scale;
	int live_color = effect.color;
	effect.scale = effect.next_scale;
	effect.type = effect.next_type;
	effect.color = effect.next_color;
	
	if (effect.type==EFFECT_NONE) return; // disabled
	if (effect.type==effect.live_type &amp;&amp; effect.scale==live_scale &amp;&amp; effect.color==live_color) return; // already loaded
	
	char* effect_path;
	int opacity = 128; // 1 - 1/2 = 50%
	if (effect.type==EFFECT_LINE) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/line-2.png&quot;;
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/line-3.png&quot;;
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/line-4.png&quot;;
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/line-5.png&quot;;
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/line-6.png&quot;;
		}
		else {
			effect_path = RES_PATH &quot;/line-8.png&quot;;
		}
	}
	else if (effect.type==EFFECT_GRID) {
		if (effect.scale&lt;3) {
			effect_path = RES_PATH &quot;/grid-2.png&quot;;
			opacity = 64; // 1 - 3/4 = 25%
		}
		else if (effect.scale&lt;4) {
			effect_path = RES_PATH &quot;/grid-3.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;5) {
			effect_path = RES_PATH &quot;/grid-4.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else if (effect.scale&lt;6) {
			effect_path = RES_PATH &quot;/grid-5.png&quot;;
			opacity = 160; // 1 - 9/25 = ~64%
		}
		else if (effect.scale&lt;8) {
			effect_path = RES_PATH &quot;/grid-6.png&quot;;
			opacity = 112; // 1 - 5/9 = ~44%
		}
		else if (effect.scale&lt;11) {
			effect_path = RES_PATH &quot;/grid-8.png&quot;;
			opacity = 144; // 1 - 7/16 = ~56%
		}
		else {
			effect_path = RES_PATH &quot;/grid-11.png&quot;;
			opacity = 136; // 1 - 57/121 = ~52%
		}
	}
	
	// LOG_info(&quot;effect: %s </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 555:8 - Line 583:7), workspace\_unmaintained\zero28\platform\platform.c (Line 348:2 - Line 376:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn209" onclick="toggleCodeBlock('cloneGroup209', 'expandBtn209', 'collapseBtn209')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn209" onclick="toggleCodeBlock('cloneGroup209', 'expandBtn209', 'collapseBtn209')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup209"><code class="language-c text-sm text-gray-800">G_Load(effect_path);
	if (tmp) {
		if (effect.type==EFFECT_GRID) {
			if (effect.color) {
				// LOG_info(&quot;dmg color grid...\n&quot;);
			
				uint8_t r,g,b;
				rgb565_to_rgb888(effect.color,&amp;r,&amp;g,&amp;b);
				// LOG_info(&quot;rgb %i,%i,%i\n&quot;,r,g,b);
				
				uint32_t* pixels = (uint32_t*)tmp-&gt;pixels;
				int width = tmp-&gt;w;
				int height = tmp-&gt;h;
				for (int y = 0; y &lt; height; ++y) {
				    for (int x = 0; x &lt; width; ++x) {
				        uint32_t pixel = pixels[y * width + x];
				        uint8_t _,a;
				        SDL_GetRGBA(pixel, tmp-&gt;format, &amp;_, &amp;_, &amp;_, &amp;a);
				        if (a) pixels[y * width + x] = SDL_MapRGBA(tmp-&gt;format, r,g,b, a);
				    }
				}
			}
		}
		
		if (vid.effect) SD</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 595:5 - Line 612:23), workspace\_unmaintained\zero28\platform\platform.c (Line 381:2 - Line 398:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn210" onclick="toggleCodeBlock('cloneGroup210', 'expandBtn210', 'collapseBtn210')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn210" onclick="toggleCodeBlock('cloneGroup210', 'expandBtn210', 'collapseBtn210')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup210"><code class="language-c text-sm text-gray-800">_info(&quot;getScaler for scale: %i\n&quot;, renderer-&gt;scale);
	effect.next_scale = renderer-&gt;scale;
	return scale1x1_c16;
}

void PLAT_blitRenderer(GFX_Renderer* renderer) {
	vid.blit = renderer;
	SDL_RenderClear(vid.renderer);
	resizeVideo(vid.blit-&gt;true_w,vid.blit-&gt;true_h,vid.blit-&gt;src_p);
}

static uint8_t combine_alpha(uint8_t a, uint8_t b) {
    return (a * b + 255) / 255;
}
void PLAT_flip(SDL_Surface* IGNORED, int ignored) {
	int alpha = GetBrightness();
	if (alpha&lt;5) alpha = 255 - (192 - (alpha * 192) / 5);
	else alpha = 255;

	if (!vid.blit) {
		resizeVideo(device_width,device_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 612:4 - Line 658:23), workspace\_unmaintained\zero28\platform\platform.c (Line 397:7 - Line 834:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn211" onclick="toggleCodeBlock('cloneGroup211', 'expandBtn211', 'collapseBtn211')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn211" onclick="toggleCodeBlock('cloneGroup211', 'expandBtn211', 'collapseBtn211')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup211"><code class="language-c text-sm text-gray-800">H); // !!!???
		SDL_UpdateTexture(vid.texture,NULL,vid.screen-&gt;pixels,vid.screen-&gt;pitch);
		SDL_SetTextureAlphaMod(vid.texture, alpha);
		if (rotate) SDL_RenderCopyEx(vid.renderer,vid.texture,NULL,&amp;(SDL_Rect){0,device_width,device_width,device_height},rotate*90,NULL,SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_RenderPresent(vid.renderer);
		return;
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_UpdateTexture(vid.texture,NULL,vid.blit-&gt;src,vid.blit-&gt;src_p);
	// LOG_info(&quot;blit blocked for %ims (%i,%i)\n&quot;, SDL_GetTicks()-then,vid.buffer-&gt;w,vid.buffer-&gt;h);
	
	SDL_Texture* target = vid.texture;
	int x = vid.blit-&gt;src_x;
	int y = vid.blit-&gt;src_y;
	int w = vid.blit-&gt;src_w;
	int h = vid.blit-&gt;src_h;
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetRenderTarget(vid.renderer,vid.target);
		SDL_SetTextureAlphaMod(vid.texture, 255);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_SetRenderTarget(vid.renderer,NULL);
		x *= hard_scale;
		y *= hard_scale;
		w *= hard_scale;
		h *= hard_scale;
		target = vid.target;
	}
	
	SDL_Rect* src_rect = &amp;(SDL_Rect){x,y,w,h};
	SDL_Rect* dst_rect = &amp;(SDL_Rect){0,0,device_width,device_height};
	if (vid.blit-&gt;aspect==0) { // native or cropped
		// LOG_info(&quot;src_rect %i,%i %i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 658:2 - Line 664:3), workspace\_unmaintained\zero28\platform\platform.c (Line 443:3 - Line 449:97)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn212" onclick="toggleCodeBlock('cloneGroup212', 'expandBtn212', 'collapseBtn212')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn212" onclick="toggleCodeBlock('cloneGroup212', 'expandBtn212', 'collapseBtn212')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup212"><code class="language-c text-sm text-gray-800">-&gt;x,src_rect-&gt;y,src_rect-&gt;w,src_rect-&gt;h);

		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h * vid.blit-&gt;scale;
		int x = (device_width - w) / 2;
		int y = (device_height - h) / 2;
		dst_rect-&gt;x = x;
		dst_rect-&gt;y = y;
		dst_rect-&gt;w = w;
		dst_rect-&gt;h = h;
		
		// LOG_info(&quot;dst_rect </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 672:9 - Line 728:12), workspace\_unmaintained\zero28\platform\platform.c (Line 451:2 - Line 679:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn213" onclick="toggleCodeBlock('cloneGroup213', 'expandBtn213', 'collapseBtn213')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn213" onclick="toggleCodeBlock('cloneGroup213', 'expandBtn213', 'collapseBtn213')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup213"><code class="language-c text-sm text-gray-800">arget,src_rect,&amp;(SDL_Rect){ox+dst_rect-&gt;x,oy+dst_rect-&gt;y,dst_rect-&gt;w,dst_rect-&gt;h},rotate*90,NULL,SDL_FLIP_NONE);
	else SDL_RenderCopy(vid.renderer, target, src_rect, dst_rect);
	
	updateEffect();
	if (vid.blit &amp;&amp; effect.type!=EFFECT_NONE &amp;&amp; vid.effect) {
		ox = effect.scale - (dst_rect-&gt;x % effect.scale);
		oy = effect.scale - (dst_rect-&gt;y % effect.scale);
		if (ox==effect.scale) ox = 0;
		if (oy==effect.scale) oy = 0;
		int opacity = combine_alpha(alpha, effect.opacity);
		// LOG_info(&quot;alpha: %i opacity: %i combined: %i\n percent: %f&quot;, alpha, effect.opacity, opacity, (float)opacity/255);
		SDL_SetTextureAlphaMod(vid.effect, opacity);
		if (rotate) SDL_RenderCopyEx(vid.renderer,vid.effect,dst_rect,&amp;(SDL_Rect){oy,ox+device_width,device_width,device_height},rotate*90,&amp;(SDL_Point){0,0},SDL_FLIP_NONE);
		else SDL_RenderCopy(vid.renderer, vid.effect, dst_rect,dst_rect);
	}
	
	// uint32_t then = SDL_GetTicks();
	SDL_RenderPresent(vid.renderer);
	// LOG_info(&quot;SDL_RenderPresent blocked for %ims\n&quot;, SDL_GetTicks()-then);
	vid.blit = NULL;
}

///////////////////////////////

// TODO: 
#define OVERLAY_WIDTH PILL_SIZE // unscaled
#define OVERLAY_HEIGHT PILL_SIZE // unscaled
#define OVERLAY_BPP 4
#define OVERLAY_DEPTH 16
#define OVERLAY_PITCH (OVERLAY_WIDTH * OVERLAY_BPP) // unscaled
#defi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 733:2 - Line 746:15), workspace\_unmaintained\my282\platform\platform.c (Line 672:2 - Line 684:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn214" onclick="toggleCodeBlock('cloneGroup214', 'expandBtn214', 'collapseBtn214')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn214" onclick="toggleCodeBlock('cloneGroup214', 'expandBtn214', 'collapseBtn214')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup214"><code class="language-c text-sm text-gray-800"> {
	ovl.overlay = SDL_CreateRGBSurface(SDL_SWSURFACE, SCALE2(OVERLAY_WIDTH,OVERLAY_HEIGHT),OVERLAY_DEPTH,OVERLAY_RGBA_MASK);
	return ovl.overlay;
}
void PLAT_quitOverlay(void) {
	if (ovl.overlay) SDL_FreeSurface(ovl.overlay);
}
void PLAT_enableOverlay(int enable) {

}

///////////////////////////////

static int online = 0;
void PLAT_getBatteryStatus(int* </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 751:15 - Line 761:25), workspace\_unmaintained\zero28\platform\platform.c (Line 526:11 - Line 536:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn215" onclick="toggleCodeBlock('cloneGroup215', 'expandBtn215', 'collapseBtn215')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn215" onclick="toggleCodeBlock('cloneGroup215', 'expandBtn215', 'collapseBtn215')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup215"><code class="language-c text-sm text-gray-800">playing
	     if (*charge&gt;80) *charge = 100;
	else if (*charge&gt;60) *charge =  80;
	else if (*charge&gt;40) *charge =  60;
	else if (*charge&gt;20) *charge =  40;
	else if (*charge&gt;10) *charge =  20;
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 762:2 - Line 776:7), workspace\_unmaintained\my282\platform\platform.c (Line 699:2 - Line 710:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn216" onclick="toggleCodeBlock('cloneGroup216', 'expandBtn216', 'collapseBtn216')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn216" onclick="toggleCodeBlock('cloneGroup216', 'expandBtn216', 'collapseBtn216')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup216"><code class="language-c text-sm text-gray-800">se           		 *charge =  10;
}

void PLAT_getBatteryStatusFine(int* is_charging, int* charge)
{
	// *is_charging = 0;
	// *charge = PWR_LOW_CHARGE;
	// ret</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\platform\platform.c (Line 765:2 - Line 780:8), workspace\_unmaintained\trimuismart\platform\platform.c (Line 503:16 - Line 558:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn217" onclick="toggleCodeBlock('cloneGroup217', 'expandBtn217', 'collapseBtn217')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn217" onclick="toggleCodeBlock('cloneGroup217', 'expandBtn217', 'collapseBtn217')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup217"><code class="language-c text-sm text-gray-800">atteryStatusFine(int* is_charging, int* charge)
{
	// *is_charging = 0;
	// *charge = PWR_LOW_CHARGE;
	// return;
	
	*is_charging = getInt(&quot;/sys/class/power_supply/ac/online&quot;);
	
	// fallback
	// char state[256];
	// getFile(&quot;/sys/class/power_supply/battery/status&quot;, state, 256);
	// *is_charging = prefixMatch(&quot;C</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\libmsettings\msettings.c (Line 15:1 - Line 103:2), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 14:1 - Line 121:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn218" onclick="toggleCodeBlock('cloneGroup218', 'expandBtn218', 'collapseBtn218')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn218" onclick="toggleCodeBlock('cloneGroup218', 'expandBtn218', 'collapseBtn218')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup218"><code class="language-c text-sm text-gray-800">o.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 1
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
	int hdmi; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
	.hdmi = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // should always be keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) {
			read(fd, settings, shm_size);
			// TODO: use settings-&gt;version for future proofing?
			close(fd);
		}
		else {
			// load defaults
			memcpy(settings, &amp;DefaultSettings, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
		// settings-&gt;hdmi = 0;
	}
	
	printf(&quot;brightness: %i \nspeaker: %i\n&quot;, settings-&gt;brightness, settings-&gt;speaker); fflush(stdout);
	
	SetVolume(GetVolume());
	SetBrightness(GetBrightness());
	// system(&quot;echo $(&lt; &quot; BRIGHTNESS_PATH &quot;)&quot;);
}
void QuitSettings(void) {
	munmap(settings, shm_size);
	if (is_host) shm_unlink(SHM_KEY);
}
static inline void SaveSettings(void) {
	int fd = op</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\libmsettings\msettings.c (Line 114:2 - Line 135:8), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 135:2 - Line 155:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn219" onclick="toggleCodeBlock('cloneGroup219', 'expandBtn219', 'collapseBtn219')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn219" onclick="toggleCodeBlock('cloneGroup219', 'expandBtn219', 'collapseBtn219')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup219"><code class="language-c text-sm text-gray-800">ak;
		case 1:  raw =   2;	break;
		case 2:  raw =   4;	break;
		case 3:  raw =   6;	break;
		case 4:  raw =   9;	break;
		case 5:  raw =  12;	break;
		case 6:  raw =  16;	break;
		case 7:  raw =  20;	break;
		case 8:  raw =  24;	break;
		case 9:  raw =  28; break;
		case 10: raw =  32;	break;
	}
	SetRawBrightness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	return settings-&gt;jack</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\libmsettings\msettings.c (Line 150:50 - Line 167:2), workspace\_unmaintained\my282\libmsettings\msettings.c (Line 149:54 - Line 166:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn220" onclick="toggleCodeBlock('cloneGroup220', 'expandBtn220', 'collapseBtn220')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn220" onclick="toggleCodeBlock('cloneGroup220', 'expandBtn220', 'collapseBtn220')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup220"><code class="language-c text-sm text-gray-800">t val) { // 0-32
	if (settings-&gt;hdmi) return;
	
	printf(&quot;SetRawBrightness(%i)\n&quot;, val); fflush(stdout);
	// return;

	char cmd[256];
	sprintf(cmd, &quot;echo %i &gt; &quot; BRIGHTNESS_PATH, val);
	system(cmd);
}
void SetRawVolume(int val) { // 0 - 100
	printf(&quot;SetRawVolume(%i)\n&quot;, val); fflush(stdout);
	// return;

	char cmd[256];
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\keymon\keymon.c (Line 28:1 - Line 42:20), workspace\_unmaintained\my282\keymon\keymon.c (Line 28:1 - Line 42:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn221" onclick="toggleCodeBlock('cloneGroup221', 'expandBtn221', 'collapseBtn221')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn221" onclick="toggleCodeBlock('cloneGroup221', 'expandBtn221', 'collapseBtn221')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup221"><code class="language-c text-sm text-gray-800">clude &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;dirent.h&gt;
#include &lt;linux/input.h&gt;

#include &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;

// #include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MAX 		20
#define BRIGHTNESS_MIN 	0
#define BRIGHT</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\magicmini\keymon\keymon.c (Line 45:2 - Line 143:2), workspace\_unmaintained\zero28\keymon\keymon.c (Line 59:2 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn222" onclick="toggleCodeBlock('cloneGroup222', 'expandBtn222', 'collapseBtn222')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn222" onclick="toggleCodeBlock('cloneGroup222', 'expandBtn222', 'collapseBtn222')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup222"><code class="language-c text-sm text-gray-800">RELEASED	0
#define PRESSED		1
#define REPEAT		2

#define INPUT_COUNT 2
static int inputs[INPUT_COUNT];
static struct input_event ev;

int main (int argc, char *argv[]) {
	InitSettings();
	
	// TODO: will require two inputs
	// input_fd = open(&quot;/dev/input/event0&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	inputs[0] = open(&quot;/dev/input/event2&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC); // gamepad/menu
	inputs[1] = open(&quot;/dev/input/event3&quot;, O_RDONLY | O_NONBLOCK | O_CLOEXEC); // volume
	
	uint32_t input;
	uint32_t val;
	uint32_t menu_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0;
	uint32_t down_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint8_t ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	
	gettimeofday(&amp;tod, NULL);
	then = tod.tv_sec * 1000 + tod.tv_usec / 1000; // essential SDL_GetTicks()
	ignore = 0;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		for (int i=0; i&lt;INPUT_COUNT; i++) {
			int input_fd = inputs[i];
			while(read(input_fd, &amp;ev, sizeof(ev))==sizeof(ev)) {
				if (ignore) continue;
				val = ev.value;

				if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
				// printf(&quot;code: %i (%i)\n&quot;, ev.code, val); fflush(stdout);
				switch (ev.code) {
					case CODE_MENU:
						menu_pressed = val;
					break;
					break;
					case CODE_PLUS:
						up_pressed = up_just_pressed = val;
						if (val) up_repeat_at = now + 300;
					break;
					case CODE_MINUS:
						down_pressed = down_just_pressed = val;
						if (val) down_repeat_at = now + 300;
					break;
					default:
					break;
				}
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				// printf(&quot;brightness up\n&quot;); fflush(stdout);
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else {
				// printf(&quot;volume up\n&quot;); fflush(stdout);
				val = GetVolume();
				if (val&lt;VOLUME_MAX) SetVolume(++val);
			}
			
			if (up_just_pressed) up_just_pressed = 0;
			else up_repeat_at += 100;
		}
		
		if (down_just_pressed ||</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 48:4 - Line 53:2), workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 66:3 - Line 87:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn223" onclick="toggleCodeBlock('cloneGroup223', 'expandBtn223', 'collapseBtn223')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn223" onclick="toggleCodeBlock('cloneGroup223', 'expandBtn223', 'collapseBtn223')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup223"><code class="language-c text-sm text-gray-800">clude &lt;errno.h&gt;

#include &lt;msettings.h&gt;

#include &quot;defines.h&quot;
#include &quot;platform.h&quot;
#include &quot;api.h&quot;
#include &quot;utils.h&quot;

#include &quot;scaler.h&quot;

/////</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 53:1 - Line 105:63), workspace\_unmaintained\rgb30\platform\platform.c (Line 61:1 - Line 113:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn224" onclick="toggleCodeBlock('cloneGroup224', 'expandBtn224', 'collapseBtn224')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn224" onclick="toggleCodeBlock('cloneGroup224', 'expandBtn224', 'collapseBtn224')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup224"><code class="language-c text-sm text-gray-800">///////////////////////////

#define RAW_UP		103
#define RAW_DOWN	108
#define RAW_LEFT	105
#define RAW_RIGHT	106
#define RAW_A		48
#define RAW_B		30
#define RAW_X		21
#define RAW_Y		45
#define RAW_START	28
#define RAW_SELECT	54
#define RAW_MENU	115
#define RAW_L1		38
#define RAW_L2		44
#define RAW_R1		19
#define RAW_R2		46
#define RAW_PLUS	115
#define RAW_MINUS	114

#define RAW_MENU1	RAW_PLUS
#define RAW_MENU2	RAW_MINUS

#define INPUT_COUNT 4
static int inputs[INPUT_COUNT];

void PLAT_initInput(void) {
	char path[256];
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		sprintf(path, &quot;/dev/input/event%i&quot;, i);
		inputs[i] = open(path, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	}
}
void PLAT_quitInput(void) {
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		close(inputs[i]);
	}
}

// from &lt;linux/input.h&gt; which has BTN_ constants that conflict with platform.h
struct input_event {
	struct timeval time;
	__u16 type;
	__u16 code;
	__s32 value;
};
#define EV_KEY			0x01
#define EV_ABS			0x03

void PLAT_pollInput(void) {
	// reset transient state
	pad.just_pressed = BTN_NONE;
	pad.just_released = BTN_NONE;
	pad.just_repeated = BTN_NONE;

	uint32_t tick = SDL_GetTicks();
	for (int i=0; i&lt;BTN_ID_COUNT; i++) {
		int btn = 1 &lt;&lt; i;
		if ((pad.is_pressed &amp; btn) &amp;&amp; (tick&gt;=pad.repeat_at</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 106:7 - Line 123:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 114:7 - Line 132:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn225" onclick="toggleCodeBlock('cloneGroup225', 'expandBtn225', 'collapseBtn225')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn225" onclick="toggleCodeBlock('cloneGroup225', 'expandBtn225', 'collapseBtn225')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup225"><code class="language-c text-sm text-gray-800">
			pad.just_repeated |= btn; // set
			pad.repeat_at[i] += PAD_REPEAT_INTERVAL;
		}
	}
	
	// the actual poll
	int input;
	static struct input_event event;
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		input = inputs[i];
		while (read(input, &amp;event, sizeof(event))==sizeof(event)) {
			if (event.type!=EV_KEY &amp;&amp; event.type!=EV_ABS) continue;

			int btn = BTN_NONE;
			int pressed = 0; // 0=up,1=down
			int id = -1;
			int type = event.type;
			int code = event.code;
			int value = event.value;
			
			// TODO: tmp, hardcoded, missing some buttons
			if (type==EV_KEY) {
				if (value&gt;1) continue; // ignore repeats
				
				pressed = value;
				// LOG_info(&quot;key event: %i (%i)\n&quot;, code,pressed); // no L3/R3
					 if (code==RAW_UP) 		{ btn = BTN_DPAD_UP; 		id = BTN_ID_DPAD_UP; }
	 			else if (code==RAW_DOWN)	{ btn = BTN_DPAD_DOWN; 		id = BTN_ID_DPAD_DOWN; }
				else if (code==RAW_LEFT)	{ btn = BTN_DPAD_LEFT; 		id = BTN_ID_DPAD_LEFT; }
				else if (code==RAW_RIGHT)	{ btn = BTN_DPAD_RIGHT; 	id = BTN_ID_DPAD_RIGHT; }
				else if (code==RAW_A)		{ btn = BTN_A; 				id = BTN_ID_A; }
				else if (code==RAW_B)		{ btn = BTN_B; 				id = BTN_ID_B; }
				else if (code==RAW_X)		{ btn = BTN_X</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 131:5 - Line 157:2), workspace\_unmaintained\rgb30\platform\platform.c (Line 146:5 - Line 172:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn226" onclick="toggleCodeBlock('cloneGroup226', 'expandBtn226', 'collapseBtn226')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn226" onclick="toggleCodeBlock('cloneGroup226', 'expandBtn226', 'collapseBtn226')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup226"><code class="language-c text-sm text-gray-800">TN_ID_MENU; }
				else if (code==RAW_MENU2)	{ btn = BTN_MENU; 			id = BTN_ID_MENU; }
				else if (code==RAW_L1)		{ btn = BTN_L1; 			id = BTN_ID_L1; }
				else if (code==RAW_L2)		{ btn = BTN_L2; 			id = BTN_ID_L2; }
				else if (code==RAW_R1)		{ btn = BTN_R1; 			id = BTN_ID_R1; }
				else if (code==RAW_R2)		{ btn = BTN_R2; 			id = BTN_ID_R2; }
			}
			else if (type==EV_ABS) {
				// LOG_info(&quot;axis: %i (%i)\n&quot;,code,value);
				// else if (code==RAW_LSX) pad.laxis.x = (value * 32767) / 4096;
				// else if (code==RAW_LSY) pad.laxis.y = (value * 32767) / 4096;
				// else if (code==RAW_RSX) pad.raxis.x = (value * 32767) / 4096;
				// else if (code==RAW_RSY) pad.raxis.y = (</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 245:2 - Line 261:11), workspace\_unmaintained\rgb30\platform\platform.c (Line 310:2 - Line 326:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn227" onclick="toggleCodeBlock('cloneGroup227', 'expandBtn227', 'collapseBtn227')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn227" onclick="toggleCodeBlock('cloneGroup227', 'expandBtn227', 'collapseBtn227')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup227"><code class="language-c text-sm text-gray-800">renderer = SDL_CreateRenderer(vid.window,-1,SDL_RENDERER_ACCELERATED|SDL_RENDERER_PRESENTVSYNC);
	// SDL_RenderSetVSync(vid.renderer, 0); // added SDL 2.0.18, m17 has 2.0.7
	
	// SDL_RendererInfo info;
	// SDL_GetRendererInfo(vid.renderer, &amp;info);
	// LOG_info(&quot;Current re</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 255:9 - Line 266:19), workspace\_unmaintained\zero28\platform\platform.c (Line 137:5 - Line 149:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn228" onclick="toggleCodeBlock('cloneGroup228', 'expandBtn228', 'collapseBtn228')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn228" onclick="toggleCodeBlock('cloneGroup228', 'expandBtn228', 'collapseBtn228')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup228"><code class="language-c text-sm text-gray-800">erInfo info;
	// SDL_GetRendererInfo(vid.renderer, &amp;info);
	// LOG_info(&quot;Current render driver: %s\n&quot;, info.name);
	
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 265:7 - Line 278:11), workspace\_unmaintained\zero28\platform\platform.c (Line 149:7 - Line 162:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn229" onclick="toggleCodeBlock('cloneGroup229', 'expandBtn229', 'collapseBtn229')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn229" onclick="toggleCodeBlock('cloneGroup229', 'expandBtn229', 'collapseBtn229')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup229"><code class="language-c text-sm text-gray-800">TUREACCESS_STREAMING, w,h);
	vid.target	= NULL; // only needed for non-native sizes
	
	vid.buffer	= SDL_CreateRGBSurfaceFrom(NULL, w,h, FIXED_DEPTH, p, RGBA_MASK_565);
	vid.screen	= SDL_CreateRGBSurface(SDL_SWSURFACE, w,h, FIXED_DEPTH, RGBA_MASK_565); // is this necessary any more?
	vid.width	= w;
	vid.</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 301:11 - Line 326:72), workspace\_unmaintained\zero28\platform\platform.c (Line 181:16 - Line 206:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn230" onclick="toggleCodeBlock('cloneGroup230', 'expandBtn230', 'collapseBtn230')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn230" onclick="toggleCodeBlock('cloneGroup230', 'expandBtn230', 'collapseBtn230')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup230"><code class="language-c text-sm text-gray-800">yWindow(vid.window);
	SDL_Quit();

	system(&quot;cat /dev/zero &gt; /dev/fb0 2&gt;/dev/null&quot;);
}

void PLAT_clearVideo(SDL_Surface* screen) {
	SDL_FillRect(screen, NULL, 0); // TODO: revisit
}
void PLAT_clearAll(void) {
	clearVideo();
}

void PLAT_setVsync(int vsync) {
	
}

static int hard_scale = 4; // TODO: base src size, eg. 160x144 can be 4 o

static void resizeVideo(int w, int h, int p) {
	if (w==vid.width &amp;&amp; h==vid.height &amp;&amp; p==vid.pitch) return;
	
	if (w&gt;=FIXED_WIDTH &amp;&amp; h&gt;=FIXED_HEIGHT) {
		hard_scale = 1;
	}
	else if (h&gt;=160) {
		hard_scale = 2;
	}
	else {
		hard_scale = 4;
	}

	// TODO: figure out how to ignore minarch upscale requests
	LOG_info(&quot;resizeVideo(%i,%i,%i) hard_scale: %i\n&quot;,w,h,p, hard_scale);

	SDL_FreeSurface(vid.buffer);
	SDL_DestroyTexture(vid.texture);
	if (vid.target) SDL_DestroyTexture(vid.target);
	
	SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, v</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 327:2 - Line 344:5), workspace\_unmaintained\zero28\platform\platform.c (Line 206:2 - Line 224:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn231" onclick="toggleCodeBlock('cloneGroup231', 'expandBtn231', 'collapseBtn231')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn231" onclick="toggleCodeBlock('cloneGroup231', 'expandBtn231', 'collapseBtn231')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup231"><code class="language-c text-sm text-gray-800">.sharpness==SHARPNESS_SOFT?&quot;1&quot;:&quot;0&quot;, SDL_HINT_OVERRIDE);
	vid.texture = SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_STREAMING, w,h);
	
	if (vid.sharpness==SHARPNESS_CRISP) {
		SDL_SetHintWithPriority(SDL_HINT_RENDER_SCALE_QUALITY, &quot;1&quot;, SDL_HINT_OVERRIDE);
		vid.target	= SDL_CreateTexture(vid.renderer,SDL_PIXELFORMAT_RGB565, SDL_TEXTUREACCESS_T</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 353:13 - Line 364:12), workspace\_unmaintained\zero28\platform\platform.c (Line 367:13 - Line 379:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn232" onclick="toggleCodeBlock('cloneGroup232', 'expandBtn232', 'collapseBtn232')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn232" onclick="toggleCodeBlock('cloneGroup232', 'expandBtn232', 'collapseBtn232')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup232"><code class="language-c text-sm text-gray-800"> h;
	vid.pitch	= p;
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int p) {
	// LOG_info(&quot;Current audio driver: %s\n&quot;, SDL_GetCurrentAudioDriver());
	resizeVideo(w,h,p);
	return vid.screen;
}

void PLAT_setVideoScaleClip(int x, int y, int width, int height) {
	// buh
}
v</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 382:8 - Line 389:2), workspace\_unmaintained\zero28\platform\platform.c (Line 393:6 - Line 400:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn233" onclick="toggleCodeBlock('cloneGroup233', 'expandBtn233', 'collapseBtn233')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn233" onclick="toggleCodeBlock('cloneGroup233', 'expandBtn233', 'collapseBtn233')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup233"><code class="language-c text-sm text-gray-800">?
		SDL_LockTexture(vid.texture,NULL,&amp;vid.buffer-&gt;pixels,&amp;vid.buffer-&gt;pitch);
		SDL_BlitSurface(vid.screen, NULL, vid.buffer, NULL);
		SDL_UnlockTexture(vid.texture);
		SDL_RenderCopy(vid.renderer, vid.texture, NULL,NULL);
		SDL_RenderPresent</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 417:2 - Line 446:5), workspace\_unmaintained\zero28\platform\platform.c (Line 456:2 - Line 485:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn234" onclick="toggleCodeBlock('cloneGroup234', 'expandBtn234', 'collapseBtn234')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn234" onclick="toggleCodeBlock('cloneGroup234', 'expandBtn234', 'collapseBtn234')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup234"><code class="language-c text-sm text-gray-800">t* src_rect = &amp;(SDL_Rect){0,0,w,h};
	SDL_Rect* dst_rect = NULL;
	if (vid.blit-&gt;aspect==0) { // native or cropped
		int w = vid.blit-&gt;src_w * vid.blit-&gt;scale;
		int h = vid.blit-&gt;src_h * vid.blit-&gt;scale;
		int x = (FIXED_WIDTH - w) / 2;
		int y = (FIXED_HEIGHT - h) / 2;
		dst_rect = &amp;(SDL_Rect){x,y,w,h};
	}
	else if (vid.blit-&gt;aspect&gt;0) { // aspect
		int h = FIXED_HEIGHT;
		int w = h * vid.blit-&gt;aspect;
		if (w&gt;FIXED_WIDTH) {
			double ratio = 1 / vid.blit-&gt;aspect;
			w = FIXED_WIDTH;
			h = w * ratio;
		}</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 454:2 - Line 464:5), workspace\_unmaintained\zero28\platform\platform.c (Line 494:7 - Line 505:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn235" onclick="toggleCodeBlock('cloneGroup235', 'expandBtn235', 'collapseBtn235')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn235" onclick="toggleCodeBlock('cloneGroup235', 'expandBtn235', 'collapseBtn235')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup235"><code class="language-c text-sm text-gray-800">efine OVERLAY_HEIGHT PILL_SIZE // unscaled
#define OVERLAY_BPP 4
#define OVERLAY_DEPTH 16
#define OVERLAY_PITCH (OVERLAY_WIDTH * OVERLAY_BPP) // unscaled
#define OVERLAY_RGBA_MASK 0x00ff000</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 490:2 - Line 506:66), workspace\_unmaintained\zero28\platform\platform.c (Line 532:2 - Line 511:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn236" onclick="toggleCodeBlock('cloneGroup236', 'expandBtn236', 'collapseBtn236')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn236" onclick="toggleCodeBlock('cloneGroup236', 'expandBtn236', 'collapseBtn236')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup236"><code class="language-c text-sm text-gray-800"> =  10;
}

void PLAT_getBatteryStatusFine(int* is_charging, int* charge)
{
	// *is_charging = 0;
	// *charge = PWR_LOW_CHARGE;
	// return;
	
	char state[256];
	
	// works with old model
	getFile(&quot;/sys/class/udc/10180000.usb/state&quot;, state, 256);
	*is_charging = strncmp(&quot;not attached&quot;,state,strle</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\platform\platform.c (Line 507:1 - Line 518:6), workspace\_unmaintained\trimuismart\platform\platform.c (Line 522:1 - Line 533:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn237" onclick="toggleCodeBlock('cloneGroup237', 'expandBtn237', 'collapseBtn237')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn237" onclick="toggleCodeBlock('cloneGroup237', 'expandBtn237', 'collapseBtn237')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup237"><code class="language-c text-sm text-gray-800">(&quot;not attached&quot;)); // I don't understand how this works, if it's a match it would equal 0 which is false...
	
	// nothing works with new model :sob:
	// getFile(&quot;/sys/class/</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 22:2 - Line 88:86), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 25:2 - Line 91:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn238" onclick="toggleCodeBlock('cloneGroup238', 'expandBtn238', 'collapseBtn238')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn238" onclick="toggleCodeBlock('cloneGroup238', 'expandBtn238', 'collapseBtn238')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup238"><code class="language-c text-sm text-gray-800">fcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[3]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

// #define BACKLIGHT_PATH &quot;/sys/class/backlight/backlight/bl_power&quot;
// #define BRIGHTNESS_PATH &quot;/sys/class/backlight/backlight/brightness&quot;
// #define JACK_STATE_PATH &quot;/sys/bus/platform/devices/singleadc-joypad/hp&quot;
// #define HDMI_STATE_PATH &quot;/sys/class/extcon/hdmi/cable.0/state&quot;

int getInt(char* path) {
	int i = 0;
	FILE *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}


void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		// puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		// puts(&quot;Settings host&quot;); // keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) {
			read(fd, settings, shm_size);
			// TODO: use settings-&gt;version for future proofing?
			</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 92:2 - Line 115:5), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 99:2 - Line 99:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn239" onclick="toggleCodeBlock('cloneGroup239', 'expandBtn239', 'collapseBtn239')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn239" onclick="toggleCodeBlock('cloneGroup239', 'expandBtn239', 'collapseBtn239')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup239"><code class="language-c text-sm text-gray-800">, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
		// settings-&gt;hdmi = 0;
	}
	// printf(&quot;brightness: %i\nspeaker: %i \n&quot;, settings-&gt;brightness, settings-&gt;speaker);
	
	// SetJack(getInt(JACK_STATE_PATH));
	// SetHDMI(getInt(HDMI_STATE_PATH));
	SetVolume(GetVolume());
	SetBrightness(GetBrightness());
}
void QuitSettings(void) {
	munmap(settings, shm_size);
	if (is_host) shm_unlink(SHM_KEY);
}
static inline void SaveSettings(void) {
	in</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 125:2 - Line 136:31), workspace\_unmaintained\magicmini\libmsettings\msettings.c (Line 113:3 - Line 124:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn240" onclick="toggleCodeBlock('cloneGroup240', 'expandBtn240', 'collapseBtn240')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn240" onclick="toggleCodeBlock('cloneGroup240', 'expandBtn240', 'collapseBtn240')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup240"><code class="language-c text-sm text-gray-800">8000; break;
		case 1: raw=7500; break;
		case 2: raw=7000; break;
		case 3: raw=6500; break; 
		case 4: raw=6000; break;
		case 5: raw=5000; break;
		case 6: raw=4000; break;
		case 7: raw=3000; break;
		case 8: raw=2000; break;
		case 9: raw=1</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 138:2 - Line 146:25), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 147:2 - Line 155:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn241" onclick="toggleCodeBlock('cloneGroup241', 'expandBtn241', 'collapseBtn241')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn241" onclick="toggleCodeBlock('cloneGroup241', 'expandBtn241', 'collapseBtn241')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup241"><code class="language-c text-sm text-gray-800"> break;
		case 10: raw=0; break;
	}
	SetRawBrightness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	return settings-&gt;jack ? settings-&gt;headphones : settings-&gt;spea</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 149:16 - Line 156:7), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 159:16 - Line 166:54)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn242" onclick="toggleCodeBlock('cloneGroup242', 'expandBtn242', 'collapseBtn242')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn242" onclick="toggleCodeBlock('cloneGroup242', 'expandBtn242', 'collapseBtn242')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup242"><code class="language-c text-sm text-gray-800">
	else settings-&gt;speaker = value;

	int raw = value * 5;
	SetRawVolume(raw);
	SaveSettings();
}

void SetRawBrightne</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 151:4 - Line 158:64), workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 161:6 - Line 168:53)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn243" onclick="toggleCodeBlock('cloneGroup243', 'expandBtn243', 'collapseBtn243')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn243" onclick="toggleCodeBlock('cloneGroup243', 'expandBtn243', 'collapseBtn243')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup243"><code class="language-c text-sm text-gray-800">lue * 5;
	SetRawVolume(raw);
	SaveSettings();
}

void SetRawBrightness(int val) { // 8000-0 (&gt;8000 == off)
	// if (settings-&gt;hdmi) return;
	printf(&quot;SetRawBrightness(%i)\n&quot;, val); fflush(stdout);
	int fd = o</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 158:64 - Line 168:7), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 168:44 - Line 178:51)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn244" onclick="toggleCodeBlock('cloneGroup244', 'expandBtn244', 'collapseBtn244')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn244" onclick="toggleCodeBlock('cloneGroup244', 'expandBtn244', 'collapseBtn244')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup244"><code class="language-c text-sm text-gray-800">pen(&quot;/dev/gpio-pwm&quot;, O_WRONLY);
	if (fd&gt;=0) {
		dprintf(fd,&quot;%d&quot;,val);
		close(fd);
	}
}
void SetRawVolume(int val) { // 0 - 100
	printf(&quot;SetRawVolume(%i)\n&quot;, val); fflush(stdou</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\libmsettings\msettings.c (Line 161:1 - Line 189:2), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 202:1 - Line 231:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn245" onclick="toggleCodeBlock('cloneGroup245', 'expandBtn245', 'collapseBtn245')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn245" onclick="toggleCodeBlock('cloneGroup245', 'expandBtn245', 'collapseBtn245')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup245"><code class="language-c text-sm text-gray-800">tf(fd,&quot;%d&quot;,val);
		close(fd);
	}
}
void SetRawVolume(int val) { // 0 - 100
	printf(&quot;SetRawVolume(%i)\n&quot;, val); fflush(stdout);
	char cmd[256];
	sprintf(cmd, &quot;amixer cset name='Master Playback Volume' %i%%,0 &amp;&gt; /dev/null&quot;, val);
	// puts(cmd); fflush(stdout);
	system(cmd);
}

// monitored and set by thread in keymon
int GetJack(void) {
	return settings-&gt;jack;
}
void SetJack(int value) {
	printf(&quot;SetJack(%i)\n&quot;, value); fflush(stdout);

	settings-&gt;jack = value;
	SetVolume(GetVolume());
}

int GetHDMI(void) {	
	// printf(&quot;GetHDMI() %i\n&quot;, settings-&gt;hdmi); fflush(stdout);
	// return settings-&gt;hdmi;
	return 0;
}
void SetHDMI(int value) {
	// printf</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 42:1 - Line 72:7), workspace\_unmaintained\zero28\libmsettings\msettings.c (Line 50:1 - Line 63:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn246" onclick="toggleCodeBlock('cloneGroup246', 'expandBtn246', 'collapseBtn246')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn246" onclick="toggleCodeBlock('cloneGroup246', 'expandBtn246', 'collapseBtn246')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup246"><code class="language-c text-sm text-gray-800">.h&gt;
#include &lt;pthread.h&gt;

#include &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;

// #include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MAX 		20
#define BRIGHTNESS_MIN 	0
#define BRIGHTNESS_MAX 	10

#define CODE_PLUS		115
#define CODE_MINUS		114

#define CODE_SELECT		 54
#define CODE_START		 28
#define CODE_L1		 	 38
#define CODE_R1		 	 19

#define RELEASED	0
#define PRESSED		1

#define INPUT_COUNT 4
static int inputs[INPUT_COUNT];
static struct input_event ev;

static pthread_t ports_pt;
#define JAC</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 64:15 - Line 76:4), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 69:9 - Line 82:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn247" onclick="toggleCodeBlock('cloneGroup247', 'expandBtn247', 'collapseBtn247')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn247" onclick="toggleCodeBlock('cloneGroup247', 'expandBtn247', 'collapseBtn247')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup247"><code class="language-c text-sm text-gray-800">static struct input_event ev;

static pthread_t ports_pt;
#define JACK_STATE_PATH &quot;/sys/devices/virtual/switch/h2w/state&quot; // 0 or 2

int getInt(char* path) {
	int i = 0;
	FILE *file = f</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 76:2 - Line 82:72), workspace\_unmaintained\m17\platform\platform.c (Line 48:2 - Line 87:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn248" onclick="toggleCodeBlock('cloneGroup248', 'expandBtn248', 'collapseBtn248')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn248" onclick="toggleCodeBlock('cloneGroup248', 'expandBtn248', 'collapseBtn248')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup248"><code class="language-c text-sm text-gray-800">ILE *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}

static void* watchPorts(void *arg) {
	int has_headphones,had_headphones;
	
	has_headphones = had_headphones = getInt(JACK_STA</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 83:2 - Line 103:4), workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 30:2 - Line 50:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn249" onclick="toggleCodeBlock('cloneGroup249', 'expandBtn249', 'collapseBtn249')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn249" onclick="toggleCodeBlock('cloneGroup249', 'expandBtn249', 'collapseBtn249')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup249"><code class="language-c text-sm text-gray-800">_PATH);
	SetJack(has_headphones);
	
	while(1) {
		sleep(1);
		
		has_headphones = getInt(JACK_STATE_PATH);
		if (had_headphones!=has_headphones) {
			had_headphones = has_headphones;
			SetJack(has_headphones);
		}
	}
	
	return 0;
}

int main (int argc, char *argv[]) {
	printf(&quot;keymon\n&quot;); fflush(stdout);
	InitSettings();
	pthread_create(&amp;ports_pt, NULL, &amp;watchPorts, NULL);
	
	char path[256];
	for (int i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 101:5 - Line 109:3), workspace\_unmaintained\rg35xxplus\platform\platform.c (Line 362:2 - Line 88:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn250" onclick="toggleCodeBlock('cloneGroup250', 'expandBtn250', 'collapseBtn250')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn250" onclick="toggleCodeBlock('cloneGroup250', 'expandBtn250', 'collapseBtn250')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup250"><code class="language-c text-sm text-gray-800">for (int i=0; i&lt;INPUT_COUNT; i++) {
		sprintf(path, &quot;/dev/input/event%i&quot;, i);
		inputs[i] = open(path, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	}
	
	// TODO: make sure manually handlin</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 108:6 - Line 126:5), workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 50:9 - Line 69:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn251" onclick="toggleCodeBlock('cloneGroup251', 'expandBtn251', 'collapseBtn251')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn251" onclick="toggleCodeBlock('cloneGroup251', 'expandBtn251', 'collapseBtn251')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup251"><code class="language-c text-sm text-gray-800">);
	}
	
	// TODO: make sure manually handling repeat is necessary on this device
	uint32_t input;
	uint32_t val;
	uint32_t start_pressed = 0;
	uint32_t select_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0;
	uint32_t down_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint32_t now;
	struct timeval tod;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\m17\keymon\keymon.c (Line 134:4 - Line 167:2), workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 71:4 - Line 104:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn252" onclick="toggleCodeBlock('cloneGroup252', 'expandBtn252', 'collapseBtn252')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn252" onclick="toggleCodeBlock('cloneGroup252', 'expandBtn252', 'collapseBtn252')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup252"><code class="language-c text-sm text-gray-800">.type != EV_KEY ) continue;
				val = ev.value;
				switch (ev.code) {
					case CODE_START:
						start_pressed = val;
					break;
					case CODE_SELECT:
						select_pressed = val;
					break;
					case CODE_R1:
						up_pressed = up_just_pressed = val;
						if (val) up_repeat_at = now + 300;
					break;
					case CODE_L1:
						down_pressed = down_just_pressed = val;
						if (val) down_repeat_at = now + 300;
					break;
					case CODE_PLUS:
					case CODE_MINUS:
						system(&quot;echo 0 &gt; /sys/devices/platform/0gpio-keys/scaled&quot;);
						SetVolume(GetVolume());
					break;
					default:
					break;
				}
			}
		}
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (start_pressed) {
				val = GetBrightness();
				if (val&lt;BRIGHTNE</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 65:7 - Line 82:3), workspace\_unmaintained\zero28\platform\platform.c (Line 206:2 - Line 312:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn253" onclick="toggleCodeBlock('cloneGroup253', 'expandBtn253', 'collapseBtn253')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn253" onclick="toggleCodeBlock('cloneGroup253', 'expandBtn253', 'collapseBtn253')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup253"><code class="language-c text-sm text-gray-800">LAT_clearVideo(SDL_Surface* IGNORED) {
	memset(vid.screen-&gt;pixels, 0, FIXED_SIZE);
}
void PLAT_clearAll(void) {
	PLAT_clearVideo(vid.screen);
}

void PLAT_setVsync(int vsync) {
	// buh
}

SDL_Surface* PLAT_resizeVideo(int w, int h, int pitch) {
	PLAT_clearVideo(vid.screen);
	return vid.</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 303:2 - Line 309:12), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 241:3 - Line 246:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn254" onclick="toggleCodeBlock('cloneGroup254', 'expandBtn254', 'collapseBtn254')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn254" onclick="toggleCodeBlock('cloneGroup254', 'expandBtn254', 'collapseBtn254')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup254"><code class="language-c text-sm text-gray-800">le_240x160_320x213(void* __restrict src_, void* __restrict dst_, uint32_t src_w, uint32_t src_h, uint32_t src_pitch, uint32_t dst_w, uint32_t dst_h,</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 309:4 - Line 314:17), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 249:4 - Line 254:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn255" onclick="toggleCodeBlock('cloneGroup255', 'expandBtn255', 'collapseBtn255')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn255" onclick="toggleCodeBlock('cloneGroup255', 'expandBtn255', 'collapseBtn255')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup255"><code class="language-c text-sm text-gray-800">32_t dst_h, uint32_t dst_pitch) {
	uint16_t* src = src_;
	uint16_t* dst = dst_;
	
	const uint32_t src_skip = src_pitch - src_w * FIXED_BPP;
	const uint32_t dst_skip = dst_pitch - dst_w * F</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 312:4 - Line 318:13), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 260:2 - Line 266:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn256" onclick="toggleCodeBlock('cloneGroup256', 'expandBtn256', 'collapseBtn256')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn256" onclick="toggleCodeBlock('cloneGroup256', 'expandBtn256', 'collapseBtn256')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup256"><code class="language-c text-sm text-gray-800">_skip = dst_pitch - dst_w * FIXED_BPP;
	
	// upscale 3x3 pixel chunks to 4x4
	for (uint_fast16_t chunk_y=0; chunk_y&lt;src_h/3; chunk_y++) {
		for (uint_fast16_t chunk_x=0; chunk_x&lt;src</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 320:4 - Line 325:4), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 275:4 - Line 280:30)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn257" onclick="toggleCodeBlock('cloneGroup257', 'expandBtn257', 'collapseBtn257')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn257" onclick="toggleCodeBlock('cloneGroup257', 'expandBtn257', 'collapseBtn257')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup257"><code class="language-c text-sm text-gray-800">t r = (chunk_x==src_w/3-1) ? 4 : 6;

			// a b c
			// e f g
			// i j k
			
			// read src
			uint16_t aaa = (*(uint16_t*)((uint8_t*)src              ));
			uint16_t </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 331:22 - Line 338:35), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 233:22 - Line 240:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn258" onclick="toggleCodeBlock('cloneGroup258', 'expandBtn258', 'collapseBtn258')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn258" onclick="toggleCodeBlock('cloneGroup258', 'expandBtn258', 'collapseBtn258')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup258"><code class="language-c text-sm text-gray-800">  +4));

			uint16_t eee = (*(uint16_t*)((uint8_t*)src+src_pitch    ));
			uint16_t fff = (*(uint16_t*)((uint8_t*)src+src_pitch  +2));
			uint16_t ggg = (*(uint16_t*)((uint8_t*)src+src_pitch  +4));

			uint16_t iii = (*(uint16_t*)((uint8_t*)src+src_pitch*2  ));
			uint16_t jjj = (*(uint16_t*)((uint8_t*)src+src_pitch*2+2));
			uint16_t kkk = (*(uint16_t</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 345:4 - Line 350:4), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 249:4 - Line 254:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn259" onclick="toggleCodeBlock('cloneGroup259', 'expandBtn259', 'collapseBtn259')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn259" onclick="toggleCodeBlock('cloneGroup259', 'expandBtn259', 'collapseBtn259')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup259"><code class="language-c text-sm text-gray-800">: SUBPIXEL_2_1(bbb,ccc);

			uint16_t eff = likely(eee==fff) ? eee : SUBPIXEL_1_2(eee,fff);
			uint16_t ffg = likely(fff==ggg) ? fff : SUBPIXEL_2_1(fff,ggg);

			uint16_t ijj = likely(iii==jjj) ? iii : SUBPIXEL_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 462:2 - Line 475:12), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 442:2 - Line 455:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn260" onclick="toggleCodeBlock('cloneGroup260', 'expandBtn260', 'collapseBtn260')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn260" onclick="toggleCodeBlock('cloneGroup260', 'expandBtn260', 'collapseBtn260')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup260"><code class="language-c text-sm text-gray-800">uint8_t*)dst+dst_pitch  +6) = likely(bcc==eff) ? bcc : AVERAGE_2_1(bcc,eff);
			*(uint16_t*)((uint8_t*)dst+dst_pitch  +8) = likely(ccc==fff) ? ccc : AVERAGE_2_1(ccc,fff);

			*(uint16_t*)((uint8_t*)dst+dst_pitch*2  ) = ddd;
			*(uint16_t*)((uint8_t*)dst+dst_pitch*2+2) = dde;
			*(uint16_t*)((uint8_t*)dst+dst_pitch*2+4) = eee;
			*(uint16_t*)((uint8_t*)dst+dst_pitch*2+6) = eff;
			*(uint16_t*)((uint8_t*)dst+dst_pitch*2+8) = fff;
			
			*(uint16_t*)((uint8_t*)dst+dst_pitch*3  ) = likely(ddd==ggg) ? ddd : AVERAGE_2_1(ggg,ddd);
			*(uint16_t*)((uint8_t*)dst+dst_pitch*3+2) = likely(dde==ggh) ? dde : AVERAGE_2_1(ggh,dde)</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 489:4 - Line 501:2), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 443:5 - Line 475:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn261" onclick="toggleCodeBlock('cloneGroup261', 'expandBtn261', 'collapseBtn261')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn261" onclick="toggleCodeBlock('cloneGroup261', 'expandBtn261', 'collapseBtn261')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup261"><code class="language-c text-sm text-gray-800">*)((uint8_t*)dst+dst_pitch*4+4) = hhh;
			*(uint16_t*)((uint8_t*)dst+dst_pitch*4+6) = hii;
			*(uint16_t*)((uint8_t*)dst+dst_pitch*4+8) = iii;
			
			src += 3; // skip 3 columns
			dst += 5; // skip 5 columns
		}
		src = (uint16_t*)((uint8_t*)src + src_skip + (3-1) * src_pitch); // skip 3 rows
		dst = (uint16_t*)((uint8_t*)dst + dst_skip + (5-1) * dst_pitch); // skip 5 rows
	}
}

static inline void scale_256x224_320x238(void* __restrict src_, void* __restrict dst_, uint32_t src_w, uint32_t src_h, uint32_t src_pitch, uint32_t dst_w, uint32_t dst_h, uint32_t dst_pitch) {
	uint16_t* src = src_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 514:3 - Line 539:2), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 442:2 - Line 514:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn262" onclick="toggleCodeBlock('cloneGroup262', 'expandBtn262', 'collapseBtn262')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn262" onclick="toggleCodeBlock('cloneGroup262', 'expandBtn262', 'collapseBtn262')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup262"><code class="language-c text-sm text-gray-800">_y&lt;src_h; chunk_y+=16) {
		for (uint_fast16_t chunk_x=0; chunk_x&lt;src_w; chunk_x+=4) {
			
			// TODO: this is probably a terrible idea
			uint_fast16_t row;
			uint16_t a,b,c,d,e; // previous rows columns
			for (row=0; row&lt;3; row++) {
				// read src
				uint16_t aaaa = (*(uint16_t*)((uint8_t*)src+src_pitch*row ));
				uint16_t bbbb = (*(uint16_t*)((uint8_t*)src+src_pitch*row+2));
				uint16_t cccc = (*(uint16_t*)((uint8_t*)src+src_pitch*row+4));
				uint16_t dddd = (*(uint16_t*)((uint8_t*)src+src_pitch*row+6));
				
				// blend columns
				uint16_t abbb = likely(aaaa==bbbb) ? aaaa : SUBPIXEL_1_3(aaaa,bbbb);
				uint16_t bbcc = likely(bbbb==cccc) ? bbbb : SUBPIXEL_1_1(bbbb,cccc);
				uint16_t cccd = likely(cccc==dddd) ? cccc : SUBPIXEL_3_1(cccc,dddd);
				
				// write dst
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row  ) = a = aaaa;
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+2) = b = abbb;
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+4) = c = bbcc;
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+6) = </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 541:3 - Line 553:2), workspace\_unmaintained\gkdpixel\platform\platform.c (Line 442:2 - Line 454:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn263" onclick="toggleCodeBlock('cloneGroup263', 'expandBtn263', 'collapseBtn263')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn263" onclick="toggleCodeBlock('cloneGroup263', 'expandBtn263', 'collapseBtn263')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup263"><code class="language-c text-sm text-gray-800">(uint8_t*)dst+dst_pitch*row+8) = e = dddd;
			}
			
			for (row=3; row&lt;8; row++) {
				// read src
				uint16_t aaaa = (*(uint16_t*)((uint8_t*)src+src_pitch*row ));
				uint16_t bbbb = (*(uint16_t*)((uint8_t*)src+src_pitch*row+2));
				uint16_t cccc = (*(uint16_t*)((uint8_t*)src+src_pitch*row+4));
				uint16_t dddd = (*(uint16_t*)((uint8_t*)src+src_pitch*row+6));
				
				// blend columns
				uint16_t abbb = likely(aaaa==bbbb) ? aaaa : SUBPIXEL_1_3(aaaa,bbbb);
				uint16_t bbcc = likely(bbbb==cccc) ? bbbb : SUBPIXEL_1_1(bbbb,cccc);
				uint16_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 600:2 - Line 625:7), workspace\_unmaintained\trimuismart\platform\platform.c (Line 393:5 - Line 481:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn264" onclick="toggleCodeBlock('cloneGroup264', 'expandBtn264', 'collapseBtn264')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn264" onclick="toggleCodeBlock('cloneGroup264', 'expandBtn264', 'collapseBtn264')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup264"><code class="language-c text-sm text-gray-800">aaaa : SUBPIXEL_1_3(aaaa,bbbb);
				uint16_t bbcc = likely(bbbb==cccc) ? bbbb : SUBPIXEL_1_1(bbbb,cccc);
				uint16_t cccd = likely(cccc==dddd) ? cccc : SUBPIXEL_3_1(cccc,dddd);
				
				// write dst
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row  ) = AVERAGE_3_1(a,aaaa);
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+2) = AVERAGE_3_1(b,abbb);
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+4) = AVERAGE_3_1(c,bbcc);
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+6) = AVERAGE_3_1(d,cc</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 626:1 - Line 645:37), workspace\_unmaintained\rg35xx\platform\platform.c (Line 526:1 - Line 544:49)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn265" onclick="toggleCodeBlock('cloneGroup265', 'expandBtn265', 'collapseBtn265')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn265" onclick="toggleCodeBlock('cloneGroup265', 'expandBtn265', 'collapseBtn265')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup265"><code class="language-c text-sm text-gray-800">d);
				*(uint16_t*)((uint8_t*)dst+dst_pitch*row+8) = AVERAGE_3_1(e,dddd);
				
				// store src row
				a = aaaa;
				b = abbb;
				c = bbcc;
				d = cccd;
				e = dddd;
			}
			
			for (row=13; row&lt;16; row++) {
				// read src
				uint16_t aaaa = (*(uint16_t*)((uint8_t*)src+src_pitch*row ));
				uint16_t bbbb = (*(uint16_t*)((uint8_t*)src+src_pitch*row+2));
				uint16_t cccc = (*(uint16_t*)((uint8_t*)src+src_pitch*row+4));
				uint16_t dddd = (*(uint16_t*)((uint8_t*)src+src_pitch*row+6));
				
				// blend columns
				uint16_t abbb = likely(aaaa==bbbb)</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 652:2 - Line 672:7), workspace\_unmaintained\rgb30\platform\platform.c (Line 688:19 - Line 511:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn266" onclick="toggleCodeBlock('cloneGroup266', 'expandBtn266', 'collapseBtn266')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn266" onclick="toggleCodeBlock('cloneGroup266', 'expandBtn266', 'collapseBtn266')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup266"><code class="language-c text-sm text-gray-800">)dst+dst_pitch*(row+1)+2) = abbb;
				*(uint16_t*)((uint8_t*)dst+dst_pitch*(row+1)+4) = bbcc;
				*(uint16_t*)((uint8_t*)dst+dst_pitch*(row+1)+6) = cccd;
				*(uint16_t*)((uint8_t*)dst+dst_pitch*(row+1)+8) = dddd;
			}
			
			src += 4; // skip 4 columns
			dst += 5; //</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\platform\platform.c (Line 673:1 - Line 684:12), workspace\_unmaintained\trimuismart\platform\platform.c (Line 522:1 - Line 533:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn267" onclick="toggleCodeBlock('cloneGroup267', 'expandBtn267', 'collapseBtn267')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn267" onclick="toggleCodeBlock('cloneGroup267', 'expandBtn267', 'collapseBtn267')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup267"><code class="language-c text-sm text-gray-800">skip 5 columns
		}
		src = (uint16_t*)((uint8_t*)src + src_skip + (16-1) * src_pitch); // skip 16 rows
		dst = (uint16_t*)((uint8_t*)dst + dst_skip + (17-1) * dst_pitch); // skip </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\libmsettings\msettings.c (Line 15:1 - Line 86:2), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 14:1 - Line 91:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn268" onclick="toggleCodeBlock('cloneGroup268', 'expandBtn268', 'collapseBtn268')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn268" onclick="toggleCodeBlock('cloneGroup268', 'expandBtn268', 'collapseBtn268')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup268"><code class="language-c text-sm text-gray-800">o.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;sys/mman.h&gt;
#include &lt;linux/fb.h&gt;
#include &lt;sys/ioctl.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;dlfcn.h&gt;
#include &lt;string.h&gt;

#include &quot;msettings.h&quot;

///////////////////////////////////////

#define SETTINGS_VERSION 2
typedef struct Settings {
	int version; // future proofing
	int brightness;
	int headphones;
	int speaker;
	int unused[2]; // for future use
	// NOTE: doesn't really need to be persisted but still needs to be shared
	int jack; 
	int hdmi; 
} Settings;
static Settings DefaultSettings = {
	.version = SETTINGS_VERSION,
	.brightness = 2,
	.headphones = 4,
	.speaker = 8,
	.jack = 0,
	.hdmi = 0,
};
static Settings* settings;

#define SHM_KEY &quot;/SharedSettings&quot;
static char SettingsPath[256];
static int shm_fd = -1;
static int is_host = 0;
static int shm_size = sizeof(Settings);

int getInt(char* path) {
	int i = 0;
	FILE *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		fscanf(file, &quot;%i&quot;, &amp;i);
		fclose(file);
	}
	return i;
}

void InitSettings(void) {	
	sprintf(SettingsPath, &quot;%s/msettings.bin&quot;, getenv(&quot;USERDATA_PATH&quot;));
	
	shm_fd = shm_open(SHM_KEY, O_RDWR | O_CREAT | O_EXCL, 0644); // see if it exists
	if (shm_fd==-1 &amp;&amp; errno==EEXIST) { // already exists
		puts(&quot;Settings client&quot;);
		shm_fd = shm_open(SHM_KEY, O_RDWR, 0644);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
	}
	else { // host
		puts(&quot;Settings host&quot;); // should always be keymon
		is_host = 1;
		// we created it so set initial size and populate
		ftruncate(shm_fd, shm_size);
		settings = mmap(NULL, shm_size, PROT_READ | PROT_WRITE, MAP_SHARED, shm_fd, 0);
		
		int fd = open(SettingsPath, O_RDONLY);
		if (fd&gt;=0) </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\libmsettings\msettings.c (Line 88:7 - Line 112:45), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 97:5 - Line 121:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn269" onclick="toggleCodeBlock('cloneGroup269', 'expandBtn269', 'collapseBtn269')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn269" onclick="toggleCodeBlock('cloneGroup269', 'expandBtn269', 'collapseBtn269')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup269"><code class="language-c text-sm text-gray-800">settings, &amp;DefaultSettings, shm_size);
		}
		
		// these shouldn't be persisted
		// settings-&gt;jack = 0;
		// settings-&gt;hdmi = 0;
	}
	
	int jack = 0;
	int hdmi = 0;
	printf(&quot;brightness: %i (hdmi: %i)\nspeaker: %i (jack: %i)\n&quot;, settings-&gt;brightness, hdmi, settings-&gt;speaker, jack); fflush(stdout);
	
	SetBrightness(GetBrightness());
	// system(&quot;echo $(&lt; &quot; BRIGHTNESS_PATH &quot;)&quot;);
}
void QuitSettings(void) {
	munmap(settings, shm_size);
	if (is_host) shm_unlink(SHM_KEY);
}
static inline void SaveSettings(void) {
	int fd =</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\libmsettings\msettings.c (Line 117:2 - Line 137:11), workspace\_unmaintained\rgb30\libmsettings\msettings.c (Line 136:2 - Line 155:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn270" onclick="toggleCodeBlock('cloneGroup270', 'expandBtn270', 'collapseBtn270')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn270" onclick="toggleCodeBlock('cloneGroup270', 'expandBtn270', 'collapseBtn270')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup270"><code class="language-c text-sm text-gray-800">e);
		close(fd);
		sync();
	}
}

int GetBrightness(void) { // 0-10
	return settings-&gt;brightness;
}
void SetBrightness(int value) {
	if (settings-&gt;hdmi) return;
	
	// TODO: this needs a curve, 1,10,20,30 are 
	// indistinguishable, even in near dark
	int raw = value * 10;
	if (!raw) raw = 5;
	
	SetRawBrightness(raw);
	settings-&gt;brightness = value;
	SaveSettings();
}

int GetVolume(void) { // 0-20
	return settings-&gt;jack ? </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\libmsettings\msettings.c (Line 153:42 - Line 188:2), workspace\_unmaintained\rg35xxplus\libmsettings\msettings.c (Line 168:53 - Line 203:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn271" onclick="toggleCodeBlock('cloneGroup271', 'expandBtn271', 'collapseBtn271')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn271" onclick="toggleCodeBlock('cloneGroup271', 'expandBtn271', 'collapseBtn271')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup271"><code class="language-c text-sm text-gray-800">f(cmd, &quot;echo %i &gt; /sys/devices/platform/jz-pwm-dev.0/jz-pwm/pwm0/dutyratio&quot;, val);
	system(cmd);
}
void SetRawVolume(int val) { // 0 - 100
	// printf(&quot;SetRawVolume(%i)\n&quot;, val); fflush(stdout);
	
	// TODO: this is still weird
	if (val) val = 60 + (val * 2) / 5;
	char cmd[256];
	sprintf(cmd, &quot;amixer sset 'PCM' %i%% &gt; /dev/null 2&gt;&amp;1&quot;, val);
	// // puts(cmd); fflush(stdout);
	system(cmd);
}

// monitored and set by thread in keymon
int GetJack(void) {
	return settings-&gt;jack;
}
void SetJack(int value) {
	// printf(&quot;SetJack(%i)\n&quot;, value); fflush(stdout);
	
	// char cmd[256];
	// sprintf(cmd, &quot;amixer cset name='Playback Path' '%s' &amp;&gt; /dev/null&quot;, value?&quot;HP&quot;:&quot;SPK&quot;);
	// system(cmd);
	
	settings-&gt;jack = value;
	SetVolume(GetVolume());
}

int GetHDMI(void) {	
	// printf(&quot;GetHDMI() %i\n&quot;, settings-&gt;hdmi); fflush(stdout);
	return settings-&gt;hdmi;</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\keymon\keymon.c (Line 28:1 - Line 34:2), workspace\_unmaintained\trimuismart\keymon\keymon.c (Line 22:1 - Line 28:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn272" onclick="toggleCodeBlock('cloneGroup272', 'expandBtn272', 'collapseBtn272')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn272" onclick="toggleCodeBlock('cloneGroup272', 'expandBtn272', 'collapseBtn272')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup272"><code class="language-c text-sm text-gray-800">clude &lt;stdint.h&gt;
#include &lt;unistd.h&gt;
#include &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;dirent.h&gt;
#include &lt;linux/input.h&gt;

#include &lt;msettings.h&gt;

#include &lt;sys/types.h&gt;
#i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\keymon\keymon.c (Line 34:11 - Line 53:13), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 87:10 - Line 76:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn273" onclick="toggleCodeBlock('cloneGroup273', 'expandBtn273', 'collapseBtn273')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn273" onclick="toggleCodeBlock('cloneGroup273', 'expandBtn273', 'collapseBtn273')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup273"><code class="language-c text-sm text-gray-800">include &lt;sys/stat.h&gt;
#include &lt;sys/ioctl.h&gt;

#include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MAX 		20
#define BRIGHTNESS_MIN 	0
#define BRIGHTNESS_MAX 	10

//	for ev.value
#define RELEASED	0
#define PRESSED		1
#define REPEAT		2

static int	input_fd = 0;
static struct input_event ev;

int main (int argc, char *argv[]) </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\keymon\keymon.c (Line 59:2 - Line 68:6), workspace\_unmaintained\zero28\keymon\keymon.c (Line 76:2 - Line 85:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn274" onclick="toggleCodeBlock('cloneGroup274', 'expandBtn274', 'collapseBtn274')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn274" onclick="toggleCodeBlock('cloneGroup274', 'expandBtn274', 'collapseBtn274')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup274"><code class="language-c text-sm text-gray-800">menu_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0;
	uint32_t up_repeat_at = 0;
	
	uint32_t down_pressed = 0;
	uint32_t down_just_pressed = 0;
	uint32_t down_repeat_at = 0;
	
	uint8_t ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	
	// TODO: tmp
	// ui</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\keymon\keymon.c (Line 66:3 - Line 87:13), workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 100:3 - Line 112:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn275" onclick="toggleCodeBlock('cloneGroup275', 'expandBtn275', 'collapseBtn275')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn275" onclick="toggleCodeBlock('cloneGroup275', 'expandBtn275', 'collapseBtn275')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup275"><code class="language-c text-sm text-gray-800"> ignore;
	uint32_t then;
	uint32_t now;
	struct timeval tod;
	
	// TODO: tmp
	// uint32_t l1_pressed = 0;
	// uint32_t r1_pressed = 0;
	// uint32_t select_pressed = 0;
	// uint32_t start_pressed = 0;
	
	gettimeofday(&amp;tod, NULL);
	then = tod.tv_sec * 1000 + tod.tv_usec / 1000; // essential SDL_GetTicks()
	ignore = 0;
	
	while (1) {
		gettimeofday(&amp;tod, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		while(read(input_fd, &amp;ev, sizeof(ev))==sizeof(ev)) {
			if (ignore) continue;
			val = ev.value;

			if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\keymon\keymon.c (Line 92:5 - Line 105:13), workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 121:5 - Line 126:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn276" onclick="toggleCodeBlock('cloneGroup276', 'expandBtn276', 'collapseBtn276')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn276" onclick="toggleCodeBlock('cloneGroup276', 'expandBtn276', 'collapseBtn276')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup276"><code class="language-c text-sm text-gray-800">p_just_pressed = val;
					if (val) up_repeat_at = now + 300;
				break;
				case CODE_MINUS:
					down_pressed = down_just_pressed = val;
					if (val) down_repeat_at = now + 300;
				break;
				// TODO: tmp
			</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\_unmaintained\gkdpixel\keymon\keymon.c (Line 111:3 - Line 148:2), workspace\_unmaintained\rg35xxplus\keymon\keymon.c (Line 134:3 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn277" onclick="toggleCodeBlock('cloneGroup277', 'expandBtn277', 'collapseBtn277')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn277" onclick="toggleCodeBlock('cloneGroup277', 'expandBtn277', 'collapseBtn277')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup277"><code class="language-c text-sm text-gray-800">t:
				break;
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = down_just_pressed = 0;
			up_repeat_at = 0;
			down_repeat_at = 0;
		}
		
		// TODO: tmp
		// if (l1_pressed &amp;&amp; r1_pressed &amp;&amp; start_pressed &amp;&amp; select_pressed) {
		// 	system(&quot;sync &amp;&amp; killall -9 minarch.elf&quot;); // TODO: tmp
		// 	system(&quot;sync &amp;&amp; killall -9 launch.sh&quot;); // TODO: tmp
		// }
		
		if (up_just_pressed || (up_pressed &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				// printf(&quot;brightness up\n&quot;); fflush(stdout);
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else {
				// printf(&quot;volume up\n&quot;); fflush(stdout);
				val = GetVolume();
				if (val&lt;VOLUME_MAX) SetVolume(++val);
			}
			
			if (up_just_pressed) up_just_pressed = 0;
			else up_repeat_at += 100;
		}
		
		if (down_just_pressed || (down_pressed &amp;&amp; now&gt;=down_repeat_at)) {
			if (menu_pressed) {
			</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 217:2 - Line 224:29), workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 192:6 - Line 199:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn278" onclick="toggleCodeBlock('cloneGroup278', 'expandBtn278', 'collapseBtn278')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn278" onclick="toggleCodeBlock('cloneGroup278', 'expandBtn278', 'collapseBtn278')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup278"><code class="language-c text-sm text-gray-800">status = DA_CMD_SUCCESS;
	struct wifi_status s = {
		.state = STATE_UNKNOWN ,
		.ssid = {'\0'},
	};

	wmg_printf(MSG_DEBUG,&quot;ctl cmd: status start -+- \n&quot;);

	if(NULL </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 244:20 - Line 254:27), workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 214:11 - Line 199:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn279" onclick="toggleCodeBlock('cloneGroup279', 'expandBtn279', 'collapseBtn279')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn279" onclick="toggleCodeBlock('cloneGroup279', 'expandBtn279', 'collapseBtn279')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup279"><code class="language-c text-sm text-gray-800">s = DA_CMD_SUCCESS;
	struct connection_status s = {
		.ssid = {'\0'},
		.ip_address = {'\0'},
		.freq = -1,
		.rssi = -1,
		.link_speed = -1,
		.noise = -1,
	};

	wmg_printf(MSG_DEBUG,&quot;ctl cmd: info start -+- \n&quot;);

	if(NULL == p_wi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 271:4 - Line 278:27), workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 192:2 - Line 199:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn280" onclick="toggleCodeBlock('cloneGroup280', 'expandBtn280', 'collapseBtn280')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn280" onclick="toggleCodeBlock('cloneGroup280', 'expandBtn280', 'collapseBtn280')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup280"><code class="language-c text-sm text-gray-800">status = DA_CMD_SUCCESS;
	char scan_results[SCAN_MAX] = {0};
	int len = SCAN_MAX;

	wmg_printf(MSG_DEBUG,&quot;ctl cmd: scan start -+- \n&quot;);

	if(NULL == p_wifi_interfa</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 295:17 - Line 302:35), workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 192:2 - Line 199:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn281" onclick="toggleCodeBlock('cloneGroup281', 'expandBtn281', 'collapseBtn281')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn281" onclick="toggleCodeBlock('cloneGroup281', 'expandBtn281', 'collapseBtn281')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup281"><code class="language-c text-sm text-gray-800">_results[LIST_NETWORK_MAX] = {0};

	wmg_printf(MSG_DEBUG,&quot;ctl cmd: list network start -+- \n&quot;);

	if(NULL == p_wifi_interface)
		goto code_failed;

	if(p_wifi_interface-&gt;l</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 315:5 - Line 322:37), workspace\tg5040\wifimanager\daemon\wifid_ctrl.c (Line 192:2 - Line 199:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn282" onclick="toggleCodeBlock('cloneGroup282', 'expandBtn282', 'collapseBtn282')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn282" onclick="toggleCodeBlock('cloneGroup282', 'expandBtn282', 'collapseBtn282')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup282"><code class="language-c text-sm text-gray-800">onst aw_wifi_interface_t *p_wifi_interface, int fd)
{
	enum cmd_status status = DA_CMD_SUCCESS;
	struct WmgStaEvt StaEvt = {CONNECTED,WSE_UNKNOWN};

	wmg_printf(MSG_DEBUG,&quot;c</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_cmd_iface.c (Line 102:15 - Line 107:26), workspace\tg5040\wifimanager\daemon\wifid_cmd_iface.c (Line 50:2 - Line 54:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn283" onclick="toggleCodeBlock('cloneGroup283', 'expandBtn283', 'collapseBtn283')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn283" onclick="toggleCodeBlock('cloneGroup283', 'expandBtn283', 'collapseBtn283')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup283"><code class="language-c text-sm text-gray-800">d error:%s\n&quot;,strerror(errno));
		return -1;
	}

	if ((len = recvmsg(fd, &amp;msg, MSG_CMSG_CLOEXEC)) == -1)
		return -</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 72:22 - Line 85:2), workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 48:16 - Line 62:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn284" onclick="toggleCodeBlock('cloneGroup284', 'expandBtn284', 'collapseBtn284')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn284" onclick="toggleCodeBlock('cloneGroup284', 'expandBtn284', 'collapseBtn284')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup284"><code class="language-c text-sm text-gray-800">n);

end:
	handle_command_free(&amp;cli);
	return ret ;
}

int aw_wifid_get_status(struct wifi_status *sptr)
{
	struct da_requst req = {
		.command = DA_COMMAND_NET_STATUS,
		.ssid = {0},
		.pwd = {0},
	};
	struct client </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 95:27 - Line 108:18), workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 48:16 - Line 85:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn285" onclick="toggleCodeBlock('cloneGroup285', 'expandBtn285', 'collapseBtn285')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn285" onclick="toggleCodeBlock('cloneGroup285', 'expandBtn285', 'collapseBtn285')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup285"><code class="language-c text-sm text-gray-800">le_command_free(&amp;cli);
	return ret ;
}

int aw_wifid_get_connection(struct connection_status *sptr)
{
	struct da_requst req = {
		.command = DA_COMMAND_CONNECTION_INFO,
		.ssid = {0},
		.pwd = {0},
	};
	struct client cli = {
		.enable_pipe = true,
	};

	int</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 131:2 - Line 138:9), workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 55:2 - Line 85:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn286" onclick="toggleCodeBlock('cloneGroup286', 'expandBtn286', 'collapseBtn286')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn286" onclick="toggleCodeBlock('cloneGroup286', 'expandBtn286', 'collapseBtn286')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup286"><code class="language-c text-sm text-gray-800">uct client cli = {
		.enable_pipe = true,
	};

	if (NULL != ssid)
		strncpy(req.ssid,ssid,strlen(ssid));

	if (NULL != passwd)
		strncpy(req.pwd,p</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 171:24 - Line 183:4), workspace\tg5040\wifimanager\daemon\wifid_cmd_handle.c (Line 48:16 - Line 61:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn287" onclick="toggleCodeBlock('cloneGroup287', 'expandBtn287', 'collapseBtn287')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn287" onclick="toggleCodeBlock('cloneGroup287', 'expandBtn287', 'collapseBtn287')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup287"><code class="language-c text-sm text-gray-800">

end:
	handle_command_free(&amp;cli);
	return ret;
}

int aw_wifid_list_networks(char *reply, size_t len)
{
	struct da_requst req = {
		.command = DA_COMMAND_L</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\show\show.c (Line 7:1 - Line 25:7), workspace\_unmaintained\rgb30\show\show.c (Line 7:1 - Line 30:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn288" onclick="toggleCodeBlock('cloneGroup288', 'expandBtn288', 'collapseBtn288')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn288" onclick="toggleCodeBlock('cloneGroup288', 'expandBtn288', 'collapseBtn288')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup288"><code class="language-c text-sm text-gray-800">ude &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;SDL2/SDL.h&gt;
#include &lt;SDL2/SDL_image.h&gt;

SDL_Window* window;
SDL_Surface* screen;

int main(int argc , char* argv[]) {
	if (argc&lt;2) {
		puts(&quot;Usage: show.elf image.png delay&quot;);
		return 0;
	}
	
	char path[256];
	strncpy(path,argv[1],256);
	if (access(path, F_OK)!=0) return 0; // nothing to show :(
	
	int delay = a</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\show\show.c (Line 25:2 - Line 41:2), workspace\_unmaintained\rgb30\show\show.c (Line 27:2 - Line 43:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn289" onclick="toggleCodeBlock('cloneGroup289', 'expandBtn289', 'collapseBtn289')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn289" onclick="toggleCodeBlock('cloneGroup289', 'expandBtn289', 'collapseBtn289')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup289"><code class="language-c text-sm text-gray-800">
	window = SDL_CreateWindow(&quot;&quot;, SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, 0,0, SDL_WINDOW_SHOWN);
	puts(&quot;&quot;);
	
	screen = SDL_GetWindowSurface(window); 
	SDL_FillRect(screen, NULL, 0);
	 
	SDL_Surface* img = IMG_Load(path); 
	SDL_BlitSurface(img, NULL, screen, &amp;(SDL_Rect){(screen-&gt;w-img-&gt;w)/2,(screen-&gt;h-img-&gt;h)/2});
	
	SDL_UpdateWindowSurface(window);
	sleep(d</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 51:1 - Line 61:8), workspace\_unmaintained\zero28\keymon\keymon.c (Line 40:1 - Line 112:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn290" onclick="toggleCodeBlock('cloneGroup290', 'expandBtn290', 'collapseBtn290')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn290" onclick="toggleCodeBlock('cloneGroup290', 'expandBtn290', 'collapseBtn290')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup290"><code class="language-c text-sm text-gray-800">at.h&gt;
#include &lt;sys/ioctl.h&gt;

// #include &quot;defines.h&quot;

#define VOLUME_MIN 		0
#define VOLUME_MAX 		20
#define BRIGHTNESS_MIN 	0
#define BRIGHTNESS_MAX 	10
#define COLORTEMP_MIN 	</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 99:10 - Line 110:14), workspace\_unmaintained\rg35xx\keymon\keymon.c (Line 64:11 - Line 75:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn291" onclick="toggleCodeBlock('cloneGroup291', 'expandBtn291', 'collapseBtn291')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn291" onclick="toggleCodeBlock('cloneGroup291', 'expandBtn291', 'collapseBtn291')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup291"><code class="language-c text-sm text-gray-800">swallow mute val -1 on shutdown
		if (is_muted &gt;= 0 &amp;&amp; was_muted!=is_muted) {
			was_muted = is_muted;
			SetMute(is_muted);
			if (GetMute()) {
				// tmp solution
				system(&quot;echo 1500000 &gt; /sys/class/motor/voltage&quot;);
				system(&quot;echo 1 &gt; /sys/class/gp</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 110:2 - Line 129:2), workspace\_unmaintained\zero28\keymon\keymon.c (Line 61:2 - Line 80:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn292" onclick="toggleCodeBlock('cloneGroup292', 'expandBtn292', 'collapseBtn292')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn292" onclick="toggleCodeBlock('cloneGroup292', 'expandBtn292', 'collapseBtn292')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup292"><code class="language-c text-sm text-gray-800">o/gpio227/value&quot;);
				usleep(100000);
				system(&quot;echo 0 &gt; /sys/class/gpio/gpio227/value&quot;);
				usleep(100000);
				system(&quot;echo 1 &gt; /sys/class/gpio/gpio227/value&quot;);
				usleep(100000);
				system(&quot;echo 0 &gt; /sys/class/gpio/gpio227/value&quot;);
			}
		}
	}
	
	return NULL;
}

int main (int argc, char *argv[]) {
	struct sigaction sa = {0};
	sa.sa_handler = on_term;
	sigaction(SIGTERM, &amp;sa</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 129:5 - Line 140:35), workspace\_unmaintained\zero28\keymon\keymon.c (Line 80:2 - Line 91:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn293" onclick="toggleCodeBlock('cloneGroup293', 'expandBtn293', 'collapseBtn293')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn293" onclick="toggleCodeBlock('cloneGroup293', 'expandBtn293', 'collapseBtn293')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup293"><code class="language-c text-sm text-gray-800">LL);

	InitSettings();
	pthread_create(&amp;mute_pt, NULL, &amp;watchMute, NULL);

	char path[32];
	for (int i=0; i&lt;INPUT_COUNT; i++) {
		sprintf(path, &quot;/dev/input/event%i&quot;, i);
		inputs[i] = open(path, O_RDONLY | O_NONBLOCK | O_CLOEXEC);
	}
	
	uint32_t input;
	uint32_t val;
	uint32_t menu_pressed = 0;
	uint32_t menu2_pressed = 0;
	
	uint32_t up_pressed = 0;
	uint32_t up_just_pressed = 0</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 153:2 - Line 171:14), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 125:2 - Line 120:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn294" onclick="toggleCodeBlock('cloneGroup294', 'expandBtn294', 'collapseBtn294')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn294" onclick="toggleCodeBlock('cloneGroup294', 'expandBtn294', 'collapseBtn294')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup294"><code class="language-c text-sm text-gray-800">d, NULL);
		now = tod.tv_sec * 1000 + tod.tv_usec / 1000;
		if (now-then&gt;1000) ignore = 1; // ignore input that arrived during sleep
		
		for (int i=0; i&lt;INPUT_COUNT; i++) {
			input = inputs[i];
			while(read(input, &amp;ev, sizeof(ev))==sizeof(ev)) {
				if (ignore) continue;
				val = ev.value;
				if (ev.type==EV_SW) {
					//printf(&quot;switch: %i\n&quot;, ev.c</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 171:2 - Line 183:3), workspace\_unmaintained\zero28\keymon\keymon.c (Line 119:2 - Line 154:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn295" onclick="toggleCodeBlock('cloneGroup295', 'expandBtn295', 'collapseBtn295')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn295" onclick="toggleCodeBlock('cloneGroup295', 'expandBtn295', 'collapseBtn295')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup295"><code class="language-c text-sm text-gray-800">de);
					if (ev.code==CODE_JACK) {
						//printf(&quot;jack: %i\n&quot;, val);
						SetJack(val);
					}
				}
				if (( ev.type != EV_KEY ) || ( val &gt; REPEAT )) continue;
				//printf(&quot;code: %i (%i)\n&quot;, ev.code, val); fflush(stdout);
				switch (ev.code) {
					case CODE_MENU2:
						menu_pressed = val;
					break;
</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 188:4 - Line 203:3), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 153:4 - Line 168:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn296" onclick="toggleCodeBlock('cloneGroup296', 'expandBtn296', 'collapseBtn296')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn296" onclick="toggleCodeBlock('cloneGroup296', 'expandBtn296', 'collapseBtn296')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup296"><code class="language-c text-sm text-gray-800">pressed = val;
						if (val) up_repeat_at = now + 300;
					break;
					case CODE_MINUS:
						down_pressed = down_just_pressed = val;
						if (val) down_repeat_at = now + 300;
					break;
					default:
					break;
				}
			}
		}
		
		if (ignore) {
			menu_pressed = 0;
			menu2_pressed = 0;
			up_pressed = up_just_pressed = 0;
			down_pressed = d</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\tg5040\keymon\keymon.c (Line 208:4 - Line 224:4), workspace\_unmaintained\rgb30\keymon\keymon.c (Line 167:4 - Line 163:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn297" onclick="toggleCodeBlock('cloneGroup297', 'expandBtn297', 'collapseBtn297')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn297" onclick="toggleCodeBlock('cloneGroup297', 'expandBtn297', 'collapseBtn297')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup297"><code class="language-c text-sm text-gray-800"> &amp;&amp; now&gt;=up_repeat_at)) {
			if (menu_pressed) {
				val = GetBrightness();
				if (val&lt;BRIGHTNESS_MAX) SetBrightness(++val);
			}
			else if (menu2_pressed) {
				val = GetColortemp();
				if (val&lt;COLORTEMP_MAX) {
					SetColortemp(++val</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 68:2 - Line 78:16), workspace\desktop\libmsettings\msettings.c (Line 53:2 - Line 63:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn298" onclick="toggleCodeBlock('cloneGroup298', 'expandBtn298', 'collapseBtn298')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn298" onclick="toggleCodeBlock('cloneGroup298', 'expandBtn298', 'collapseBtn298')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup298"><code class="language-c text-sm text-gray-800">sn't really need to be persisted but still needs to be shared
	int jack; 
} SettingsV6;

typedef struct SettingsV7 {
	int version; // future proofing
	int brightness;
	int colortempera</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 88:2 - Line 98:19), workspace\desktop\libmsettings\msettings.c (Line 53:2 - Line 63:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn299" onclick="toggleCodeBlock('cloneGroup299', 'expandBtn299', 'collapseBtn299')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn299" onclick="toggleCodeBlock('cloneGroup299', 'expandBtn299', 'collapseBtn299')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup299"><code class="language-c text-sm text-gray-800">sn't really need to be persisted but still needs to be shared
	int jack; 
} SettingsV7;

typedef struct SettingsV8 {
	int version; // future proofing
	int brightness;
	int colortemperatur</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 109:2 - Line 125:21), workspace\desktop\libmsettings\msettings.c (Line 53:2 - Line 104:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn300" onclick="toggleCodeBlock('cloneGroup300', 'expandBtn300', 'collapseBtn300')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn300" onclick="toggleCodeBlock('cloneGroup300', 'expandBtn300', 'collapseBtn300')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup300"><code class="language-c text-sm text-gray-800">sn't really need to be persisted but still needs to be shared
	int jack; 
} SettingsV8;

typedef struct SettingsV9 {
	int version; // future proofing
	int brightness;
	int colortemperature;
	int headphones;
	int speaker;
	int mute;
	int contrast;
	int saturation;
	int exposure;
	int toggled_brightness;
	int toggled_colortemperature;
	i</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 241:16 - Line 255:2), workspace\desktop\libmsettings\msettings.c (Line 218:19 - Line 232:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn301" onclick="toggleCodeBlock('cloneGroup301', 'expandBtn301', 'collapseBtn301')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn301" onclick="toggleCodeBlock('cloneGroup301', 'expandBtn301', 'collapseBtn301')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup301"><code class="language-c text-sm text-gray-800">_contrast = old.mutedcontrast;
					msettings-&gt;toggled_exposure = old.mutedexposure;
					msettings-&gt;toggled_saturation = old.mutedsaturation;

					msettings-&gt;saturation = old.saturation;
					msettings-&gt;contrast = old.contrast;
					msettings-&gt;exposure = old.exposure;

					msettings-&gt;colortemperature = old.colortemperature;

					msettings-&gt;brightness = old.brightness;
					msettings-&gt;headphones = old.head</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 258:2 - Line 272:2), workspace\desktop\libmsettings\msettings.c (Line 218:19 - Line 232:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn302" onclick="toggleCodeBlock('cloneGroup302', 'expandBtn302', 'collapseBtn302')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn302" onclick="toggleCodeBlock('cloneGroup302', 'expandBtn302', 'collapseBtn302')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup302"><code class="language-c text-sm text-gray-800">= old.jack;
				}
				else if(version==6) {
					printf(&quot;Found settings v6.\n&quot;);
					SettingsV6 old;
					read(fd, &amp;old, sizeof(SettingsV6));
					
					msettings-&gt;saturation = old.saturation;
					msettings-&gt;contrast = old.contrast;
					msettings-&gt;exposure = old.exposure;

					msettings-&gt;colortemperature = old.colortemperature;

					msettings-&gt;brightness = old.brightness;
					msettings-&gt;headphones = old.head</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 275:2 - Line 285:2), workspace\desktop\libmsettings\msettings.c (Line 222:9 - Line 232:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn303" onclick="toggleCodeBlock('cloneGroup303', 'expandBtn303', 'collapseBtn303')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn303" onclick="toggleCodeBlock('cloneGroup303', 'expandBtn303', 'collapseBtn303')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup303"><code class="language-c text-sm text-gray-800">= old.jack;
				}
				else if(version==5) {
					printf(&quot;Found settings v5.\n&quot;);
					SettingsV5 old;
					read(fd, &amp;old, sizeof(SettingsV5));

					msettings-&gt;colortemperature = old.colortemperature;

					msettings-&gt;brightness = old.brightness;
					msettings-&gt;headphones = old.head</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 291:2 - Line 299:2), workspace\desktop\libmsettings\msettings.c (Line 224:17 - Line 232:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn304" onclick="toggleCodeBlock('cloneGroup304', 'expandBtn304', 'collapseBtn304')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn304" onclick="toggleCodeBlock('cloneGroup304', 'expandBtn304', 'collapseBtn304')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup304"><code class="language-c text-sm text-gray-800">V4 old;
					read(fd, &amp;old, sizeof(SettingsV4));

					// colortemp was 0-20 here
					msettings-&gt;colortemperature = old.colortemperature * 2;

					msettings-&gt;brightness = old.brightness;
					msettings-&gt;headphones = old.head</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\desktop\libmsettings\msettings.c (Line 302:2 - Line 310:2), workspace\desktop\libmsettings\msettings.c (Line 224:17 - Line 232:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn305" onclick="toggleCodeBlock('cloneGroup305', 'expandBtn305', 'collapseBtn305')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn305" onclick="toggleCodeBlock('cloneGroup305', 'expandBtn305', 'collapseBtn305')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup305"><code class="language-c text-sm text-gray-800">= old.jack;
				}
				else if(version==3) {
					printf(&quot;Found settings v3.\n&quot;);
					SettingsV3 old;
					read(fd, &amp;old, sizeof(SettingsV3));

					msettings-&gt;brightness = old.brightness;
					msettings-&gt;headphone</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\minput\minput.c (Line 44:1 - Line 49:9), workspace\_unmaintained\my282\tests\calibrate\calibrate.c (Line 13:1 - Line 19:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn306" onclick="toggleCodeBlock('cloneGroup306', 'expandBtn306', 'collapseBtn306')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn306" onclick="toggleCodeBlock('cloneGroup306', 'expandBtn306', 'collapseBtn306')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup306"><code class="language-c text-sm text-gray-800">face(text, NULL, dst, &amp;(SDL_Rect){point.x+(w-text-&gt;w)/2,point.y+(SCALE1(BUTTON_SIZE)-text-&gt;h)/2,text-&gt;w,text-&gt;h});
	}

	SDL_FreeSurface(te</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\minput\minput.c (Line 250:2 - Line 255:5), workspace\all\minput\minput.c (Line 240:2 - Line 245:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn307" onclick="toggleCodeBlock('cloneGroup307', 'expandBtn307', 'collapseBtn307')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn307" onclick="toggleCodeBlock('cloneGroup307', 'expandBtn307', 'collapseBtn307')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup307"><code class="language-c text-sm text-gray-800">n, PAD_isPressed(BTN_L3), x + o, y + o, 0);
			}
			
			// R3
			if (has_R3) {
				int x = FIXED_WIDTH - SCALE1(PADDING + PILL_SIZE * 3) + SCALE1(PILL_SIZE);
				int y = oy + SCALE1(PILL_SIZE*6);
				int</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\libgametimedb\gametimedb.c (Line 263:11 - Line 274:4), workspace\all\libgametimedb\gametimedb.c (Line 232:55 - Line 241:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn308" onclick="toggleCodeBlock('cloneGroup308', 'expandBtn308', 'collapseBtn308')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn308" onclick="toggleCodeBlock('cloneGroup308', 'expandBtn308', 'collapseBtn308')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup308"><code class="language-c text-sm text-gray-800">r *rom_name = removeExtension(file_name);

    char *sql = sqlite3_mprintf(&quot;SELECT id FROM rom WHERE (name=%Q OR name=%Q) AND type='ORPHAN' LIMIT 1;&quot;, rom_</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\libgametimedb\gametimedb.c (Line 283:4 - Line 294:27), workspace\all\libgametimedb\gametimedb.c (Line 232:55 - Line 274:24)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn309" onclick="toggleCodeBlock('cloneGroup309', 'expandBtn309', 'collapseBtn309')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn309" onclick="toggleCodeBlock('cloneGroup309', 'expandBtn309', 'collapseBtn309')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup309"><code class="language-c text-sm text-gray-800">ar *rom_path)
{
    int rom_id = ROM_NOT_FOUND;

    char rel_path[MAX_PATH];
    __ensure_rel_path(rel_path, rom_path);

    char *sql = sqlite3_mprintf(&quot;SELECT id FROM rom WHERE fi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\ledcontrol\ledcontrol.c (Line 123:9 - Line 134:2), workspace\all\ledcontrol\ledcontrol.c (Line 110:10 - Line 121:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn310" onclick="toggleCodeBlock('cloneGroup310', 'expandBtn310', 'collapseBtn310')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn310" onclick="toggleCodeBlock('cloneGroup310', 'expandBtn310', 'collapseBtn310')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup310"><code class="language-c text-sm text-gray-800">t_index = i;
                    break;
                }
            }
            light-&gt;color1 = bright_colors[(current_index + 1) % num_bright_colors];
        }
        else if (PAD_justPressed(BTN_LEFT))
        {
            int current_index = -1;
            for (int i = 0; i &lt; num_bright_colors; i++)
            {
                if (br</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\ledcontrol\ledcontrol.c (Line 362:2 - Line 368:19), workspace\all\ledcontrol\ledcontrol.c (Line 352:11 - Line 357:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn311" onclick="toggleCodeBlock('cloneGroup311', 'expandBtn311', 'collapseBtn311')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn311" onclick="toggleCodeBlock('cloneGroup311', 'expandBtn311', 'collapseBtn311')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup311"><code class="language-c text-sm text-gray-800">ADDING * 2);
                    GFX_blitPill(selected ? ASSET_WHITE_PILL : ASSET_BLACK_PILL, screen, 
                        &amp;(SDL_Rect){SCALE1(PADDING), y, text_width + SCALE1(BUTTON_MARGIN + BUTTON_SIZE), SCALE1(PILL_SIZE)});
                    SDL_BlitSurface(text, 
                        &amp;(SDL_Re</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\ledcontrol\ledcontrol.c (Line 373:16 - Line 383:2), workspace\all\ledcontrol\ledcontrol.c (Line 358:16 - Line 357:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn312" onclick="toggleCodeBlock('cloneGroup312', 'expandBtn312', 'collapseBtn312')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn312" onclick="toggleCodeBlock('cloneGroup312', 'expandBtn312', 'collapseBtn312')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup312"><code class="language-c text-sm text-gray-800"> y + SCALE1(BUTTON_MARGIN)
                    }, settings_values[j]);
                } else  {
                    snprintf(setting_text, sizeof(setting_text), &quot;%s: %d&quot;, settings_labels[j], settings_values[j]);
                    SDL_Surface *text = TTF_RenderUTF8_Blended(font.medium, setting_text, current_color);
                    int text_width = text-&gt;w + SCALE1(BUTTON_PADDING * 2);
                    GFX_blitPill(selected ? ASSET_WHITE_PILL : ASSET_BLACK_PILL, screen, 
                        &amp;(SDL_Rect){SCALE1(PADDING), y, text_width, SCALE1(PILL_SIZE)});
                    SDL_BlitSurface(text, 
                        </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\gametimectl\gametimectl.c (Line 46:19 - Line 54:11), workspace\all\gametimectl\gametimectl.c (Line 31:20 - Line 39:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn313" onclick="toggleCodeBlock('cloneGroup313', 'expandBtn313', 'collapseBtn313')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn313" onclick="toggleCodeBlock('cloneGroup313', 'expandBtn313', 'collapseBtn313')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup313"><code class="language-c text-sm text-gray-800"> if (i + 1 &lt; argc) {
                LOG_info(&quot;Stop tracking: %s\n&quot;, argv[i+1]);
                play_activity_stop(argv[++i]);
            }
            else {
                printf(&quot;Error: Missing rom_path argument\n&quot;);
                pri</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\common\utils.c (Line 427:2 - Line 437:8), workspace\_unmaintained\my355\libmsettings\msettings.c (Line 62:5 - Line 72:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn314" onclick="toggleCodeBlock('cloneGroup314', 'expandBtn314', 'collapseBtn314')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn314" onclick="toggleCodeBlock('cloneGroup314', 'expandBtn314', 'collapseBtn314')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup314"><code class="language-c text-sm text-gray-800">har* path) {
	close(open(path, O_RDWR|O_CREAT, 0777));
}
int toggle(char *path) {
    if (access(path, F_OK) == 0) {
        unlink(path);
        return 0;</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\common\utils.c (Line 436:1 - Line 449:5), workspace\_unmaintained\my355\libmsettings\msettings.c (Line 52:1 - Line 65:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn315" onclick="toggleCodeBlock('cloneGroup315', 'expandBtn315', 'collapseBtn315')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn315" onclick="toggleCodeBlock('cloneGroup315', 'expandBtn315', 'collapseBtn315')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup315"><code class="language-c text-sm text-gray-800">     return 0;
    } else {
        touch(path);
        return 1;
    }
}
void putFile(char* path, char* contents) {
	FILE* file = fopen(path, &quot;w&quot;);
	if (file) {
		fputs(contents, file);
		fclose(file);
	}
}
void getFile(char* path, char* buffer, size_t buffer_size) {
	FILE *file = fopen(path, &quot;r&quot;);
	if (file) {
		fseek(</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\common\utils.c (Line 476:1 - Line 483:9), workspace\_unmaintained\my355\libmsettings\msettings.c (Line 71:1 - Line 78:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn316" onclick="toggleCodeBlock('cloneGroup316', 'expandBtn316', 'collapseBtn316')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn316" onclick="toggleCodeBlock('cloneGroup316', 'expandBtn316', 'collapseBtn316')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup316"><code class="language-c text-sm text-gray-800">LL)
        return i;
    
	FILE *file = fopen(path, &quot;r&quot;);
	if (file!=NULL) {
		int res = fscanf(file, &quot;%i&quot;, &amp;i);
		fclose</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\clock\clock.c (Line 22:1 - Line 30:30), workspace\_unmaintained\my282\tests\calibrate\calibrate.c (Line 13:1 - Line 52:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn317" onclick="toggleCodeBlock('cloneGroup317', 'expandBtn317', 'collapseBtn317')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn317" onclick="toggleCodeBlock('cloneGroup317', 'expandBtn317', 'collapseBtn317')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup317"><code class="language-c text-sm text-gray-800">clude &quot;utils.h&quot;

enum {
	CURSOR_YEAR,
	CURSOR_MONTH,
	CURSOR_DAY,
	CURSOR_HOUR,
	CURSOR_MINUTE,
	CURSOR_SECOND,
	CURSOR_AMPM,
};

int main(int argc , char* argv[]) {
	PWR_setCPUSpeed(CPU_SPEE</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\clock\clock.c (Line 238:5 - Line 250:3), workspace\all\ledcontrol\ledcontrol.c (Line 255:13 - Line 267:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn318" onclick="toggleCodeBlock('cloneGroup318', 'expandBtn318', 'collapseBtn318')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn318" onclick="toggleCodeBlock('cloneGroup318', 'expandBtn318', 'collapseBtn318')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup318"><code class="language-c text-sm text-gray-800">n_count) select_cursor -= option_count;
			
			if (show_24hour) {
				system(&quot;touch &quot; USERDATA_PATH &quot;/show_24hour&quot;);
			}
			else {
				system(&quot;rm &quot; USERDATA_PATH &quot;/show_24hour&quot;);
			}
		}
		
		PWR_update(&amp;dirty, NULL, NULL,NULL);
		
		int is_online =</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\bootlogo\bootlogo.c (Line 13:1 - Line 30:12), workspace\all\gametime\gametime.c (Line 30:1 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn319" onclick="toggleCodeBlock('cloneGroup319', 'expandBtn319', 'collapseBtn319')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn319" onclick="toggleCodeBlock('cloneGroup319', 'expandBtn319', 'collapseBtn319')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup319"><code class="language-c text-sm text-gray-800">dio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdbool.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;dirent.h&gt;
#include &lt;signal.h&gt;
#include &lt;msettings.h&gt;

#include &quot;defines.h&quot;
#include &quot;api.h&quot;
#include &quot;utils.h&quot;

static bool quit = false;

static void sig</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\bootlogo\bootlogo.c (Line 85:7 - Line 101:11), workspace\all\gametime\gametime.c (Line 329:15 - Line 345:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn320" onclick="toggleCodeBlock('cloneGroup320', 'expandBtn320', 'collapseBtn320')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn320" onclick="toggleCodeBlock('cloneGroup320', 'expandBtn320', 'collapseBtn320')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup320"><code class="language-c text-sm text-gray-800">5, 150, 200);
        }
        return 0;
    }
    return count;
}

void unloadImages()
{
    for (int i = 0; i &lt; count; i++)
    {
        SDL_FreeSurface(images[i]);
    }
    free(images);
}

int main(int argc, char *argv[])
{
    InitSettings</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\bootlogo\bootlogo.c (Line 101:2 - Line 113:102), workspace\all\clock\clock.c (Line 140:2 - Line 151:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn321" onclick="toggleCodeBlock('cloneGroup321', 'expandBtn321', 'collapseBtn321')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn321" onclick="toggleCodeBlock('cloneGroup321', 'expandBtn321', 'collapseBtn321')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup321"><code class="language-c text-sm text-gray-800">;

    PWR_setCPUSpeed(CPU_SPEED_MENU);

    screen = GFX_init(MODE_MAIN);
    PAD_init();
    PWR_init();

    signal(SIGINT, sigHandler);
    signal(SIGTERM, sigHandler);

    loadImages();

    int dirty = 1;
    int show_setting = 0;
    int was_online = PLAT_isOnline();
    int had_bt = PLAT_btIsConnected();
    while (!</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\bootlogo\bootlogo.c (Line 106:2 - Line 120:9), workspace\all\gametime\gametime.c (Line 357:2 - Line 370:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn322" onclick="toggleCodeBlock('cloneGroup322', 'expandBtn322', 'collapseBtn322')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn322" onclick="toggleCodeBlock('cloneGroup322', 'expandBtn322', 'collapseBtn322')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup322"><code class="language-c text-sm text-gray-800">NT, sigHandler);
    signal(SIGTERM, sigHandler);

    loadImages();

    int dirty = 1;
    int show_setting = 0;
    int was_online = PLAT_isOnline();
    int had_bt = PLAT_btIsConnected();
    while (!quit)
    {
        uint32_t frame_start = SDL_GetTicks();

        PAD_poll();

        // This might be too harsh, but ignore all combos wi</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\bootlogo\bootlogo.c (Line 152:2 - Line 170:10), workspace\all\clock\clock.c (Line 234:2 - Line 251:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn323" onclick="toggleCodeBlock('cloneGroup323', 'expandBtn323', 'collapseBtn323')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn323" onclick="toggleCodeBlock('cloneGroup323', 'expandBtn323', 'collapseBtn323')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup323"><code class="language-c text-sm text-gray-800">eboot&quot;, boot_path, boot_path, logo_path, boot_path, boot_path);
                system(cmd);
            }
            else if (PAD_justPressed(BTN_B))
            {
                quit = 1;
            }
        }

        PWR_update(&amp;dirty, NULL, NULL, NULL);

        int is_online = PLAT_isOnline();
        if (was_online != is_online)
            dirty = 1;
        was_onl</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 112:2 - Line 129:5), workspace\all\gametime\gametime.c (Line 30:6 - Line 50:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn324" onclick="toggleCodeBlock('cloneGroup324', 'expandBtn324', 'collapseBtn324')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn324" onclick="toggleCodeBlock('cloneGroup324', 'expandBtn324', 'collapseBtn324')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup324"><code class="language-c text-sm text-gray-800">a available before attempting an estimation
#define GRAPH_MIN_SESSION_FOR_ESTIMATION 1200
// Cutoff at 15h standby time
#define GRAPH_MAX_PLAUSIBLE_ESTIMATION 54000
#define GRAPH_ESTIMATED_LINE_GAP 20
</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 192:1 - Line 200:2), workspace\all\gametime\gametime.c (Line 66:1 - Line 73:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn325" onclick="toggleCodeBlock('cloneGroup325', 'expandBtn325', 'collapseBtn325')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn325" onclick="toggleCodeBlock('cloneGroup325', 'expandBtn325', 'collapseBtn325')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup325"><code class="language-c text-sm text-gray-800"> y1);

    if (x1 &lt; x2)
    {
        sx = 1;
    }
    else
    {
        sx = -1;
    }

    if (y1 &lt; y2)
    {
        sy = 1;
    }
    else
    {
        sy = -1;
    }

    err = dx - dy;

    while (1)
    {
        SDL_Rect pixel = {x1, y1, SCALE1(1), SCALE1(1)};
        SDL_FillRect(screen, &amp;pixel, color);

        if (x1 == x2 &amp;&amp; y1 == y2)
        {
          </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 200:2 - Line 218:5), workspace\all\gametime\gametime.c (Line 73:2 - Line 91:36)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn326" onclick="toggleCodeBlock('cloneGroup326', 'expandBtn326', 'collapseBtn326')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn326" onclick="toggleCodeBlock('cloneGroup326', 'expandBtn326', 'collapseBtn326')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup326"><code class="language-c text-sm text-gray-800"> break;
        }

        e2 = 2 * err;

        if (e2 &gt; -dy)
        {
            err -= dy;
            x1 += sx;
        }

        if (e2 &lt; dx)
        {
            err += dx;
            y1 += sy;
        }
    }
}

int _renderText(const char *text, TTF_Font *font, SDL_Color color, SDL_Rect *rect, bool right_align)
{
    int text_width = 0;
    SDL_Surface *textSurface = TTF_RenderUTF8_Blended(font, text, color);
    if (textSurface != NULL)
    {
        text_width = textSurfa</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 285:71 - Line 291:13), workspace\all\libbatmondb\batmondb.c (Line 57:78 - Line 62:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn327" onclick="toggleCodeBlock('cloneGroup327', 'expandBtn327', 'collapseBtn327')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn327" onclick="toggleCodeBlock('cloneGroup327', 'expandBtn327', 'collapseBtn327')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup327"><code class="language-c text-sm text-gray-800">nt duration_to_pixel(int duration)
{
    // Convert a duration to a number of pixel
    return (int)((graph.layout.graph_display_size_x * duration) / GRAPH_DISPLAY_DURATION);
}

void comput</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 641:2 - Line 650:11), workspace\all\gametime\gametime.c (Line 336:15 - Line 345:16)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn328" onclick="toggleCodeBlock('cloneGroup328', 'expandBtn328', 'collapseBtn328')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn328" onclick="toggleCodeBlock('cloneGroup328', 'expandBtn328', 'collapseBtn328')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup328"><code class="language-c text-sm text-gray-800">ARGIN + BUTTON_MARGIN + FONT_MEDIUM);

    graph.layout.label_size_x = graph.layout.graph_display_size_x / 2;
    graph.layout.label_size_y = FONT_MEDI</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 652:11 - Line 673:6), workspace\all\bootlogo\bootlogo.c (Line 101:11 - Line 122:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn329" onclick="toggleCodeBlock('cloneGroup329', 'expandBtn329', 'collapseBtn329')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn329" onclick="toggleCodeBlock('cloneGroup329', 'expandBtn329', 'collapseBtn329')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup329"><code class="language-c text-sm text-gray-800">
    graph.layout.graph_max_size = GRAPH_MAX_FULL_PAGES * graph.layout.graph_display_size_x;

    graph.graphic = (GraphSpot *)malloc(graph.layout.graph_max_size * sizeof(GraphSpot));
    for (int i = 0; i &lt; graph.layout.graph_max_size; i++)
    {
        graph.graphic[i].pixel_height = 0;
        graph.graphic[i].is_charging = false;
        graph.graphic[i].is_estimated = false;
    }
}

int main(int argc, char *argv[])
{
    InitSettings();

    PWR_setCPUSpeed(CPU_SPEED_MENU);
    device_model = PLA</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 710:9 - Line 726:14), workspace\all\ledcontrol\ledcontrol.c (Line 255:9 - Line 172:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn330" onclick="toggleCodeBlock('cloneGroup330', 'expandBtn330', 'collapseBtn330')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn330" onclick="toggleCodeBlock('cloneGroup330', 'expandBtn330', 'collapseBtn330')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup330"><code class="language-c text-sm text-gray-800"> current_page--;
            }
            else if (PAD_justPressed(BTN_B))
            {
                quit = 1;
            }
            else if (PAD_justPressed(BTN_L1) || PAD_justPressed(BTN_L2))
            {
                if (current_zoom &gt; 0)
                {
                    current_page = 0;
                    current_zoom--;
                    dirty = 1;
            </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 749:17 - Line 761:11), workspace\all\gametime\gametime.c (Line 423:17 - Line 434:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn331" onclick="toggleCodeBlock('cloneGroup331', 'expandBtn331', 'collapseBtn331')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn331" onclick="toggleCodeBlock('cloneGroup331', 'expandBtn331', 'collapseBtn331')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup331"><code class="language-c text-sm text-gray-800">max_width = screen-&gt;w - SCALE1(PADDING * 2) - ow;

                char display_name[256];

                switch (current_zoom)
                {
                case 0:
                    sprintf(display_name, &quot;Battery usage: Last %s&quot;, &quot;16 hours&quot;);
                    break;
                case 1:
                    sprintf(display_name, &quot;Battery usage: Last %s&quot;, &quot;8 hours&quot;);
                    break;
                case 2:
                    sprintf(display_name, &quot;Battery usage: Last %s&quot;, &quot;4 hours&quot;);
                    break;
                default:
                    sprintf(display_name, &quot;Battery usage: Last %s&quot;, &quot;8 hours&quot;);
                    break;
                }

                char title[</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 766:7 - Line 774:9), workspace\all\gametime\gametime.c (Line 439:9 - Line 446:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn332" onclick="toggleCodeBlock('cloneGroup332', 'expandBtn332', 'collapseBtn332')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn332" onclick="toggleCodeBlock('cloneGroup332', 'expandBtn332', 'collapseBtn332')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup332"><code class="language-c text-sm text-gray-800">          SDL_Surface *text;
                text = TTF_RenderUTF8_Blended(font.large, title, COLOR_WHITE);
                
                GFX_blitPill(ASSET_BLACK_PILL, screen, &amp;(SDL_Rect){SCALE1(P</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 768:2 - Line 777:13), workspace\all\bootlogo\bootlogo.c (Line 184:2 - Line 193:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn333" onclick="toggleCodeBlock('cloneGroup333', 'expandBtn333', 'collapseBtn333')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn333" onclick="toggleCodeBlock('cloneGroup333', 'expandBtn333', 'collapseBtn333')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup333"><code class="language-c text-sm text-gray-800">lended(font.large, title, COLOR_WHITE);
                
                GFX_blitPill(ASSET_BLACK_PILL, screen, &amp;(SDL_Rect){SCALE1(PADDING), SCALE1(PADDING), m</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\battery\battery.c (Line 770:13 - Line 783:2), workspace\all\minput\minput.c (Line 258:4 - Line 270:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn334" onclick="toggleCodeBlock('cloneGroup334', 'expandBtn334', 'collapseBtn334')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn334" onclick="toggleCodeBlock('cloneGroup334', 'expandBtn334', 'collapseBtn334')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup334"><code class="language-c text-sm text-gray-800">        
                GFX_blitPill(ASSET_BLACK_PILL, screen, &amp;(SDL_Rect){SCALE1(PADDING), SCALE1(PADDING), max_width, SCALE1(PILL_SIZE)});
                SDL_BlitSurface(text, &amp;(SDL_Rect</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\batmon\batmon.c (Line 82:79 - Line 89:3), workspace\all\libbatmondb\batmondb.c (Line 57:78 - Line 292:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn335" onclick="toggleCodeBlock('cloneGroup335', 'expandBtn335', 'collapseBtn335')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn335" onclick="toggleCodeBlock('cloneGroup335', 'expandBtn335', 'collapseBtn335')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup335"><code class="language-c text-sm text-gray-800">  sigaction(SIGCONT, &amp;sa, 0);
}

void cleanup(void)
{
    remove(&quot;/tmp/percBat&quot;);
}

void update_current_duration(void)
{
    sqlite3 *bat_log_db = open_battery_log_db();

    if (bat_log_db != NULL)
    {
        const char </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\batmon\batmon.c (Line 163:99 - Line 175:13), workspace\all\libbatmondb\batmondb.c (Line 57:78 - Line 92:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn336" onclick="toggleCodeBlock('cloneGroup336', 'expandBtn336', 'collapseBtn336')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn336" onclick="toggleCodeBlock('cloneGroup336', 'expandBtn336', 'collapseBtn336')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup336"><code class="language-c text-sm text-gray-800">og_db(bat_log_db);
}

int get_current_session_time(void)
{
    int current_session_duration = 0;

    sqlite3 *bat_log_db = open_battery_log_db();
    
    if (bat_log_db != NULL)
    {
        const char *sql = &quot;SELECT * FROM bat_activity WHERE device_serial = ? AND is_charging = 1 ORDER BY id DESC LIMIT 1;&quot;;
        sqlite</code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\batmon\batmon.c (Line 201:2 - Line 215:6), workspace\all\libbatmondb\batmondb.c (Line 54:2 - Line 92:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn337" onclick="toggleCodeBlock('cloneGroup337', 'expandBtn337', 'collapseBtn337')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn337" onclick="toggleCodeBlock('cloneGroup337', 'expandBtn337', 'collapseBtn337')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup337"><code class="language-c text-sm text-gray-800"> }
                sqlite3_finalize(stmt_sum);
            }
        }
        sqlite3_finalize(stmt);
    }
    close_battery_log_db(bat_log_db);
    
    return current_session_duration;
}

int set_best_session_time(int best_session)
{
    int is_success = 0;

    sqlite3* bat_log_db = open_battery_log_db();

    if (bat_log_db != NULL)
    {
        const char *sql = &quot;SELECT * FROM device_specifics WHERE device_serial = ? ORDER BY id LIMIT 1;&quot;;
     </code></pre></div><div class="py-4"><p class="text-gray-600">workspace\all\batmon\batmon.c (Line 215:60 - Line 222:13), workspace\all\batmon\batmon.c (Line 95:52 - Line 102:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn338" onclick="toggleCodeBlock('cloneGroup338', 'expandBtn338', 'collapseBtn338')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn338" onclick="toggleCodeBlock('cloneGroup338', 'expandBtn338', 'collapseBtn338')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup338"><code class="language-c text-sm text-gray-800"> &amp;stmt, 0);

        if (rc == SQLITE_OK)
        {
            sqlite3_bind_text(stmt, 1, device_model, -1, SQLITE_STATIC);
            rc = sqlite3_step(stmt);
            if (rc == SQLITE_ROW)
            {
                const char *update_sql = &quot;U</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>